(()=>{"use strict";var __webpack_modules__={351:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ko:()=>getSeparatorPattern,ST:()=>rearrangeSeparatorArr,dL:()=>getDatePattern,y$:()=>getDatePatternFull});const PATTERN="\\byyyy\\b|\\byy\\b|\\by\\b|\\bmmmm\\b|\\bmmm\\b|\\bmm\\b|\\bmmb\\b|\\bm\\b|\\bDDDD\\b|\\bDDD\\b|\\bD\\b|\\bdtH\\b|\\bdTH\\b|\\bd\\b|\\bdb\\b|\\bh\\b|\\bhb\\b|\\bi\\b|\\bib\\b|\\bs\\b|\\bsb\\b|\\bapM\\b|\\baPM\\b",getDatePatternFull=()=>{let datePatternFull;return datePatternFull="/\\b("+PATTERN+"\\b)/",datePatternFull=eval(datePatternFull),datePatternFull},getDatePattern=()=>{let datePattern;return datePattern="/\\b"+PATTERN+"\\b/",datePattern=eval(datePattern),datePattern},getSeparatorPattern=separatorArr=>{let separatorPatternBefor=separatorArr;separatorPatternBefor.sort(((e,t)=>t.length-e.length));let separatorPattern="";return separatorPatternBefor.forEach((e=>{separatorPattern&&(separatorPattern+="|"),separatorPattern+=e})),separatorPattern="/"+separatorPattern+"/",separatorPattern=eval(separatorPattern),separatorPattern},rearrangeSeparatorArr=(e,t)=>{let s=[];return e.forEach((e=>{t.indexOf(e)>-1&&s.push(e)})),s}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var s=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](s,s.exports,__webpack_require__),s.exports}__webpack_require__.d=(e,t)=>{for(var s in t)__webpack_require__.o(t,s)&&!__webpack_require__.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};const sleep=async e=>new Promise((t=>{setTimeout((()=>{t()}),e)})),_utils_setCookie=(e,t,s=1)=>{const a=new Date;a.setTime(a.getTime()+24*s*60*60*1e3);let n="expires="+a.toUTCString();document.cookie=e+"="+t+";"+n+";path=/"},getCookie=e=>{let t=e+"=",s=decodeURIComponent(document.cookie).split(";");for(let e=0;e<s.length;e++){let a=s[e];for(;" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return""},isTouchDevice=()=>"ontouchstart"in window||navigator.msMaxTouchPoints>0||navigator.maxTouchPoints>0,round=(e,t=0)=>(t=Math.pow(10,t),Math.round(e*t)/t),randomNumbers=(e=3)=>{let t="",s=0;for(;s<e;)t+=Math.floor(9*Math.random())+0,s++;return t},chatPinnedSAV='<svg viewBox="0 0 19 19"><path d="M9.5 18.419C4.574 18.419.581 14.426.581 9.5S4.574.581 9.5.581s8.919 3.993 8.919 8.919-3.993 8.919-8.919 8.919zm2.121-5.708l-.082-2.99 1.647-1.963a1.583 1.583 0 0 0-.188-2.232l-.32-.269a1.58 1.58 0 0 0-2.231.203L8.803 7.42l-2.964.439a.282.282 0 0 0-.14.496l5.458 4.58c.186.157.47.019.464-.224zM5.62 13.994a.504.504 0 0 0 .688-.038l2.204-2.307-1.085-.91-1.889 2.571a.504.504 0 0 0 .082.684z"></path></svg>',chat='<svg viewBox="0 -960 960 960"><path d="M240-400h320v-80H240v80Zm0-120h480v-80H240v80Zm0-120h480v-80H240v80ZM80-80v-720q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H240L80-80Zm126-240h594v-480H160v525l46-45Zm-46 0v-480 480Z"/></svg>',search='<svg viewBox="0 -960 960 960"><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg>',more_vert='<svg viewBox="0 0 128 512"><path d="M64 360a56 56 0 1 0 0 112 56 56 0 1 0 0-112zm0-160a56 56 0 1 0 0 112 56 56 0 1 0 0-112zM120 96A56 56 0 1 0 8 96a56 56 0 1 0 112 0z"/></svg>',_icons_close='<svg viewBox="0 -960 960 960"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg>',angle_down='<svg viewBox="0 0 448 512"><path d="M201.4 374.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 306.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"/></svg>',done='<svg viewBox="0 -960 960 960"><path d="M382-240 154-468l57-57 171 171 367-367 57 57-424 424Z"/></svg>',done_all='<svg viewBox="0 -960 960 960"><path d="M268-240 42-466l57-56 170 170 56 56-57 56Zm226 0L268-466l56-57 170 170 368-368 56 57-424 424Zm0-226-57-56 198-198 57 56-198 198Z"/></svg>',star='<svg viewBox="0 0 576 512"><path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"/></svg>',send='<svg viewBox="0 0 512 512"><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480l0-83.6c0-4 1.5-7.8 4.2-10.8L331.8 202.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8 17.7 316.6C7.1 311.3 .3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg>',arrow_back='<svg viewBox="0 -960 960 960"><path d="m313-440 224 224-57 56-320-320 320-320 57 56-224 224h487v80H313Z"/></svg>',deletee='<svg viewBox="0 0 448 512"><path d="M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z"/></svg>',reply='<svg viewBox="0 0 512 512"><path d="M205 34.8c11.5 5.1 19 16.6 19 29.2l0 64 112 0c97.2 0 176 78.8 176 176c0 113.3-81.5 163.9-100.2 174.1c-2.5 1.4-5.3 1.9-8.1 1.9c-10.9 0-19.7-8.9-19.7-19.7c0-7.5 4.3-14.4 9.8-19.5c9.4-8.8 22.2-26.4 22.2-56.7c0-53-43-96-96-96l-96 0 0 64c0 12.6-7.4 24.1-19 29.2s-25 3-34.4-5.4l-160-144C3.9 225.7 0 217.1 0 208s3.9-17.7 10.6-23.8l160-144c9.4-8.5 22.9-10.6 34.4-5.4z"/></svg>',copy='<svg viewBox="0 0 448 512"><path d="M384 336l-192 0c-8.8 0-16-7.2-16-16l0-256c0-8.8 7.2-16 16-16l140.1 0L400 115.9 400 320c0 8.8-7.2 16-16 16zM192 384l192 0c35.3 0 64-28.7 64-64l0-204.1c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1L192 0c-35.3 0-64 28.7-64 64l0 256c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64L0 448c0 35.3 28.7 64 64 64l192 0c35.3 0 64-28.7 64-64l0-32-48 0 0 32c0 8.8-7.2 16-16 16L64 464c-8.8 0-16-7.2-16-16l0-256c0-8.8 7.2-16 16-16l32 0 0-48-32 0z"/></svg>',description='<svg viewBox="0 -960 960 960"><path d="M320-240h320v-80H320v80Zm0-160h320v-80H320v80ZM240-80q-33 0-56.5-23.5T160-160v-640q0-33 23.5-56.5T240-880h320l240 240v480q0 33-23.5 56.5T720-80H240Zm280-520v-200H240v640h480v-440H520ZM240-800v200-200 640-640Z"/></svg>',menu='<svg viewBox="0 -960 960 960"><path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"/></svg>',chat_open='<svg viewBox="0 0 39 37"><defs><path d="M31.4824242 24.6256121L31.4824242 0.501369697 0.476266667 0.501369697 0.476266667 24.6256121z"></path></defs><g fill="none" fill-rule="evenodd" stroke="none" stroke-width="1"><g transform="translate(-1432 -977) translate(1415.723 959.455)"><g transform="translate(17 17)"><g transform="translate(6.333 .075)"><path d="M30.594 4.773c-.314-1.943-1.486-3.113-3.374-3.38C27.174 1.382 22.576.5 15.36.5c-7.214 0-11.812.882-11.843.889-1.477.21-2.507.967-3.042 2.192a83.103 83.103 0 019.312-.503c6.994 0 11.647.804 12.33.93 3.079.462 5.22 2.598 5.738 5.728.224 1.02.932 4.606.932 8.887 0 2.292-.206 4.395-.428 6.002 1.22-.516 1.988-1.55 2.23-3.044.008-.037.893-3.814.893-8.415 0-4.6-.885-8.377-.89-8.394"></path></g><g transform="translate(0 5.832)"><path d="M31.354 4.473c-.314-1.944-1.487-3.114-3.374-3.382-.046-.01-4.644-.89-11.859-.89-7.214 0-11.813.88-11.843.888-1.903.27-3.075 1.44-3.384 3.363C.884 4.489 0 8.266 0 12.867c0 4.6.884 8.377.889 8.393.314 1.944 1.486 3.114 3.374 3.382.037.007 3.02.578 7.933.801l2.928 5.072a1.151 1.151 0 001.994 0l2.929-5.071c4.913-.224 7.893-.794 7.918-.8 1.902-.27 3.075-1.44 3.384-3.363.01-.037.893-3.814.893-8.414 0-4.601-.884-8.378-.888-8.394"></path></g></g></g></g></svg>',eye='<svg viewBox="0 0 576 512"><path d="M288 80c-65.2 0-118.8 29.6-159.9 67.7C89.6 183.5 63 226 49.4 256c13.6 30 40.2 72.5 78.6 108.3C169.2 402.4 222.8 432 288 432s118.8-29.6 159.9-67.7C486.4 328.5 513 286 526.6 256c-13.6-30-40.2-72.5-78.6-108.3C406.8 109.6 353.2 80 288 80zM95.4 112.6C142.5 68.8 207.2 32 288 32s145.5 36.8 192.6 80.6c46.8 43.5 78.1 95.4 93 131.1c3.3 7.9 3.3 16.7 0 24.6c-14.9 35.7-46.2 87.7-93 131.1C433.5 443.2 368.8 480 288 480s-145.5-36.8-192.6-80.6C48.6 356 17.3 304 2.5 268.3c-3.3-7.9-3.3-16.7 0-24.6C17.3 208 48.6 156 95.4 112.6zM288 336c44.2 0 80-35.8 80-80s-35.8-80-80-80c-.7 0-1.3 0-2 0c1.3 5.1 2 10.5 2 16c0 35.3-28.7 64-64 64c-5.5 0-10.9-.7-16-2c0 .7 0 1.3 0 2c0 44.2 35.8 80 80 80zm0-208a128 128 0 1 1 0 256 128 128 0 1 1 0-256z"/></svg>',eye_slash='<svg viewBox="0 0 640 512"><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zm151 118.3C226 97.7 269.5 80 320 80c65.2 0 118.8 29.6 159.9 67.7C518.4 183.5 545 226 558.6 256c-12.6 28-36.6 66.8-70.9 100.9l-53.8-42.2c9.1-17.6 14.2-37.5 14.2-58.7c0-70.7-57.3-128-128-128c-32.2 0-61.7 11.9-84.2 31.5l-46.1-36.1zM394.9 284.2l-81.5-63.9c4.2-8.5 6.6-18.2 6.6-28.3c0-5.5-.7-10.9-2-16c.7 0 1.3 0 2 0c44.2 0 80 35.8 80 80c0 9.9-1.8 19.4-5.1 28.2zm9.4 130.3C378.8 425.4 350.7 432 320 432c-65.2 0-118.8-29.6-159.9-67.7C121.6 328.5 95 286 81.4 256c8.3-18.4 21.5-41.5 39.4-64.8L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5l-41.9-33zM192 256c0 70.7 57.3 128 128 128c13.3 0 26.1-2 38.2-5.8L302 334c-23.5-5.4-43.1-21.2-53.7-42.3l-56.1-44.2c-.2 2.8-.3 5.6-.3 8.5z"/></svg>',sync='<svg viewBox="0 -960 960 960"><path d="M160-160v-80h110l-16-14q-52-46-73-105t-21-119q0-111 66.5-197.5T400-790v84q-72 26-116 88.5T240-478q0 45 17 87.5t53 78.5l10 10v-98h80v240H160Zm400-10v-84q72-26 116-88.5T720-482q0-45-17-87.5T650-648l-10-10v98h-80v-240h240v80H690l16 14q49 49 71.5 106.5T800-482q0 111-66.5 197.5T560-170Z"/></svg>',send2='<svg viewBox="0 0 25 22"><path d="M0 21.5V0.5L25 11L0 21.5ZM2.63158 17.5625L18.2237 11L2.63158 4.4375V9.03125L10.5263 11L2.63158 12.9687V17.5625Z"/></svg>',new_chat='<svg viewBox="0 -960 960 960"><path d="M120-160v-600q0-33 23.5-56.5T200-840h480q33 0 56.5 23.5T760-760v203q-10-2-20-2.5t-20-.5q-10 0-20 .5t-20 2.5v-203H200v400h283q-2 10-2.5 20t-.5 20q0 10 .5 20t2.5 20H240L120-160Zm160-440h320v-80H280v80Zm0 160h200v-80H280v80Zm400 280v-120H560v-80h120v-120h80v120h120v80H760v120h-80ZM200-360v-400 400Z"/></svg>',icons={new_chat,send2,sync,eye,eye_slash,copy,menu,star,chat,done,send,close:_icons_close,reply,search,delete:deletee,done_all,more_vert,chat_open,arrow_back,angle_down,description,chatPinnedSAV},processAllIcons=(e=null)=>{e||(e=document),e.querySelectorAll("i.my_icon").forEach((e=>{const t=e.innerText.trim().toLowerCase();icons[t]?e.innerHTML=icons[t]:e.innerHTML=""}))},createIcon=e=>{const t=document.createElement("i");return t.className="my_icon",t.innerHTML=icons[e],t};let isAdmin=!1,user_active_id=null;const getAdminLoginCookie=()=>{const e=getCookie("admin_login_id");return e&&(isAdmin=!0),e},getUserLoginCookie=()=>{const e=getCookie("user_login_id");return e&&(isAdmin=!0),e},setAdminLoginCookie=e=>{let t=1/24;e||(t=-500),setCookie("admin_login_id",e,t)},setUserLoginCookie=e=>{let t=30;e||(t=-500),_utils_setCookie("user_login_id",e,t)},userIsAdmin=()=>isAdmin,getActiveUserId=()=>isAdmin?getAdminLoginCookie():getUserLoginCookie(),chatsPerAPICall=null,messagesPerAPICall=null;class _ErrorReport{static get status(){return 2}}class _ApiSettings{static get chatsPerAPICall(){return 15}static get messagesPerAPICall(){return 20}}class _MessageOptions{static get more_msgOptions(){return 0}static get msgOptions(){return _MessageOptions.replyMessage||_MessageOptions.messageInfo||_MessageOptions.fowardMessage||_MessageOptions.starMessage||_MessageOptions.deleteMessage||_MessageOptions.selectMessage||_MessageOptions.copyMessage}static get replyMessage(){return 1}static get messageInfo(){return 1}static get fowardMessage(){return 0}static get starMessage(){return 0}static get deleteMessage(){return 0}static get selectMessage(){return 0}static get copyMessage(){return 0}static get headReplyMessage(){return 1&_MessageOptions.replyMessage}static get headMsgInfo(){return 1&_MessageOptions.messageInfo}static get groupFowardMessage(){return 1&_MessageOptions.fowardMessage}static get groupStarMessage(){return 1&_MessageOptions.starMessage}static get groupDelMessage(){return 1&_MessageOptions.deleteMessage}static get groupCopyMessage(){return 1&_MessageOptions.copyMessage}}class _ChatOptions{static get more_chatOptions(){return 0}static get chatOptions(){return _ChatOptions.selectChat||_ChatOptions.deleteChat||_ChatOptions.pinChat}static get searchChat(){return 0}static get chatChat(){return 0}static get selectChat(){return 0}static get deleteChat(){return 0}static get pinChat(){return 0}static get groupChatPin(){return 0}static get groupDelChat(){return 0}}class Settings{static get AppName(){return"Tech"}static get ErrorReport(){return _ErrorReport}static get ApiSettings(){return _ApiSettings}static get MessageOptions(){return _MessageOptions}static get ChatOptions(){return _ChatOptions}}const alertMsg=e=>{let t="There seam to be an error, please contact the Admin is this message persist";return e&&(t=`Error ${e}, please contact the Admin is this error persist`),t},errorReportStatus=Settings.ErrorReport.status,userIsAlerted={},allowUserAlert={};class MyCodeErr{static announce(e,t,s=!1,a=!1){if(a)return 3===errorReportStatus?(console.log(t),e):void 0;if(0!==errorReportStatus){if(1===errorReportStatus){clearTimeout(allowUserAlert[e]);let s=alertMsg(t);return alert(s),void(allowUserAlert[e]=setTimeout((()=>{userIsAlerted[e]=!1}),2e3))}return 2===errorReportStatus?(console.log(t),e):void 0}}}class DOMGetter{static getPageSection(){return document.getElementById("pageSection")}static getLoaderBackgroundElem(e){return e.getElementsByClassName("loaderBackground")[0]}static getContentLoaderElem(e){return e.getElementsByClassName("contentLoader")[0]}static getMousePositionBody(){return document.getElementById("mousePositionBody")}static getShowProfilePicture(){return document.getElementById("showProfilePicture")}static getDeleteMessageOption(){return document.getElementById("deleteMessageOption")}static getDeleteChatOption(){return document.getElementById("deleteChatOption")}static getMsgInfoPopUp(){return document.getElementById("msgInfoPopUp")}static getChat(){return document.getElementById("chat")}static getChatMousePosBody(){return document.getElementById("chatMousePosBody")}static getChatHead(){return document.getElementById("chatHead")}static getChatHeadNormal(){return document.getElementById("chatHeadNormal")}static getChatChatMinimize(){return document.getElementById("chatChatMinimize")}static getChatHeadPix(){return document.getElementById("chatHeadPix")}static getChatHeadChat(){return document.getElementById("chatHeadChat")}static getChatHeadSearchChat(){return document.getElementById("chatHeadSearchChat")}static getChatHeadOthers(){return document.getElementById("chatHeadOthers")}static getChatHeadOthersOptions(){return document.getElementById("chatHeadOthersOptions")}static getChatHeadSelected(){return document.getElementById("chatHeadSelected")}static getChatHeadBack(){return document.getElementById("chatHeadBack")}static getChatHeadCount(){return document.getElementById("chatHeadCount")}static getChatHeadPin(){return document.getElementById("chatHeadPin")}static getChatHeadDelete(){return document.getElementById("chatHeadDelete")}static getChatHeadOthersS(){return document.getElementById("chatHeadOthersS")}static getChatSearch(){return document.getElementById("chatSearch")}static getChatSearchBack(){return document.getElementById("chatSearchBack")}static getChatSearchClear(){return document.getElementById("chatSearchClear")}static getChatBody(){return document.getElementById("chatBody")}static getGetOlderChat(){return document.getElementById("getOlderChat")}static getMessage(){return document.getElementById("message")}static getMessageHead(){return document.getElementById("messageHead")}static getMessageHeadNormal(){return document.getElementById("messageHeadNormal")}static getMessageChatMaximize(){return document.getElementById("messageChatMaximize")}static getMessageHeadPix(){return document.getElementById("messageHeadPix")}static getMessageHeadOthers(){return document.getElementById("messageHeadOthers")}static getMessageHeadOthersOptions(){return document.getElementById("messageHeadOthersOptions")}static getMessageHeadSelected(){return document.getElementById("messageHeadSelected")}static getMessageHeadBack(){return document.getElementById("messageHeadBack")}static getMessageHeadCount(){return document.getElementById("messageHeadCount")}static getMessageHeadReply(){return document.getElementById("messageHeadReply")}static getMessageHeadDelete(){return document.getElementById("messageHeadDelete")}static getMessageHeadFoward(){return document.getElementById("messageHeadFoward")}static getMessageHeadCopy(){return document.getElementById("messageHeadCopy")}static getMessageHeadStar(){return document.getElementById("messageHeadStar")}static getMessageHeadInfo(){return document.getElementById("messageHeadInfo")}static getMessageHeadOthersS(){return document.getElementById("messageHeadOthersS")}static getMessageBody(){return document.getElementById("messageBody")}static getMsgSelectAChat(){return document.getElementById("selectAChatW")}static getLoadOlderMsgsBtn(){return document.getElementById("loadOlderMsgsBtn")}static getChatBox(){return document.getElementById("chatBox")}static getMsgDate(){return document.getElementById("msgDate")}static getCloseChatBox(){return document.getElementById("closeChatBox")}static getChatBoxTextMsg(){return document.getElementById("chatBoxTextMsg")}static getMsgToSend(){return document.getElementById("msgToSend")}static getMsgToBeReplyedID(){return document.getElementById("msgToBeReplyedID")}}class GlobalVarsInstance{constructor(){this.selectedChatsID=[],this.selectedMessagesID=[],this.msgSenderTracking=[],this.msgstaredTracking=[],this.chatsAreSelected=null,this.megChatTouchedTimeOut=null,this.touchYPos=null,this.msgDateTimeOutFunction=null}}const GlobalVars=new GlobalVarsInstance;class PageClearDOM{static section(){let e=DOMGetter.getPageSection().children;if(e){let t=e.length;for(let s=0;s<t;s++)e[0].parentNode.removeChild(e[0])}else{let e="allSectionContent not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}const LBClass="loaderBackground",CLClass="contentLoader";class LoaderBackgroundDOM{static create(){let e=document.createElement("div");return e.className="loaderBackground",e}static append(e,t){e.appendChild(t)}static delete(e){let t=e.getElementsByClassName(LBClass)[0];if(t)if(t.parentNode==e)e.removeChild(t);else{let e="elem not a parent",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}else{let e="there is no background",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ContentLoaderDOM{static create(e=null,t=null){if(!e&&!t){let e="noting for loader to work width",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}if(-1==["spiner","boxes"].indexOf(t)){let e="loader not recognised",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}let s=document.createElement("div");s.className="contentLoader";let a,n=document.createElement("div");if(e&&(!0===e&&(e="Loading"),a=document.createElement("span"),a.className="text",a.innerHTML=e,n.appendChild(a)),t){if("spiner"==t){let e=LodersDOM.createSpinerLoader();n.appendChild(e)}if("boxes"==t){let e=LodersDOM.createBoxesLoader();n.appendChild(e)}}return s.appendChild(n),s}static append(e,t){e.appendChild(t)}static delete(e){let t=e.getElementsByClassName(CLClass)[0];if(t)if(t.parentNode==e)e.removeChild(t);else{let e="elem not a parent",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}else{let e="there is no background",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class LodersDOM{static createSpinerLoader(){let e=document.createElement("span");return e.className="spiner",e}static createBoxesLoader(){let e,t=document.createElement("span");return t.className="boxes",e=document.createElement("span"),t.appendChild(e),e=document.createElement("span"),t.appendChild(e),e=document.createElement("span"),t.appendChild(e),t}}const Defaults={arrangement:"y-m-d h:i:s--apM",year:"yyyy",month:"mm",day:"DDDD",beforeTH:"<br>",afterTH:"</br>"},posibleDateFomatValues={year:["yyyy","yy","y"],month:["mmmm","mmm","mm","mmb","m"],day:["DDDD","DDD","D"],date:["dtH","dTH","d","db"],hour:["h","hb"],minute:["i","ib"],second:["s","sb"],midday:["apM","aPM"]},yearTextToYear=(e,t)=>("y"==t&&(t=Defaults.year,posibleDateFomatValues.year.indexOf(t)<0&&(t="yyyy"),"y"==t&&(t="yyyy")),"yyyy"==t?e:"yy"==t&&(e=String(e)).substr(-2)),monthNamesArr=[["January","Jan"],["February","Feb"],["March","Mar"],["April","Apr"],["May","May"],["June","Jun"],["July","Jul"],["August","Aug"],["September","Sep"],["October","Oct"],["November","Nov"],["December","Dec"]],monthTextToMonth=(e,t)=>("m"==t&&(t=Defaults.month,posibleDateFomatValues.month.indexOf(t)<0&&(t="mmmmm"),"m"==t&&(t="mmmmm")),"mmmm"==t?monthNamesArr[e][0]:"mmm"==t?monthNamesArr[e][1]:"mm"==t?++e:"mmb"==t&&(e++,String(e).length>1?e:"0"+e)),dayNamesArr=[["Sunday","Sun"],["Monday","Mon"],["Tuesday","Tue"],["Wednesday","Wed"],["Thursday","Thu"],["Friday","Fri"],["Saturday","Sat"]],dayTextToDay=(e,t)=>("D"==t&&(t=Defaults.day,posibleDateFomatValues.day.indexOf(t)<0&&(t="DDDD"),"D"==t&&(t="DDDD")),"DDDD"==t?dayNamesArr[e][0]:"DDD"==t&&dayNamesArr[e][1]),dateTextToDate=(e,t,s)=>{if("d"==t)return e;if("db"==t)return String(e).length>1?e:"0"+e;let a="th",n=(e=String(e)).split("").splice(-1);return 1==n&&(a="st"),2==n&&(a="nd"),3==n&&(a="rd"),"dtH"==t?(a=s.beforeTH+a+s.afterTH,e+=a):"dTH"==t&&(a=a.toUpperCase(),a=s.beforeTH+a+s.afterTH,e+=a)},hourTextToHour=(e,t,s)=>(s&&(0===e?e=12:e>12&&(e-=12)),"h"==t?String(e).length>1?e:"0"+e:"hb"==t&&e),minuteTextToMinute=(e,t)=>"i"==t?String(e).length>1?e:"0"+e:"ib"==t&&e,secondTextToSecond=(e,t)=>"s"==t?String(e).length>1?e:"0"+e:"sb"==t&&e,middayTextToMidday=(e,t)=>{let s="am";return e>11&&(s="pm"),"apM"==t?s:"aPM"==t&&(s=s.toUpperCase(),s)},fullDateTextToDate=(e,t,s,a)=>{const n=posibleDateFomatValues;if(n.year.indexOf(e)>-1){let s=t.getFullYear();return yearTextToYear(s,e)}if(n.month.indexOf(e)>-1){let s=t.getMonth();return monthTextToMonth(s,e)}if(n.day.indexOf(e)>-1){let s=t.getDay();return dayTextToDay(s,e)}if(n.date.indexOf(e)>-1){let s=t.getDate();return dateTextToDate(s,e,a)}if(n.hour.indexOf(e)>-1){let a=t.getHours();return hourTextToHour(a,e,s)}if(n.minute.indexOf(e)>-1){let s=t.getMinutes();return minuteTextToMinute(s,e)}if(n.second.indexOf(e)>-1){let s=t.getSeconds();return secondTextToSecond(s,e)}if(n.midday.indexOf(e)>-1){let s=t.getHours();return middayTextToMidday(s,e)}return!1};var patterns=__webpack_require__(351);const formatDate=(e=null,t=null,s=null)=>{if(s||(s={}),e||(e=Defaults.arrangement)||(e="y-m-d h:i:s--apM"),t||(t=new Date,s.isMiliseconds=!1,s.isPHPMicroSeconds=!1),s.isPHPMicroSeconds&&!0===s.isPHPMicroSeconds){if("number"!=typeof(t*=1e3)){let e="The date you choose is invalid";return alert(e),void console.log(e)}s.isMiliseconds=!0}if(s.isMiliseconds&&!0===s.isMiliseconds){if("number"!=typeof(t=parseInt(t))){let e="The date you choose is invalid";return alert(e),void console.log(e)}t=new Date(t)}if("object"!=typeof t){let e="The date you choose is invalid";return alert(e),void console.log(e)}s.beforeTH||(s.beforeTH=Defaults.beforeTH,null===s.beforeTH&&(s.beforeTH="")),s.afterTH||(s.afterTH=Defaults.afterTH,null===s.afterTH&&(s.afterTH=""));const a=/apM|aPM/.test(e),n=(0,patterns.y$)(),o=e.split(n);o.map(((e,t,s)=>{""==e&&s.splice(t,1)}));const l=(0,patterns.dL)(),i=e.split(l);i.map(((e,t,s)=>{""==e&&s.splice(t,1)}));const r=(0,patterns.Ko)(i),c=e.split(r);c.map(((e,t,s)=>{""==e&&s.splice(t,1)}));const d=c.map((e=>fullDateTextToDate(e,t,a,s))),g=(0,patterns.ST)(o,i);g.map(((e,t,s)=>{/--/.test(e)&&(s[t]=e.replace(/--/,""))}));let h="";if(l.test(o[0])){let e=0;d.forEach((t=>{h+=t,g[e]&&(h+=g[e]),e++}))}else{let e=0;g.forEach((t=>{h+=t,d[e]&&(h+=d[e]),e++}))}return h};class TimeFunctions{static generateTimeSentStringT1(e){let t,s=864e5,a=new Date;a.setHours(0,0,0),a=Date.parse(a);let n="db-mmb-yyyy";return e>=a-s&&(n=null,t="Yesterday"),e>=a&&(n=null,t="Today"),e>=a+s&&(n="db-mmb-yyyy"),n&&(t=formatDate(n,e,{isPHPMicroSeconds:!0})),t}static generateTimeSentStringT2(e){let t;return t=formatDate("h:i apM",e,{isPHPMicroSeconds:!0}),t}}class OtherFunctions{static clearMegChatTouchedTimeOut(e){clearTimeout(GlobalVars.megChatTouchedTimeOut),e.target.removeEventListener("touchend",OtherFunctions.clearMegChatTouchedTimeOut),e.target.removeEventListener("touchcancel",OtherFunctions.clearMegChatTouchedTimeOut),e.target.removeEventListener("touchmove",MsgBody.touchedThisMessageThenDrag),e.target.removeEventListener("touchmove",ChatBody.touchedThisChatThenDrag)}static activateMsgDateBeforeAfterfunc(){let e=document.getElementsByClassName("Be")[0],t=document.getElementsByClassName("Af")[0];e&&e.classList.remove("Be"),t&&t.classList.remove("Af");const s=OtherFunctions.getMsgDateBeforefunc(),a=OtherFunctions.getMsgDateAfterfunc();s&&s.classList.add("Be"),a&&a.classList.add("Af")}static getMsgDateBeforefunc(){const e=DOMGetter.getMessageBody();let t=e.getElementsByClassName("msgDate"),s=e.getBoundingClientRect().top,a=null;for(let e=0;e<t.length;e++){let n=t[e];if(!(n.getBoundingClientRect().top<s))return a;a=n}return a}static getMsgDateAfterfunc(){const e=DOMGetter.getMessageBody();let t=e.getElementsByClassName("msgDate"),s=e.getBoundingClientRect().top,a=null;for(let e=0;e<t.length;e++){let n=t[e];if(n.getBoundingClientRect().top>=s)return a=n,a}return a}static getMsgDateBeforeBeforefunc(e){let t=DOMGetter.getMessageBody().getElementsByClassName("msgDate"),s=null;for(let a=0;a<t.length;a++){let n=t[a];if(n.innerHTML==e)return s;s=n.innerHTML}return s}static onclickReplyedMegLink(e){let t=e.target;for(;"A"!=t.tagName;)t=t.parentElement;let s=t.parentElement;const a=ChatFuncs.getActiveChat(),n=s.dataset.id,o=MessageFuncs.getRepliedMsgObj(a,n);if(!o){let e="Error getting replyedMsgObj",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}const l=MsgBody.makeMsgIDUsable(o.msgID);let i=document.getElementById(l);if(i)MsgBody.jumpToMsgByID(l,!0);else{if(MessageFuncs.pushInPreviousMsgs(a,l),i=document.getElementById(l),!i){let e="Error jumping",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}MsgBody.jumpToMsgByID(l,!0)}}}class ProfileFunc{static viewMyProfilePicture(){const e=DOMGetter.getChatHeadPix();let t=DOMGetter.getMousePositionBody(),s=DOMGetter.getShowProfilePicture();t&&MousePositionBodyPopupDOM.delete(),s&&ShowProfilePicturePopupDOM.delete();let a=e.getElementsByTagName("img")[0].src;MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create({styles:[["background","black"],["opacity","0.5"]]})),ShowProfilePicturePopupDOM.append(ShowProfilePicturePopupDOM.create(a))}static viewCurrentChatProfilePicture(){const e=DOMGetter.getMessageHeadPix();let t=DOMGetter.getMousePositionBody(),s=DOMGetter.getShowProfilePicture();t&&MousePositionBodyPopupDOM.delete(),s&&ShowProfilePicturePopupDOM.delete();let a=e.getElementsByTagName("img")[0].src;MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create({styles:[["background","black"],["opacity","0.5"]]})),ShowProfilePicturePopupDOM.append(ShowProfilePicturePopupDOM.create(a))}static viewChatProfilePicture(e){let t=DOMGetter.getMousePositionBody(),s=DOMGetter.getShowProfilePicture();t&&MousePositionBodyPopupDOM.delete(),s&&ShowProfilePicturePopupDOM.delete();let a=e.target.src;MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create({styles:[["background","black"],["opacity","0.5"]]})),ShowProfilePicturePopupDOM.append(ShowProfilePicturePopupDOM.create(a))}static closeProfilePictureView(){const e=DOMGetter.getMousePositionBody(),t=DOMGetter.getShowProfilePicture();e&&MousePositionBodyPopupDOM.delete(),t&&ShowProfilePicturePopupDOM.delete()}}class ChatBoxDOM{static _createElem=(e,t)=>{let s=null,a=null;t&&(s=t.msg,a=t.rMsg);const n=document.createElement("div");n.id="chatBox";let o=document.createElement("div");o.className="cchatBox";let l=document.createElement("div");if(l.className="textMegContain",a){let e=ChatboxReplyDOM.create(a);l.appendChild(e),l.classList.add("replying")}let i=document.createElement("div");i.className="textContain";let r=document.createElement("div");r.className="text placeholder",r.innerHTML="Type text message",i.appendChild(r);let c=document.createElement("div");c.id="chatBoxTextMsg",c.className="text",c.setAttribute("contentEditable","true"),s&&(c.innerHTML=s,r.classList.add("hide")),i.appendChild(c),l.appendChild(i),o.appendChild(l),n.appendChild(o);let d=createIcon("send2");return d.classList.add("send"),n.appendChild(d),e({chatBoxTextMsg:c,sendIcon:d}),n};static create(){const e=ChatFuncs.getActiveChat();let t=null;return ChatBoxDB.chatHasChatBox(e)&&(t=ChatBoxDB.getChatBoxAttr(e)),this._createElem(ChatBoxDOM.onload,t)}static createNoUser(){let e={msg:ChatBoxDB.noUser,rMsg:""};return this._createElem(ChatBoxDOM.onloadNoUser,e)}static createNewChat(){let e={msg:ChatBoxDB.newChat,rMsg:""};return this._createElem(ChatBoxDOM.onloadNewChat,e)}static append(e){const t=DOMGetter.getMessage();if(t)t.appendChild(e);else{let e="msgElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(){const e=DOMGetter.getChatBox();if(e)e.parentNode.removeChild(e);else{let e="chatBoxElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static onload(e){let t=e.chatBoxTextMsg,s=e.sendIcon;t&&(t.addEventListener("keyup",ChatBoxDOM.typingMessage),t.addEventListener("keydown",ChatBoxDOM.typingMessage)),s&&s.addEventListener("click",MsgBody.sendMsg)}static onloadNoUser(e){let t=e.chatBoxTextMsg,s=e.sendIcon;t&&(t.addEventListener("keyup",ChatBoxDOM.typingMessageNoUser),t.addEventListener("keydown",ChatBoxDOM.typingMessageNoUser)),s&&s.addEventListener("click",MsgBody.sendMsgNoUser)}static onloadNewChat(e){let t=e.chatBoxTextMsg,s=e.sendIcon;t&&(t.addEventListener("keyup",ChatBoxDOM.typingMessageNewChat),t.addEventListener("keydown",ChatBoxDOM.typingMessageNewChat)),s&&s.addEventListener("click",MsgBody.sendUserNewChat)}static typingMessage(e){let t=e.target,s=t.previousElementSibling;if(t.innerText.trim()?s.classList.add("hide"):s.classList.remove("hide"),"keyup"==e.type){const e=t.innerHTML,s=ChatFuncs.getActiveChat();ChatBoxDB.updateMsg(s,e)}}static typingMessageNoUser(e){let t=e.target,s=t.previousElementSibling;if(t.innerText.trim()?s.classList.add("hide"):s.classList.remove("hide"),"keyup"==e.type){const e=t.innerHTML;ChatBoxDB.noUser=e}}static typingMessageNewChat(e){let t=e.target,s=t.previousElementSibling;if(t.innerText.trim()?s.classList.add("hide"):s.classList.remove("hide"),"keyup"==e.type){const e=t.innerHTML;ChatBoxDB.newChat=e}}static clear(){const e=DOMGetter.getChatBox().querySelector("#chatBoxTextMsg"),t=e.previousElementSibling;e.innerHTML="",t.classList.remove("hide");const s=ChatFuncs.getActiveChat();ChatBoxDB.updateMsg(s,"")}static clearNewMsg=()=>{ChatBoxDB.newChat="",ChatBoxDB.noUser=""};static setToLoading=(e=null)=>{const t=DOMGetter.getChatBox(),s=document.createElement("div");s.className="chatBox_loader",e&&(s.id=e);const a=document.createElement("span");s.appendChild(a),t.appendChild(s)};static tryHide(){}static tryUnhide(){}}class ChatboxReplyDOM{static create(e){if(!e){const t=ChatFuncs.getActiveChat();e=ChatBoxDB.getRMsgObj(t)}if(!e){let e="rMsgObj not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}let t,s,a,n,o,l;s="#"+MsgBody.makeMsgIDUsable(e.msgID),a=e.isSender,t=a?"you":"notYou",o=e.senderName,n=e.msg;let i=document.createElement("div");i.className="replyedMeg";let r=document.createElement("div");i.appendChild(r);let c=createIcon("close");c.classList.add("close"),i.appendChild(c),l=document.createElement("span"),l.className=t,i.appendChild(l);let d=document.createElement("a");d.href=s,l=document.createElement("span"),l.className=t,l.innerHTML=o,d.appendChild(l);let g=document.createTextNode(n);d.appendChild(g),i.appendChild(d);let h={close:c};return OnloadActivations.chatboxReplyElem(h),i}static append(e){let t=DOMGetter.getChatBox().getElementsByClassName("textMegContain")[0],s=t.getElementsByClassName("textContain")[0],a=s.parentNode;if(s)a.insertBefore(e,s),t.classList.add("replying");else{let e="textContainElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(){let e=DOMGetter.getChatBox().getElementsByClassName("textMegContain")[0],t=e.getElementsByClassName("replyedMeg")[0];if(t)t.parentNode.removeChild(t),e.classList.remove("replying");else{let e="rMsgElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static close(){ChatboxReplyDOM.delete();const e=ChatFuncs.getActiveChat();ChatBoxDB.deleteRMsgObj(e)}}class MsgSectionDOM{static clear(e=!1){let t=DOMGetter.getMessage().children;if(t){let e=t.length;for(let s=0;s<e;s++)t[0].parentNode.removeChild(t[0]);ChatFuncs.setActiveChat(null)}else{let e="msgSectionContent not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}e&&SelectAChatDOM.append(SelectAChatDOM.create())}static load=(e=!1,t=!1)=>{MessageHeadDOM.append(MessageHeadDOM.create()),e?MessageHeadNormalDOM.append(MessageHeadNormalDOM.createNoUser(t)):(MessageHeadNormalDOM.append(MessageHeadNormalDOM.create()),MessageHeadSelectedDOM.append(MessageHeadSelectedDOM.create())),MsgDateDOM.append(MsgDateDOM.create(null,!0),!0),MessageBodyDOM.append(MessageBodyDOM.create()),e?t?ChatBoxDOM.append(ChatBoxDOM.createNewChat()):ChatBoxDOM.append(ChatBoxDOM.createNoUser()):ChatBoxDOM.append(ChatBoxDOM.create())}}class RootPath{static home_loc_dev="/chat_box/chat_box/";static home_loc=()=>location.host.includes("localhost")?this.home_loc_dev:"/";static getPath(e){return this.home_loc()+e}}class ServerPaths{static _api=RootPath.getPath("resources/backend/apis/");static _profilePix=RootPath.getPath("resources/frontend/img/profile_images/");static getApiPath(e){return this._api+e}static getProfilePixPath(e){return this._profilePix+e}static getSocketPath=()=>location.host.includes("localhost")?"ws://localhost:8080":"wss://13.62.101.34:8080"}class ProfileAPI{static fetchMyProfile_test(){return GenerateDummyDatabase.profile(["2a"])}static async fetchMyProfile(e=!0){let t="",s="admin";if(e?t=getAdminLoginCookie():(t=getUserLoginCookie(),s=""),!t)return null;const a=new FormData;a.append("id",t),a.append("type",s);let n={userID:null,name:null,p_pix:null};const o=await fetch(ServerPaths.getApiPath("fetch_profile.php"),{method:"post",body:a});if(o.ok){const e=await o.json();if(e.isErr)return alert(e.msg),null;n=e.user}else alert("some error occured");return n}static async fetchAllAdminProfile(){const e=await fetch(ServerPaths.getApiPath("fetch_admin_profiles.php"),{method:"get"});let t=null;if(e.ok){const s=await e.json();if(s.isErr)return alert(s.msg),null;t=s}else alert("some error occured");return t}static fetchProfileListLastSeen=async e=>{if(!e.length)return null;const t=new FormData;t.append("list",JSON.stringify(e));const s=await fetch(ServerPaths.getApiPath("fetch_profile_lastseeen_from_list.php"),{method:"post",body:t});let a=null;if(s.ok){const e=await s.json();if(e.isErr)return alert(e.msg),null;a=e.data}else alert("some error occured");return a};static getById=async e=>{const t=await fetch(ServerPaths.getApiPath(`fetch_profiles_by_id.php?dd_id_z=${e}`),{method:"get"});let s=null;if(t.ok){const e=await t.json();if(e.isErr)return alert(e.msg),null;s=e.profile}else alert("some error occured");return s}}class ProfileInstance{constructor(e){e||(e={}),this._userID=e.userID,this._type=e.type,this._f_nane=e.f_name,this._l_nane=e.l_name,this._identifier=e.identifier,this._p_pix=e.p_pix,this._lastSeen=e.last_seen}isAdmin=()=>"admin"==this._type;get isOnline(){return"online"==this.lastSeen}get userID(){return this._userID}get identifier(){return this._identifier}get name(){let e="";return(this._f_nane||this._l_nane)&&(this._f_nane&&(e=this._f_nane),this._l_nane&&(e&&(e+=" "),e+=this._l_nane)),!e&&this._identifier&&(e=this._identifier),e}get f_name(){return this._f_nane}get p_pix(){return ServerPaths.getProfilePixPath(this._p_pix)}get lastSeen(){return this._lastSeen}get type(){return this._type}set isOnline(e){}set userID(e){}set type(e){}set identifier(e){}set name(e){}set f_name(e){}set p_pix(e){this._p_pix=e}set lastSeen(e){this._lastSeen=e||null}}class MyProfileInstance extends ProfileInstance{constructor(){super()}got_profile=!1;async fetch(e){let t=await ProfileAPI.fetchMyProfile(e);return!!t&&(this.got_profile=!0,this._userID=t.id,this._type=t.type,this._f_nane=t.f_nane,this._l_nane=t.l_nane,this._identifier=t.identifier,this._p_pix=t.p_pix,this._lastSeen=t.last_seen,!0)}}class ProfilesDBInstance{constructor(){this._profiles={}}get profiles(){return this._profiles}set profiles(e){}get adminCount(){return this._adminCount}set adminCount(e){}_gotAdmins=!1;_adminCount=0;getAdminProfilesFromDB=async(e=null)=>{if(this._gotAdmins&&!e)return!0;let t=!0;if(e||(e=await ProfileAPI.fetchAllAdminProfile()),e||(t=!1),t){const s=e.admins,a=e.count;s.length?this._adminCount=a:t=!1,s.forEach((e=>{this.addProfile(e)}))}return t};getProfileByIdFormDB=async e=>{const t=await ProfileAPI.getById(e);t&&this.addProfile(t)};getAdminProfiles=()=>Object.values(this.profiles).filter((e=>"admin"==e.type));getOnlineStatsForNullStats=async()=>{const e=Object.values(this.profiles).filter((e=>null==e.lastSeen)),t=[];e.forEach((e=>{t.push(e.userID)}));const s=await ProfileAPI.fetchProfileListLastSeen(t);s&&s.forEach((e=>{this.profiles[e.id].lastSeen=e.last_seen}))};addProfile(e){e.userID=e.id,this.profiles[e.userID]=new ProfileInstance(e)}isOnline=e=>this.profiles[e].isOnline;setP_pix(e,t){this.profiles[e].p_pix=t}setName(e,t){this.profiles[e].name=t}setLastSeen(e,t){this.profiles[e].lastSeen=t}getP_pix(e){return this.profiles[e].p_pix}getName(e){return this.profiles[e].name}getLastSeen(e){return this.profiles[e].lastSeen}isOnline(e){return"online"==this.profiles[e].lastSeen}profileObjIsAvailable(e){let t=this.profiles[e];return!!t&&!!t.userID}setAllLastSeenToNull=()=>{Object.values(this.profiles).forEach((e=>{e.lastSeen=null}))};recieveNameChangeSignal(e,t){const s=this.profiles[e].chatID;this.setName(e,t),ChatFuncs.updateChatName(s)}recieveP_pixChangeSignal(e,t){const s=this.profiles[e].chatID;this.setP_pix(e,t),ChatFuncs.updateChatImage(s)}}const MyProfile=new MyProfileInstance,ProfilesDB=new ProfilesDBInstance;class MessageBodyDOM{static create(){let e=document.createElement("div");e.id="messageBody";let t={messageBody:e};return OnloadActivations.messageBodyActivations(t),e}static append(e){const t=DOMGetter.getMessage();if(t)t.appendChild(e);else{let e="messageElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static clear(){let e=DOMGetter.getMessageBody().children;if(e){let t=e.length;for(let s=0;s<t;s++)e[0].parentNode.removeChild(e[0])}else{let e="msgBodyElems not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static appendElemBeforeElem(e,t){if(!e){let e="incomplete elements parameter",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}if(!t){let e="incomplete elements parameter",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}const s=t.parentElement;if(s)s.insertBefore(e,t);else{let e="elems parents dont match",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static markAsSelected(e,t){let s=e.getElementsByClassName("selected")[0],a=e.getElementsByClassName("Megchecked")[0],n=a.getElementsByTagName("input")[0];if(s){let e=s.dataset.id;MessageFuncs.msgIsDeleting(t,e)||s.classList.add("s")}if(a){let e=a.dataset.id;MessageFuncs.msgIsDeleting(t,e)||n.setAttribute("checked","true")}}}class MsgDateDOM{static create(e,t=!1){let s=document.createElement("div");return t?s.id="msgDate":(s.className="msgDate",s.innerHTML=e),s}static append(e,t=!1){let s=DOMGetter.getMessageBody();if(t&&(s=DOMGetter.getMessage()),s)s.appendChild(e);else{let e="msgBOdyElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static deleteFirstOnPage(){const e=document.getElementsByClassName("msgDate")[0];if(e)e.parentElement.removeChild(e);else{let e="firstMsgDateElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}}class MsgWraperDOM{static create(e){const t=e.replyedMegObj,s=MsgBody.makeMsgIDUsable(e.msgID),a=e.isSender;let n,o=e.first;n=a?"sent":"recieved",o=o?" first":"";const l=document.createElement("div");e.isDeleting?l.className="msgWrapperNotActive "+n+o:l.className="msgWrapper "+n+o,l.id=s,l.dataset.id=s;let i=document.createElement("div");i.className="selected hover",i.dataset.id=s,i.setAttribute("name",s),l.appendChild(i);let r=document.createElement("div");r.className="Megchecked";let c=document.createElement("input");c.type="checkbox",r.dataset.id=s,r.setAttribute("name",s),r.appendChild(c),l.appendChild(r);let d=MsgWraperDOM.createMsgContainerElem(e,o,n,t);return l.appendChild(d),MsgGroupActivations.allMessageOntouchEvent(l),MsgGroupActivations.allMegSelectMoreOptions(l),l}static createNoUser(){let e=" first",t="recieved",s=document.createElement("div");s.className="msgWrapper "+t+e;let a=MsgWraperDOM.createMsgContainerElemNoUser(e,t);return s.appendChild(a),s}static getCounnt=()=>document.querySelectorAll(".msgWrapper, .msgWrapperNotActive").length;static getLastMsgElem=()=>{const e=document.querySelectorAll(".msgWrapper, .msgWrapperNotActive");return e[e.length-1]};static append(e,t=null){if(DOMGetter.getMessageBody())t||(t=MsgGroupContainDOM.getByMsgId(e.id)),t.querySelector(":scope > div").appendChild(e);else{let e="msgElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static replace(e,t){e=MsgBody.makeMsgIDUsable(e);const s=document.getElementById(e);if(!s){let e="msgElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}const a=s.parentElement;if(a)a.replaceChild(t,s);else{let e="parents elems do not match",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(e,t=!1){let s=e.msgID;if(s=MsgBody.makeMsgIDUsable(s),!s){let e="illegal first parameter",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}let a=document.getElementById(s);if(a){let s=a.parentNode;if(t)s.removeChild(a);else{let t=DeletedMsgDOM.create(e);s.replaceChild(t,a)}}else{let e="msgBodyDOM not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static createMsgContainerElem(e,t,s,a){const n=MsgBody.makeMsgIDUsable(e.msgID),o=e.msg,l=e.isSender,i=e.timeSentString,r=e.read,c=e.stared;let d=document.createElement("div");d.className="messageContainer "+s+t,d.dataset.id=n,d.setAttribute("name",n);let g=document.createElement("div");g.className="megMore",g.dataset.id=n,g.setAttribute("name",n);let h=createIcon("angle_down");if(h.classList.add("subMsgMore"),h.dataset.id=n,h.setAttribute("name",n),g.appendChild(h),d.appendChild(g),a){let e=MsgWraperDOM.createReplyedMegElem(n,a);d.appendChild(e)}let M=document.createElement("p");M.className="message",M.innerHTML=o,d.appendChild(M);let m=MsgWraperDOM.createTimeContainElem(i,r,c,l);return d.appendChild(m[0]),d.appendChild(m[1]),d}static createMsgContainerElemNoUser(e,t){const s=`Hi there! At ${Settings.AppName}, we help scale-ups grow without expanding their team. ðŸš€ Curious how we can assist you? Drop us a line!`;let a=document.createElement("div");a.className="messageContainer "+t+e;let n=document.createElement("p");return n.className="message",n.innerHTML=s,a.appendChild(n),a}static createReplyedMegElem(e,t){let s,a,n,o;a=t.isSender,a?(o="You",s="you"):(o=t.senderName,s="notYou"),n=t.msg,e=MsgBody.makeMsgIDUsable(e);let l=document.createElement("div");l.className="replyedMeg",l.dataset.id=e,l.setAttribute("name",e);let i=document.createElement("div");l.appendChild(i);let r=document.createElement("span");r.className=s,l.appendChild(r);let c=document.createElement("a");r=document.createElement("span"),r.className=s,r.innerHTML=o,c.appendChild(r);let d=document.createTextNode(n);return c.appendChild(d),l.appendChild(c),c.addEventListener("click",OtherFunctions.onclickReplyedMegLink),l}static createTimeContainElem(e,t,s,a){const n=Settings.MessageOptions;let o=[];let l=document.createElement("span");l.className="timeContainPlaceholder timeContain";let i,r=document.createElement("span");return r.className="timeContain",n.starMessage&&s&&(i=StarDOM.create(),l.appendChild(i),i=i.cloneNode(!0),r.appendChild(i)),i=document.createElement("span"),i.className="time",i.innerHTML=e,l.appendChild(i),i=i.cloneNode(!0),r.appendChild(i),a&&(i=createIcon({sent:"done",delivered:"done_all",read:"done_all"}[t]),i.classList.add("seen"),"read"==t&&i.classList.add({sent:"",delivered:"",read:"read"}[t]),l.appendChild(i),i=i.cloneNode(!0),r.appendChild(i)),o[0]=l,o[1]=r,o}static makeSelectable(e,t){if(!ChatFuncs.isActiveChat(e)){let e="chat no longer active",t="",s=MyCodeErr.announce(e,t,!1,!0);return void(s&&console.log(s))}t=MsgBody.makeMsgIDUsable(t);let s=document.getElementById(t);if(s)s.classList.remove("msgWrapperNotActive"),s.classList.add("msgWrapper");else{let e="error with msgWrapper",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static makeUnselectable(e,t){if(!ChatFuncs.isActiveChat(e)){let e="chat no longer active",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}t=MsgBody.makeMsgIDUsable(t);let s=document.getElementById(t);if(s)s.classList.remove("msgWrapper"),s.classList.add("msgWrapperNotActive");else{let e="error with msgWrapper",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static isSelectable(e){return!!e.classList.contains("msgWrapper")}}class MsgGroupContainDOM{static _processNoAdmin=e=>{const t=ProfilesDB.getAdminProfiles(),s=t.length,a=ProfilesDB.adminCount;e.classList.add("noAdm"),s>1&&e.style.setProperty("--extr",s-1);let n=0,o=s;a>3&&(o=2);let l="";for(;n<o;){const s=t[n],a=document.createElement("img");a.alt="pix",a.src=s.p_pix,e.appendChild(a),n&&(a.style.setProperty("--index",n),l+=", "),l+=s.f_name,n++}if(a>3){const t="+"+(a-o),s=document.createElement("span");s.style.setProperty("--index",n),s.innerHTML=t,e.appendChild(s),l+=`, ${t} more`}return l};static createNoser=(e=!1)=>{const t=document.createElement("div");t.className="msgGroupContain recieved";const s=document.createElement("span");this._processNoAdmin(s),t.append(s);const a=document.createElement("div");return t.append(a),e&&DOMGetter.getMessageBody().appendChild(t),t};static create=(e,t=!1)=>{let s;s=e.isSender?"sent":"recieved";const a=document.createElement("div");a.className="msgGroupContain "+s;const n=document.createElement("span"),o=document.createElement("img");o.src=e.imgSrc(),n.append(o),a.append(n);const l=document.createElement("div");return a.append(l),t&&DOMGetter.getMessageBody().appendChild(a),a};static getByMsgId=(e,t=!1)=>{const s=MessageFuncs.getMessageObj(ChatFuncs.getActiveChat(),e);return MsgGroupContainDOM.getByMsgObject(s,t)};static getByMsgObject=(e,t=!1)=>MsgGroupContainDOM.create(e,t);static getFirstGroupConatinFromDOM=()=>{const e=DOMGetter.getMessageBody();if(e)return e.querySelector(":scope div.msgGroupContain")};static getLastGroupConatinFromDOM=(e=!1)=>{const t=DOMGetter.getMessageBody();if(!t)return;const s=t.querySelectorAll(":scope > .msgGroupContain"),a=s[s.length-1];return e?a.querySelector(":scope > div > *:last-child"):a};static appendElemTop=(e,t)=>{const s=(t=t.querySelector(":scope > div")).querySelector(":scope > *");s?t.insertBefore(e,s):t.appendChild(e)}}class MsgSendingWraperDOM{static create(e){const t=e.rMsg,s=e.msgSendingID;let a="sent",n=document.createElement("div");n.className="msgSendingWrapper "+a,n.id=s,n.dataset.id=s;let o=MsgSendingWraperDOM.createMsgContainerElem(e,a,t);return n.appendChild(o),n}static append(e){const t=DOMGetter.getMessageBody();if(t)t.appendChild(e);else{let e="msgBodyElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(e){if(!e){let e="incomplete parameter",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}let t=document.getElementById(e);if(t)t.parentNode.removeChild(t);else{let e="msgBody not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static createMsgContainerElem(e,t,s){const a=e.msgSendingID,n=e.msg;let o=document.createElement("div");if(o.className="msgSendingContainer "+t,o.dataset.id=a,o.setAttribute("name",a),s){let e=MsgWraperDOM.createReplyedMegElem(a,s);o.appendChild(e)}let l=document.createElement("p");l.className="message",l.innerHTML=n,o.appendChild(l);let i=MsgSendingWraperDOM.createTimeContainElem();return o.appendChild(i[0]),o.appendChild(i[1]),o}static createTimeContainElem(){let e=[],t=document.createElement("span");t.className="timeContainPlaceholder timeContain";let s=document.createElement("span");s.className="timeContain";let a=document.createElement("i");return a.className="my_icon msgSending",a.innerHTML=icons.sync,t.appendChild(a),a=a.cloneNode(!0),s.appendChild(a),e[0]=t,e[1]=s,e}static convertToMsg(e,t){const s=document.getElementById(e);if(!s)return!1;const a=s.parentElement;return!!a&&(a.replaceChild(t,s),!0)}}class DeletedMsgDOM{static create(e){let t=e.isSender,s=e.first,a=e.deletedText;if(null==t||null==s){let e="Incomplete parameter",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}t=t?"sent":"recieved",s=s?" first":"";let n=document.createElement("div");n.className="msgWrapper "+t+s;let o=document.createElement("div");return o.className="delMsgContainer "+t+s,o.innerHTML=a,n.appendChild(o),n}static append(e,t=null){MsgWraperDOM.append(e,t)}}class StarDOM{static create(){let e=createIcon("star");return e.classList.add("stared"),e}static append(e,t){e=MsgBody.makeMsgIDUsable(e);let s=document.getElementById(e);if(s){let e=s.getElementsByClassName("timeContain");for(let s=0;s<e.length;s++){let a=e[s].children[0];e[s].insertBefore(t,a),t=t.cloneNode(!0)}}else{let e="msgBodyElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(e){e=MsgBody.makeMsgIDUsable(e);let t=document.getElementById(e);if(t){let e=t.getElementsByClassName("stared"),s=e.length;for(let t=0;t<s;t++)e[0].parentNode.removeChild(e[0])}else{let e="msgBodyElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}}class MsgMoreOptionsDOM{static create(e,t=null){e=MsgBody.makeMsgIDUsable(e);const s=Settings.MessageOptions;t||(t=ChatFuncs.getActiveChat());const a=MessageFuncs.getMessageObj(t,e),n=a.stared,o=a.isSender;let l;l=n?"Unstar":"Star";const i=document.createElement("div");i.className="megMoreOptions",i.dataset.id=e,i.setAttribute("name",e);let r=[];s.replyMessage&&r.push(["replyThisMessage","Reply"]),s.messageInfo&&r.push(["thisMessageInfo","Info"]),s.fowardMessage&&r.push(["fowardThisMessage","Foward"]),s.starMessage&&r.push(["starThisMessage",l]),s.deleteMessage&&r.push(["deleteThisMessage","Delete"]),s.selectMessage&&r.push(["selectThisMessage","Select"]),r.forEach((e=>{let t=!0;if("thisMessageInfo"!=e[0]||o||(t=!1),t){let t=document.createElement("p");t.className=e[0],t.innerHTML=e[1],i.appendChild(t)}})),MsgMoreOptionsDOM.onload(i,t,e);const c=document.createElement("div");return c.className="megMoreOptionsBackground",c.dataset.id=e,c.setAttribute("name",e),c.appendChild(i),c}static append(e,t){e=MsgBody.makeMsgIDUsable(e);const s=document.getElementById(e);if(s){const e=s.getElementsByClassName("megMore")[0],a=e.parentElement,n=e.nextElementSibling;n?a.insertBefore(t,n):a.appendChild(t)}}static delete(e,t=!1){let s;if(t)s=e;else{e=MsgBody.makeMsgIDUsable(e);const t=document.getElementById(e);if(t){if(s=t.getElementsByClassName("megMoreOptionsBackground")[0],!s){let e="msgMoreOptionElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}}else{let e="msgWrapperElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}s.parentElement.removeChild(s)}static onload(e,t,s){const a=e.getElementsByClassName("selectThisMessage")[0],n=e.getElementsByClassName("replyThisMessage")[0],o=e.getElementsByClassName("thisMessageInfo")[0],l=e.getElementsByClassName("fowardThisMessage")[0],i=e.getElementsByClassName("starThisMessage")[0],r=e.getElementsByClassName("deleteThisMessage")[0];a&&a.addEventListener("click",MsgOptions.selectThisMessage),n&&n.addEventListener("click",MsgOptions.replyThisMessage),o&&o.addEventListener("click",MsgOptions.getThisMessageInfo),l&&l.addEventListener("click",MsgOptions.fowardThisMessage),i&&(MessageFuncs.msgIsDeleting(t,s)?MsgMoreOptionsDOM.makeOptionUclickale(0,0,0,i):i.addEventListener("click",MsgOptions.starThisMessage)),r&&(MessageFuncs.msgIsDeleting(t,s)?MsgMoreOptionsDOM.makeOptionUclickale(0,0,0,r):r.addEventListener("click",MsgOptions.deleteThisMessage))}static makeOptionUclickale(e,t,s,a){if(!a){if(t=MsgBody.makeMsgIDUsable(t),!ChatFuncs.isActiveChat(e)){let e="chat no longer active",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const n={reply:"replyThisMessage",info:"thisMessageInfo",fow:"fowardThisMessage",star:"starThisMessage",del:"deleteThisMessage",sel:"selectThisMessage"};let o=document.getElementById(t);if(!o){let e="msgContainDOM not found",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}if(!o.getElementsByClassName("megMoreOptions")[0])return;a=megMoreOptions.getElementsByClassName(n[s])[0]}a&&(a.classList.add("processing"),a.classList.contains("replyThisMessage")&&a.removeEventListener("click",MsgOptions.replyThisMessage),a.classList.contains("thisMessageInfo")&&a.removeEventListener("click",MsgOptions.getThisMessageInfo),a.classList.contains("fowardThisMessage")&&a.removeEventListener("click",MsgOptions.fowardThisMessage),a.classList.contains("starThisMessage")&&a.removeEventListener("click",MsgOptions.starThisMessage),a.classList.contains("deleteThisMessage")&&a.removeEventListener("click",MsgOptions.deleteThisMessage),a.classList.contains("selectThisMessage")&&a.removeEventListener("click",MsgOptions.selectThisMessage))}static makeOptionClickale(e,t,s,a){if(ChatFuncs.isActiveChat(e)){if(!a){const e={reply:"replyThisMessage",info:"thisMessageInfo",fow:"fowardThisMessage",star:"starThisMessage",del:"deleteThisMessage",sel:"selectThisMessage"};t=MsgBody.makeMsgIDUsable(t);let n=document.getElementById(t);if(!n){let e="msgContainDOM not found",t="",s=MyCodeErr.announce(e,t,!1,!0);return void(s&&console.log(s))}if(!n.getElementsByClassName("megMoreOptions")[0])return;a=megMoreOptions.getElementsByClassName(e[s])[0]}a&&(a.classList.remove("processing"),a.classList.contains("replyThisMessage")&&a.addEventListener("click",MsgOptions.replyThisMessage),a.classList.contains("thisMessageInfo")&&a.addEventListener("click",MsgOptions.getThisMessageInfo),a.classList.contains("fowardThisMessage")&&a.addEventListener("click",MsgOptions.fowardThisMessage),a.classList.contains("starThisMessage")&&a.addEventListener("click",MsgOptions.starThisMessage),a.classList.contains("deleteThisMessage")&&a.addEventListener("click",MsgOptions.deleteThisMessage),a.classList.contains("selectThisMessage")&&a.addEventListener("click",MsgOptions.selectThisMessage))}else{let e="chat no longer active",t="",s=MyCodeErr.announce(e,t,!1,!0);s&&console.log(s)}}}class LoadOlderMsgsBtnDOM{static create(){let e=document.createElement("div");return e.id="loadOlderMsgsBtn",e.innerHTML="Older Messages",LoadOlderMsgsBtnDOM.onload(e),e}static append(e){const t=DOMGetter.getMessageBody();if(DOMGetter.getLoadOlderMsgsBtn()){let e="loadOlderMsgsBtnElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}if(!t){let e="msgBodyElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}const s=t.firstChild;if(s)t.insertBefore(e,s);else{let e="error getting positioning",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(){const e=DOMGetter.getMessageBody(),t=DOMGetter.getLoadOlderMsgsBtn();if(t)if(e)e.removeChild(t);else{let e="msgBodyElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}else{let e="loadOlderMsgsBtnElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static onload(e){e.addEventListener("click",LoadOlderMsgsBtnDOM.onclick)}static onclick(){const e=ChatFuncs.getActiveChat();MessageFuncs.pushInPreviousMsgs(e)}}class SelectAChatDOM{static create(){let e=document.createElement("div");e.className="selectAChatW",e.id="selectAChatW";let t=document.createElement("div");t.className="selectAChat",t.innerHTML="Slect a chat",e.appendChild(t);let s=document.createElement("div");return s.className="selectAChatBtn",s.innerHTML="Chats",e.appendChild(s),s.addEventListener("click",MessageHeadNormalDOM.onclickMessageChatMaximizeBotton),e}static append(e){const t=DOMGetter.getMessage();if(t)t.appendChild(e);else{let e="messageElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(){MsgSectionDOM.clear()}}class UpdateMsgDOM{static starElem(e,t){if(t=MsgBody.makeMsgIDUsable(t),!ChatFuncs.isActiveChat(e))return;const s=document.getElementById(t);if(!s)return;const a=s.getElementsByClassName("messageContainer")[0].getElementsByClassName("stared")[0];MessagesDB.getStaredStatus(e,t)?a||StarDOM.append(t,StarDOM.create()):a&&StarDOM.delete(t)}static readElem(e,t){t=MsgBody.makeMsgIDUsable(t);const s=ChatBody.makeChatID_DB_Usable(e);if(!ChatFuncs.isActiveChat(s))return;if(!MessagesDB.userIsSender(s,t))return;const a=document.getElementById(t);if(!a)return;const n={sent:"done",delivered:"done_all",read:"done_all"},o={sent:"",delivered:"",read:"read"},l=a.getElementsByClassName("messageContainer")[0].getElementsByClassName("seen"),i=MessagesDB.getReadStatus(s,t);for(let e=0;e<l.length;e++){const t=l[e];t.classList.remove(o.read),o[i]&&t.classList.add(o[i]),t.innerHTML=icons[n[i]]}if({chatID:s,msgID:t}==MessagesDB.msgInfoInView){const e=DOMGetter.getMsgInfoPopUp();if(e){const a=e.getElementsByClassName("messageContainer")[0].getElementsByClassName("seen"),l=MessagesDB.getReadStatus(s,t);for(let e=0;e<a.length;e++){const t=t[e];t.className.remove(o.read),t.className.add(o[l]),t.innerHTML=icons[n[l]]}}}}static deletedMsgElem(e,t){if(!ChatFuncs.isActiveChat(e))return;if(!document.getElementById(t))return;if(!MessagesDB.getMsgDelStatus(e,t))return;let s=MessagesDB.getMsgInstance(e,t);MsgWraperDOM.delete(s)}static messageHeadLastSeenElem(e){if(!ChatFuncs.isActiveChat(e))return;const t=ChatFuncs.getChatLastSeenString(e);document.getElementById("messageHeadNameTime")&&MessageHeadNormalDOM.deleteLastSeen(),t&&MessageHeadNormalDOM.appendLastSeen(MessageHeadNormalDOM.createLastSeen(t))}}class MsgApis{static fetchOldMsgs=async(e,t,s=null)=>{let a=null;const n=Settings.ApiSettings.messagesPerAPICall,o=new FormData;o.append("messagesPerLoad",n),o.append("chatID",e),o.append("last_id",t),s&&o.append("fetchToID",s);const l=await fetch(ServerPaths.getApiPath("fetch_older_msgs.php"),{method:"post",body:o});if(l.ok){const e=await l.json();e.isErr?alert(e.msg):a=e.messages}else alert("some error occured");return a};static starMsg(e,t){let s=[];if(t.forEach((t=>{MessageFuncs.msgIsStaring(e,t)||(MessageFuncs.setMsgIsStaring(e,t,!0),MsgMoreOptionsDOM.makeOptionUclickale(e,t,"star"),s.push(t))})),!s.length)return void console.log("err");let a=GenerateAPIRes.starMsgRes(e,s);a?ApiSuccess.starMsg(a):ApiFail.starMsg(e,s)}static deleteMsg(e,t,s){let a=[];if(t.forEach((t=>{MessageFuncs.msgIsDeleting(e,t)||(MessageFuncs.setMsgIsDeleting(e,t,!0),MsgMoreOptionsDOM.makeOptionUclickale(e,t,"del"),MsgWraperDOM.makeUnselectable(e,t),a.push(t))})),!a.length)return void console.log("err");let n=GenerateAPIRes.deleteMessageRes(e,a,s);n?ApiSuccess.deleteMsg(n):ApiFail.deleteMsg(e,a)}static sendNoUserFirstMsg=async e=>{if(!e)return null;const t=new FormData;t.append("msg",e);let s=null;const a=await fetch(ServerPaths.getApiPath("send_no_user_msg.php"),{method:"post",body:t});return a.ok?s=await a.json():alert("some error occured"),s};static getReadStatOfMsgFromList=async e=>{const t=new FormData;t.append("list",JSON.stringify(e));const s=await fetch(ServerPaths.getApiPath("fetch_msgs_stats_from_list.php"),{method:"post",body:t});let a=null;if(s.ok){const e=await s.json();e.isErr?alert(e.msg):a=e.data}else alert("some error occured");return a}}class ApiSuccess{static starMsg(e){let t=e.chatID;e.result.forEach((e=>{let s=e.msgID,a=e.starStatus;MessageFuncs.setMsgIsStaring(t,s,!1),MsgMoreOptionsDOM.makeOptionClickale(t,"star"),MessageFuncs.updateStaredStatus(t,s,a)}))}static deleteMsg(e){let t=e.chatID;e.delCodeNoArr.forEach((e=>{let s=e.msgID,a=e.delCodeNo;a?MessageFuncs.deleteMessage(t,s,a):(MessageFuncs.setMsgIsDeleting(t,s,!1),MsgMoreOptionsDOM.makeOptionClickale(t,s,"del"),MsgWraperDOM.makeSelectable(t,s),alert("chat not deleted"),console.log("chat not deleted"))}))}}class ApiFail{static starMsg(e,t){t.forEach((t=>{MessageFuncs.setMsgIsStaring(e,t,!1),MsgMoreOptionsDOM.makeOptionClickale(e,"star")}));let s=MyCodeErr.announce("Poor internet connection","");s&&console.log(s)}static deleteMsg(e,t){t.forEach((t=>{MessageFuncs.setMsgIsDeleting(e,t,!1),MsgMoreOptionsDOM.makeOptionClickale(e,t,"del"),MsgWraperDOM.makeSelectable(e,t)}));let s=MyCodeErr.announce("Poor internet connection","");s&&console.log(s)}}class MsgHeadSelecOpts{static replyMessages(){if(GlobalVars.selectedMessagesID.length>1){let e="please select only one message",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}if(!GlobalVars.selectedMessagesID.length){let e="no message selected",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}let e=GlobalVars.selectedMessagesID[0];MsgOptions.replyThisMessage(e),MsgGroupDeactivations.allSelected_Megchecked()}static deleteMessages(){let e=DOMGetter.getMousePositionBody(),t=DOMGetter.getChatMousePosBody(),s=DOMGetter.getDeleteMessageOption();if(e&&MousePositionBodyPopupDOM.delete(),t&&ChatMousePosBodyPopupDOM.delete(),s&&DeleteMessageOptionPopupDOM.delete(),!GlobalVars.selectedMessagesID.length){let e="no message selected",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}let a=!1,n=null,o="notYou";o=GlobalVars.msgSenderTracking.indexOf(o),o<=-1&&(a=!0),n=GlobalVars.selectedMessagesID.length>1?"Delete "+GlobalVars.selectedMessagesID.length+" Messages?":"Delete Message?",DeleteMessageOptionPopupDOM.append(DeleteMessageOptionPopupDOM.create(n,a));let l={styles:[["background","black"],["opacity","0.5"]]};MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create(l)),ChatMousePosBodyPopupDOM.append(ChatMousePosBodyPopupDOM.create(l))}static fowardMessages(){if(GlobalVars.selectedMessagesID.length)console.log("fowardMessages"),alert("function not available yet");else{let e="no message selected",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static copyMessages(){if(GlobalVars.selectedMessagesID.length)console.log("copyMessages"),alert("function not available yet");else{let e="no message selected",t="",s=MyCodeErr.announce(e,t,!0);s&&console.log(s)}}static starMessages(){const e=ChatFuncs.getActiveChat();if(!GlobalVars.selectedMessagesID.length){let e="no message selected",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}const t=[...GlobalVars.selectedMessagesID];MsgGroupDeactivations.allSelected_Megchecked(),MsgApis.starMsg(e,t)}static getMessagesInfo(){if(!GlobalVars.selectedMessagesID.length){let e="no message selected",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}if(GlobalVars.selectedMessagesID.length>1){let e="please select only one message",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}let e=GlobalVars.selectedMessagesID[0];MsgOptions.getThisMessageInfo(e),MsgGroupDeactivations.allSelected_Megchecked()}static activateMessageHeadOthersS(){console.log("activateMessageHeadOthersS"),alert("function not available yet")}}class MsgGroupDeactivations{static megSelectMoreOptions(){const e=DOMGetter.getMousePositionBody(),t=DOMGetter.getChatMousePosBody();e&&MousePositionBodyPopupDOM.delete(),t&&ChatMousePosBodyPopupDOM.delete(),ChatBoxDOM.tryUnhide();let s=document.getElementsByClassName("megMoreOptionsBackground")[0],a=s.previousElementSibling;a.getElementsByClassName("subMsgMore")[0].classList.remove("optionUp"),MsgMoreOptionsDOM.delete(s,!0),a.style.display="",a.addEventListener("click",MsgGroupActivations.megSelectMoreOptions)}static removeAllSelectedHoverEffect(){let e=document.getElementsByClassName("selected");for(let t=0;t<e.length;t++)e[t].classList.remove("hover")}static resetAllSelectedHoverEffect(){let e=document.getElementsByClassName("selected");for(let t=0;t<e.length;t++)e[t].classList.add("hover")}static allSelected_Megchecked(){let e=DOMGetter.getMessageHeadNormal(),t=DOMGetter.getMessageHeadSelected(),s=DOMGetter.getMessageHeadBack(),a=DOMGetter.getMessageHeadCount();ChatBoxDOM.tryUnhide(),MessageFuncs.setIsSelectingMsgs(!1);let n=document.getElementsByClassName("selected"),o=document.getElementsByClassName("Megchecked");for(let e=0;e<n.length;e++)n[e].removeEventListener("click",MsgBody.selectUnselectMessage),n[e].removeEventListener("touchstart",MsgBody.selectUnselectMessage),n[e].classList.remove("s"),n[e].style.display="";for(let e=0;e<o.length;e++)o[e].getElementsByTagName("input")[0].removeAttribute("checked"),o[e].style.display="";MsgBody.emptySelectedMessagesID(),MessageHeadSelectedDOM.clearIcons(),a.innerHTML=GlobalVars.selectedMessagesID.length,e.style.display="",t.style.display="",s.removeEventListener("click",MsgGroupDeactivations.allSelected_Megchecked),MsgGroupDeactivations.resetAllSelectedHoverEffect()}}class MsgOptions{static selectThisMessage(e){let t=DOMGetter.getMessageHeadCount();const s=ChatFuncs.getActiveChat();let a=e.target.parentElement.dataset.id;e.target.removeEventListener("click",MsgOptions.selectThisMessage),MsgBody.emptySelectedMessagesID(),MsgGroupActivations.allSelected_Megchecked(),MsgGroupDeactivations.megSelectMoreOptions();let n=MessageFuncs.getMsgSenderClass(s,a),o=document.getElementsByName(a)[0],l=document.getElementsByName(a)[1].getElementsByTagName("input")[0];MsgBody.updateSelectedMessagesID(a,n),t.innerHTML=GlobalVars.selectedMessagesID.length,o.classList.add("s"),l.setAttribute("checked","true")}static getThisMessageInfo(e){let t=DOMGetter.getMsgInfoPopUp(),s=e.target,a=!0;s?s=e.target.parentElement.dataset.id:(s=e,a=!1),a&&MsgGroupDeactivations.megSelectMoreOptions(),s=MsgBody.makeMsgIDUsable(s);let n=ChatFuncs.getActiveChat(),o=MessageFuncs.getMessageObj(n,s),l=document.getElementById(s);l=l.cloneNode(!0);let i=o.drtime;t&&MsgInfoPopUpDOM.delete(),MsgInfoPopUpDOM.append(MsgInfoPopUpDOM.create(l,i)),MessageFuncs.setMsgInfoInView(n,s),t=DOMGetter.getMsgInfoPopUp();let r=t.getElementsByClassName("body")[0],c=t.getElementsByClassName("head")[0],d=r.getBoundingClientRect().height,g=r.scrollHeight;if(g>d){let e=g-d;r.scrollTop=r.scrollTop+e,c.classList.add("bodyScrl")}}static replyThisMessage(e){const t=ChatFuncs.getActiveChat();let s=DOMGetter.getChatBox(),a=e.target,n=!0;a?a=e.target.parentElement.dataset.id:(a=e,n=!1);const o=MessageFuncs.getMessageObj(t,a);o.chatID||(o.chatID=t),ChatBoxDB.addRMsgObj(t,o);const l=ChatBoxDB.getRMsgObj(t);s?(s.getElementsByClassName("textMegContain")[0].getElementsByClassName("replyedMeg")[0]&&ChatboxReplyDOM.delete(),ChatboxReplyDOM.append(ChatboxReplyDOM.create(l))):(ChatBoxDOM.append(ChatBoxDOM.create()),s=DOMGetter.getChatBox()),n&&MsgGroupDeactivations.megSelectMoreOptions()}static fowardThisMessage(e){let t=e.target.parentElement.dataset.id;console.log(t),console.log("fowardThisMessage"),alert("function not available yet")}static starThisMessage(e){const t=ChatFuncs.getActiveChat(),s=[e.target.parentElement.dataset.id];MsgGroupDeactivations.megSelectMoreOptions(),MsgApis.starMsg(t,s)}static deleteThisMessage(e){let t=DOMGetter.getMousePositionBody(),s=DOMGetter.getChatMousePosBody(),a=DOMGetter.getDeleteMessageOption();t&&MousePositionBodyPopupDOM.delete(),s&&ChatMousePosBodyPopupDOM.delete(),a&&DeleteMessageOptionPopupDOM.delete();const n=ChatFuncs.getActiveChat();let o=e.target.parentElement.dataset.id,l=MessageFuncs.getMsgSenderClass(n,o);MsgBody.emptySelectedMessagesID(),MsgBody.updateSelectedMessagesID(o,l);let i=!1;"you"==l&&(i=!0),DeleteMessageOptionPopupDOM.append(DeleteMessageOptionPopupDOM.create("Delete Message?",i)),MsgGroupDeactivations.megSelectMoreOptions();let r={styles:[["background","black"],["opacity","0.5"]]};MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create(r)),ChatMousePosBodyPopupDOM.append(ChatMousePosBodyPopupDOM.create(r))}static deleteMessage(e,t=!1){const s=ChatFuncs.getActiveChat();let a=[...GlobalVars.selectedMessagesID];t&&MsgGroupDeactivations.allSelected_Megchecked(),MsgApis.deleteMsg(s,a,e)}static activateDeleteMessage(e){let t,s=DOMGetter.getMessageHeadSelected(),a=e.target.classList.contains("DFE"),n=!1;GlobalVars.msgSenderTracking.indexOf("notYou")<0&&(n=!0),t=n&&a,MsgOptions.cancleDeleteMessage(),"flex"!=s.style.display?MsgOptions.deleteMessage(t):MsgOptions.deleteMessage(t,!0)}static cancleDeleteMessage(e){let t=DOMGetter.getChatMousePosBody(),s=DOMGetter.getMousePositionBody(),a=DOMGetter.getDeleteMessageOption(),n=!0;if(e){n=!1;let t=e.target.id;t&&"deleteMessageOption"==t&&(n=!0);let s=e.target.classList;s&&s.contains("C")&&(n=!0)}n&&(t&&ChatMousePosBodyPopupDOM.delete(),s&&MousePositionBodyPopupDOM.delete(),a&&DeleteMessageOptionPopupDOM.delete())}}class ChatOptions{static selectThisChat(e){const t=DOMGetter.getChatHeadCount();let s=e.target.parentElement.dataset.id,a=e.target,n=document.getElementById(s),o=n.getElementsByClassName("chatSelect")[0],l=e.target.parentElement.previousElementSibling;if(o&&ChatSelectedIconDOM.delete(s),a.removeEventListener("click",ChatOptions.selectThisChat),ChatGroupActivations.allChatSelected(),ChatGroupDeactivations.chatExpandMoreOptions(),n.style.background="#F5F5F5",ChatSelectedIconDOM.append(s,ChatSelectedIconDOM.create()),l.style.display="none",ChatBody.emptySelectedChatsID(),ChatBody.updateSelectedChatsID(s))t.innerHTML=GlobalVars.selectedChatsID.length;else{let e="Fatal error",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static deleteThisChat(e){if(!Settings.ChatOptions.deleteChat){let e="action not allowed",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}let t=DOMGetter.getMousePositionBody(),s=DOMGetter.getChatMousePosBody(),a=DOMGetter.getDeleteChatOption();t&&MousePositionBodyPopupDOM.delete(),s&&ChatMousePosBodyPopupDOM.delete(),a&&DeleteChatOptionPopupDOM.delete(),ChatGroupDeactivations.chatExpandMoreOptions();let n=e.target.parentElement.dataset.id;ChatBody.emptySelectedChatsID(),ChatBody.updateSelectedChatsID(n),DeleteChatOptionPopupDOM.append(DeleteChatOptionPopupDOM.create("Delete this Chat?"));let o={styles:[["background","black"],["opacity","0.5"]]};MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create(o)),ChatMousePosBodyPopupDOM.append(ChatMousePosBodyPopupDOM.create(o))}static pinThisChat(e){if(!Settings.ChatOptions.pinChat){let e="action not allowed",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}ChatGroupDeactivations.chatExpandMoreOptions();let t=[e.target.parentElement.dataset.id];ChatApis.pinChat(t)}static deleteChat(e=!1){let t=[...GlobalVars.selectedChatsID];e&&ChatGroupDeactivations.allChatSelected(),ChatApis.deleteChat(t)}static onclickDeleteChat(){let e=DOMGetter.getChatHeadSelected();ChatOptions.cancleChatDelete(),"flex"!=e.style.display?ChatOptions.deleteChat():ChatOptions.deleteChat(!0)}static cancleChatDelete(e){let t=DOMGetter.getChatMousePosBody(),s=DOMGetter.getMousePositionBody(),a=DOMGetter.getDeleteChatOption(),n=!0;if(e){n=!1;let t=e.target.id;t&&"deleteChatOption"==t&&(n=!0);let s=e.target.classList;s&&s.contains("C")&&(n=!0)}n&&(t&&ChatMousePosBodyPopupDOM.delete(),s&&MousePositionBodyPopupDOM.delete(),a&&DeleteChatOptionPopupDOM.delete())}}class MousePositionBodyPopupDOM{static create(e=null){let t,s;e&&(t=e.styles,s=e.functs);let a=document.createElement("div");return a.id="mousePositionBody",t&&t.forEach((e=>{a.style[e[0]]=e[1]})),s&&s.forEach((e=>{a.addEventListener(e[0],e[1])})),a}static append(e){const t=DOMGetter.getPageSection();if(t){let s=t.children[0];t.insertBefore(e,s)}else{let e="pageSection not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getMousePositionBody();if(e)e.parentNode.removeChild(e);else{let e="mousePositionBody not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ShowProfilePicturePopupDOM{static create(e){let t=document.createElement("div");t.id="showProfilePicture";let s=createIcon("close");s.classList.add("close"),t.appendChild(s);let a=document.createElement("img");a.src=e,a.alt="pix",t.appendChild(a),t.style.display="flex";let n={close:s};return ShowProfilePicturePopupDOM.onload(n),t}static append(e){const t=DOMGetter.getPageSection();if(t)t.appendChild(e);else{let e="pageSection not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getShowProfilePicture();if(e)e.parentNode.removeChild(e);else{let e="showProfilePicture not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static onload(e){const t=e.close;t&&t.addEventListener("click",ProfileFunc.closeProfilePictureView)}}class DeleteMessageOptionPopupDOM{static create(e,t=!1){let s,a=document.createElement("div");a.id="deleteMessageOption";let n=document.createElement("span");s=document.createElement("div");let o=document.createElement("span");o.className="D",o.innerHTML=e,s.appendChild(o),n.appendChild(s),s=document.createElement("div");let l=document.createElement("span");l.className="action DFM",l.innerHTML="DELETE FOR ME",s.appendChild(l),n.appendChild(s);let i=null;t&&(s=document.createElement("div"),i=document.createElement("span"),i.className="action DFE",i.innerHTML="DELETE FOR EVERYONE",s.appendChild(i),n.appendChild(s)),s=document.createElement("div");let r=document.createElement("span");r.className="action C",r.innerHTML="CANCLE",s.appendChild(r),n.appendChild(s),a.appendChild(n);let c={DFM:l,DFE:i,cancle:r,deleteMessageOption:a};return DeleteMessageOptionPopupDOM.onload(c),a}static append(e){const t=DOMGetter.getPageSection();if(t)t.appendChild(e);else{let e="pageSection not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getDeleteMessageOption();if(e)e.parentNode.removeChild(e);else{let e="deleteMessageOption not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static onload(e){const t=e.DFM,s=e.DFE,a=e.cancle,n=e.deleteMessageOption;t&&t.addEventListener("click",MsgOptions.activateDeleteMessage),s&&s.addEventListener("click",MsgOptions.activateDeleteMessage),a&&a.addEventListener("click",MsgOptions.cancleDeleteMessage),n&&n.addEventListener("click",MsgOptions.cancleDeleteMessage)}}class MsgInfoPopUpDOM{static create(e,t){let s=t[0],a=t[1];a||(a="-"),s||(s="-");let n=document.createElement("div");n.id="msgInfoPopUp";let o=document.createElement("div");o.className="head";let l=createIcon("arrow_back");l.classList.add("back"),o.appendChild(l);let i=document.createElement("span");i.className="title",i.innerHTML="Message info",o.appendChild(i),n.appendChild(o);let r=document.createElement("div");r.className="body";let c,d,g=document.createElement("div");g.className="MIPMsg",g.appendChild(e),r.appendChild(g);let h=document.createElement("div");h.className="MIPSta";let M=document.createElement("div");M.className="MIPRead",i=document.createElement("div"),i.className="title",c=createIcon("done_all"),c.classList.add("read"),i.appendChild(c),c=document.createElement("span"),c.innerHTML="Read",i.appendChild(c),M.appendChild(i),d=document.createElement("div"),d.className="time",d.innerHTML=a,M.appendChild(d),h.appendChild(M);let m=document.createElement("hr");h.appendChild(m);let u=document.createElement("div");u.className="MIPDeliver",i=document.createElement("div"),i.className="title",c=createIcon("done_all"),c.classList.add("read"),i.appendChild(c),c=document.createElement("span"),c.innerHTML="Delivered",i.appendChild(c),u.appendChild(i),d=document.createElement("div"),d.className="time",d.innerHTML=s,u.appendChild(d),h.appendChild(u),r.appendChild(h),n.appendChild(r);let C={body:r,back:l};return MsgInfoPopUpDOM.onload(C),n}static append(e){const t=DOMGetter.getPageSection();if(t)t.appendChild(e);else{let e="pageSection not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getMsgInfoPopUp();if(e)e.parentNode.removeChild(e);else{let e="msgInfoPopUp not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static onload(e){const t=e.body,s=e.back;t&&t.addEventListener("scroll",MsgInfoPopUpDOM.scrlFunc),s&&s.addEventListener("click",MsgInfoPopUpDOM.delete)}static scrlFunc(){let e=DOMGetter.getMsgInfoPopUp(),t=e.getElementsByClassName("body")[0],s=e.getElementsByClassName("head")[0];t.scrollTop?s.classList.add("bodyScrl"):s.classList.remove("bodyScrl")}}class ChatMousePosBodyPopupDOM{static create(e=null){let t,s;e&&(t=e.styles,s=e.functs);let a=document.createElement("div");return a.id="chatMousePosBody",t&&t.forEach((e=>{a.style[e[0]]=e[1]})),s&&s.forEach((e=>{a.addEventListener(e[0],e[1])})),a}static append(e){const t=DOMGetter.getChat();if(t){let s=t.children[0];t.insertBefore(e,s)}else{let e="chatDom not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getChatMousePosBody();if(e)e.parentNode.removeChild(e);else{let e="chatMousePosBody not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class DeleteChatOptionPopupDOM{static create(e){let t,s=document.createElement("div");s.id="deleteChatOption";let a=document.createElement("span");t=document.createElement("div");let n=document.createElement("span");n.className="D",n.innerHTML=e,t.appendChild(n),a.appendChild(t),t=document.createElement("div");let o=document.createElement("span");o.className="action Del",o.innerHTML="DELETE",t.appendChild(o),a.appendChild(t),t=document.createElement("div");let l=document.createElement("span");l.className="action C",l.innerHTML="CANCLE",t.appendChild(l),a.appendChild(t),s.appendChild(a);let i={Del:o,cancle:l,deleteChatOption:s};return DeleteChatOptionPopupDOM.onload(i),s}static append(e){const t=DOMGetter.getPageSection();if(t)t.appendChild(e);else{let e="pageSection not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getDeleteChatOption();if(e)e.parentNode.removeChild(e);else{let e="deleteChatOption not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static onload(e){const t=e.Del,s=e.cancle,a=e.deleteChatOption;t&&t.addEventListener("click",ChatOptions.onclickDeleteChat),s&&s.addEventListener("click",ChatOptions.cancleChatDelete),a&&a.addEventListener("click",ChatOptions.cancleChatDelete)}}class ChatHeadSelecOpts{static pinChats(){if(!Settings.ChatOptions.groupChatPin){let e="action not allowed",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}if(!GlobalVars.selectedChatsID.length){let e="no chat selected";return alert(e),void console.log(e)}let e=[...GlobalVars.selectedChatsID];ChatGroupDeactivations.allChatSelected(),ChatBody.emptySelectedChatsID(),ChatApis.pinChat(e)}static deleteChats(){if(!Settings.ChatOptions.groupDelChat){let e="action not allowed",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}let e=DOMGetter.getMousePositionBody(),t=DOMGetter.getChatMousePosBody(),s=DOMGetter.getDeleteChatOption();if(e&&MousePositionBodyPopupDOM.delete(),t&&ChatMousePosBodyPopupDOM.delete(),s&&DeleteChatOptionPopupDOM.delete(),!GlobalVars.selectedChatsID.length){let e="no chat selected",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}let a="Delete "+GlobalVars.selectedChatsID.length+" Chats?";DeleteChatOptionPopupDOM.append(DeleteChatOptionPopupDOM.create(a));let n={styles:[["background","black"],["opacity","0.5"]]};MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create(n)),ChatMousePosBodyPopupDOM.append(ChatMousePosBodyPopupDOM.create(n))}static activateChatHeadOthersS(){console.log("activateChatHeadOthersS"),alert("function not available yet")}}class ChatHeadDOM{static create(){let e=document.createElement("div");return e.id="chatHead",e}static append(e){const t=DOMGetter.getChat();if(t)t.appendChild(e);else{let e="chatDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getChatHead();if(e)e.parentNode.removeChild(e);else{let e="chatHeadDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ChatHeadNormalDOM{static create(e,t=!1){const s=document.createElement("div");s.id="chatHeadNormal";const a=createIcon("close");a.id="chatChatMinimize",s.appendChild(a);const n=document.createElement("div");n.id="chatHeadPix";let o=document.createElement("img");o.src=e,o.alt="pix",n.appendChild(o),s.appendChild(n);const l=document.createElement("span");l.innerHTML="You",n.appendChild(l);const i=document.createElement("div");i.id="chatSubContain";let r=null;Settings.ChatOptions.chatChat&&(r=createIcon("chat"),r.id="chatHeadChat",i.appendChild(r));let c=null;Settings.ChatOptions.searchChat&&(c=createIcon("search"),c.id="chatHeadSearchChat",i.appendChild(c));let d=null;Settings.ChatOptions.more_chatOptions&&(d=createIcon("more_vert"),d.id="chatHeadOthers",i.appendChild(d));let g=null;t&&(g=createIcon("new_chat"),g.id="addNeewChart",i.appendChild(g));const h=document.createElement("div");h.id="chatHeadOthersOptions",h.className="hide";const M=document.createElement("p");M.className="chatHeadOptionSelect",M.innerHTML="Select",h.appendChild(M),i.appendChild(h);const m={chatChatMinimize:a,chatHeadChat:r,chatHeadSearchChat:c,chatHeadOthers:d,chatHeadPix:n,addNeewChart:g};return OnloadActivations.chatHeadNormalElem(m),s.appendChild(i),s}static append(e){const t=DOMGetter.getChatHead();if(t)t.appendChild(e);else{let e="chatHeadDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getChatHeadNormal();if(e)e.parentNode.removeChild(e);else{let e="chatHeadNormaldDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static onclickChatMinimizeBotton(){const e=DOMGetter.getChat(),t=DOMGetter.getMessage(),s=DOMGetter.getMsgSelectAChat();t.classList.add("hide_side"),e.classList.add("hide"),s&&(s.getElementsByClassName("selectAChatBtn")[0].style.display="flex")}}class ChatHeadSelectedDOM{static create(){let e=document.createElement("div");e.id="chatHeadSelected";let t=createIcon("arrow_back");t.id="chatHeadBack",e.appendChild(t);let s=document.createElement("div");return s.id="chatHeadCount",s.className="flexCenter",s.innerHTML="0",e.appendChild(s),e}static append(e){const t=DOMGetter.getChatHead();if(t)t.appendChild(e);else{let e="chatHeadDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getChatHeadSelected();if(e)e.parentNode.removeChild(e);else{let e="chatHeadSelectedDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static loadIcons(e=null){const t=Settings.ChatOptions;if(e||(e=DOMGetter.getChatHeadSelected()),t.pinChat){let t=ChatHeadSelectedDOM.createChatPinIcon();e.appendChild(t)}if(t.deleteChat){let t=ChatHeadSelectedDOM.createChatDelIcon();e.appendChild(t)}let s=createIcon("more_vert");return s.id="chatHeadOthersS",s.addEventListener("click",ChatHeadSelecOpts.activateChatHeadOthersS),e.appendChild(s),e}static clearIcons(){let e=DOMGetter.getChatHeadPin(),t=DOMGetter.getChatHeadDelete(),s=DOMGetter.getChatHeadOthersS();e&&ChatHeadSelectedDOM.deleteIcon(e),t&&ChatHeadSelectedDOM.deleteIcon(t),s&&ChatHeadSelectedDOM.deleteIcon(s)}static createChatPinIcon(){let e=createIcon("chatPinnedSAV");return e.id="chatHeadPin",e.addEventListener("click",ChatHeadSelecOpts.pinChats),e}static createChatDelIcon(){let e=createIcon("delete");return e.id="chatHeadDelete",e.addEventListener("click",ChatHeadSelecOpts.deleteChats),e}static appendIcon(e){const t=DOMGetter.getChatHeadSelected();if(!t){let e="chatHeadSelectedDOM not found",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const s=DOMGetter.getChatHeadOthersS();s?t.insertBefore(e,s):t.appendChild(e)}static deleteIcon(e){if(!e){let e="iconElem not found",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const t=e.parentElement;if(t)if("chatHeadSelected"==t.id)t.removeChild(e);else{let e="got the wrong element",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}else{let e="chatHeadSelectedDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ChatGroupDeactivations{static chatExpandMoreOptions(){const e=DOMGetter.getMousePositionBody(),t=DOMGetter.getChatMousePosBody();e&&MousePositionBodyPopupDOM.delete(),t&&ChatMousePosBodyPopupDOM.delete();let s=document.getElementsByClassName("chatMoreOptions")[0].previousElementSibling,a=s.dataset.id;ChatMoreOptionsDOM.delete(a),s.style.display=""}static removeAllChatHoverEffect(){let e=document.getElementsByClassName("chatContain");for(let t=0;t<e.length;t++)e[t].classList.remove("hover")}static resetAllChatHoverEffect(){let e=document.getElementsByClassName("chatContain");for(let t=0;t<e.length;t++)e[t].classList.add("hover")}static allChatSelected(){GlobalVars.chatsAreSelected=!1;const e=DOMGetter.getChatHeadBack(),t=DOMGetter.getChatHeadCount(),s=DOMGetter.getChatHeadNormal(),a=DOMGetter.getChatHeadSelected();ChatBoxDOM.tryUnhide(),ChatFuncs.setIsSelectingChats(!1);let n=document.getElementsByClassName("chatSelected"),o=document.getElementsByClassName("chatContain"),l=document.getElementsByClassName("chatExpandMore");for(let e=0;e<l.length;e++)l[e].style.display="";for(let e=0;e<o.length;e++){let t=o[e].getElementsByClassName("chatSelect")[0];o[e].style.background="";let s=o[e].id;t&&ChatSelectedIconDOM.delete(s)}for(let e=0;e<n.length;e++)n[e].removeEventListener("click",ChatBody.selectUnselectChat),n[e].removeEventListener("touchstart",ChatBody.selectUnselectChat),n[e].style.display="";ChatHeadSelectedDOM.clearIcons(),ChatBody.emptySelectedChatsID(),t.innerHTML=GlobalVars.selectedChatsID.length,s.style.display="",a.style.display="",e.removeEventListener("click",ChatGroupDeactivations.allChatSelected)}}class ChatBodyDOM{static _processNoAdmin=e=>{const t=ProfilesDB.getAdminProfiles(),s=t.length,a=ProfilesDB.adminCount;s>1&&e.style.setProperty("--extr",s-1),a>1&&(a>2?e.classList.add("tri"):e.classList.add("two"));let n=0,o=s;a>3&&(o=2);let l="";for(;n<o;){const s=t[n],a=document.createElement("img");a.alt="pix",a.src=s.p_pix,a.dataset.no_adm=1,e.appendChild(a),n&&(a.style.setProperty("--index",n),l+=", "),l+=s.f_name,n++}if(a>3){const t="+"+(a-o),s=document.createElement("span");s.style.setProperty("--index",n),s.innerHTML=t,e.appendChild(s),l+=`, ${t} more`}return l};static create(){let e=document.createElement("div");return e.id="chatBody",e.className="chatBody",e}static append(e){const t=DOMGetter.getChat();if(t)t.appendChild(e);else{let e="chatDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getChatBody();if(e)e.parentNode.removeChild(e);else{let e="chatBodyDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static clear(){let e=DOMGetter.getChatBody().children;if(e){let t=e.length;for(let s=0;s<t;s++)e[0].parentNode.removeChild(e[0])}else{let e="allChatBodyContent undefined",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ChatContainDOM{static create(e){let t=e.chatID,s="",a=e.unreadMsgCount,n=e.pined,o=e.lastMsgObj,l=o.timeSentString;t=ChatBody.makeChatIDUsable(t);let i=document.createElement("div");e.isDeleting?i.className="chatContainNotActive hover":i.className="chatContain hover",i.id=t,i.dataset.id=t;let r=document.createElement("div");r.className="chatSelected",r.dataset.id=t,r.setAttribute("name",t),i.appendChild(r);let c=document.createElement("div");if(c.className="chatPix",e.hadAdmin()||MyProfile.isAdmin()){s=e.name;let t=document.createElement("img");t.src=e.imgSrc,t.alt="pix",c.appendChild(t)}else s=ChatBodyDOM._processNoAdmin(c);if(i.appendChild(c),e.chatIsOnline){let e=document.createElement("span");e.className="online",c.appendChild(e),e.style.display="block"}let d=document.createElement("div");d.className="chatSubContain";let g=document.createElement("div");g.className="nameContain";let h=document.createElement("div");h.className="nameSubContain",h.innerHTML=s,g.appendChild(h);let M=document.createElement("div");M.className="chatTimeContain",M.innerHTML=l,g.appendChild(M),d.appendChild(g);let m=ChatContainDOM.createLMegContainElem(t,a,n,o);return d.appendChild(m),i.appendChild(d),ChatGroupActivations.allChatsFunctions(i),ChatGroupActivations.allChatOntouchEvent(i),i}static append(e){const t=DOMGetter.getChatBody();if(t)t.appendChild(e);else{let e="chatBodyDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(e,t=!1){e=ChatBody.makeChatIDUsable(e);let s=document.getElementById(e);if(s)s.parentNode.removeChild(s);else if(!t){let e="error with chatContain",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static createLMegContainElem(e,t,s,a){const n=Settings.ChatOptions;e=ChatBody.makeChatIDUsable(e);let o="",l="",i=a.read,r=a.lastMsg,c=a.isSender;"read"==i&&(o="read"),l="sent"==i?"done":"done_all";let d=document.createElement("div");d.className="lMegContain";let g=document.createElement("div");if(g.className="lMegContain1",c){let e=LMegReadDOM.create(o,l);g.appendChild(e)}let h=document.createElement("div");h.className="lMeg",h.innerHTML=r,g.appendChild(h),d.appendChild(g);let M=document.createElement("div");if(M.className="lMegContain2",n.pinChat&&s){let e=ChatPinedDOM.create();M.appendChild(e)}if(t){let e=ChatCountDOM.create(t);M.appendChild(e)}let m=null;return n.chatOptions&&(m=createIcon("angle_down"),m.classList.add("chatExpandMore"),m.dataset.id=e,m.setAttribute("name",e),M.appendChild(m)),d.appendChild(M),d}static getAllChatContains(){const e=DOMGetter.getChatBody();return e?e.querySelectorAll(".chatContain"):[]}static getCountChatContains(){return ChatContainDOM.getAllChatContains().length}static makeSelectable(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(t)t.classList.remove("chatContainNotActive"),t.classList.add("chatContain");else{let e="error with chatContain",t="",s=MyCodeErr.announce(e,t,!1,!0);s&&console.log(s)}}static makeUnselectable(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(t)t.classList.remove("chatContain"),t.classList.add("chatContainNotActive");else{let e="error with chatContain",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static isSelectable(e){return!!e.classList.contains("chatContain")}}class ChatPinedDOM{static create(){if(!Settings.ChatOptions.pinChat){let e="pin chat action is not allowed",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}let e=createIcon("chatPinnedSAV");return e.classList.add("chatPined"),e}static append(e,t){if(!Settings.ChatOptions.pinChat){let e="pin chat action is not allowed",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}e=ChatBody.makeChatIDUsable(e);let s=document.getElementById(e);if(s){let e=s.getElementsByClassName("lMegContain2")[0],a=e.children[0];if(e)e.insertBefore(t,a);else{let e="lMegContain2DOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(t){let e=t.getElementsByClassName("lMegContain2")[0],s=e.getElementsByClassName("chatPined")[0];if(e&&s)e.removeChild(s);else{let e="lMegContain2DOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ChatCountDOM{static create(e=0){let t=document.createElement("div");return t.className="flexCenter chatCount",t.innerHTML=e,t}static append(e,t){e=ChatBody.makeChatIDUsable(e);let s=document.getElementById(e);if(s){let e=s.getElementsByClassName("lMegContain2")[0],a=e.getElementsByClassName("chatExpandMore")[0];if(e)e.insertBefore(t,a);else{let e="lMegContain2DOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(t){let e=t.getElementsByClassName("lMegContain2")[0],s=e.getElementsByClassName("chatCount")[0];if(e&&s)e.removeChild(s);else{let e="lMegContain2DOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class LoadOlderChatsDOM{static create(){let e=document.createElement("div");return e.id="getOlderChat",e.innerHTML="Older Chats",e.addEventListener("click",LoadOlderChatsDOM.onClick),e}static append(e){const t=DOMGetter.getChatBody();if(t)t.appendChild(e);else{let e="chatBodyDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getGetOlderChat();if(e)e.parentElement.removeChild(e);else{let e="getOlderDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static async onClick(){await ChatFuncs.fetchOlderChats()}}class ChatSelectedIconDOM{static create(){let e=createIcon("done");return e.classList.add("chatSelect"),e.style.display="flex",e}static append(e,t){e=ChatBody.makeChatIDUsable(e);let s=document.getElementById(e);if(s){let e=s.getElementsByClassName("chatPix")[0];if(e)e.appendChild(t);else{let e="chatPixDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(t){let e=t.getElementsByClassName("chatPix")[0],s=e.getElementsByClassName("chatSelect")[0];if(e&&s)s.parentElement.removeChild(s);else{let e="chatPixDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ChatOnlineIconDOM{static create(){let e=document.createElement("span");return e.className="flexCenter online",e.style.display="block",e}static append(e,t){e=ChatBody.makeChatIDUsable(e);let s=document.getElementById(e);if(s){let e=s.getElementsByClassName("chatPix")[0];if(e)e.appendChild(t);else{let e="chatPixDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(t){let e=t.getElementsByClassName("chatPix")[0];if(!e)return void console.log("fatal error 001");let s=e.getElementsByClassName("online")[0];if(s)s.parentElement.removeChild(s);else{let e="onlineIconElem not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class LMegReadDOM{static create(e,t){let s=createIcon(t);return s.classList.add("lMegRead"),e&&s.classList.add(e),s}static append(e,t){e=ChatBody.makeChatIDUsable(e);let s=document.getElementById(e);if(s){let e=s.getElementsByClassName("lMegContain1")[0];if(e){let s=e.firstChild;e.insertBefore(t,s)}else{let e="lMegContain1 not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(t){let e=t.getElementsByClassName("lMegContain1")[0],s=e.getElementsByClassName("lMegRead")[0];if(e&&s)s.parentElement.removeChild(s);else{let e="lMegContain1DOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ChatMoreOptionsDOM{static create(e){const t=Settings.ChatOptions;let s=document.createElement("div");s.className="chatMoreOptions",s.dataset.id=e,s.setAttribute("name",e);let a="Pin";document.getElementById(e).getElementsByClassName("lMegContain2")[0].getElementsByClassName("chatPined")[0]&&(a="Unpin");let n=[];return t.selectChat&&n.push(["selectThisChat","Select"]),t.deleteChat&&n.push(["deleteThisChat","Delete"]),t.pinChat&&n.push(["pinThisChat",a]),n.forEach((e=>{let t=document.createElement("p");t.className=e[0],t.innerHTML=e[1],s.appendChild(t)})),ChatMoreOptionsDOM.onload(s,e),s}static append(e,t){e=ChatBody.makeChatIDUsable(e);let s=document.getElementById(e);if(s){let e=s.getElementsByClassName("lMegContain2")[0];if(e)e.appendChild(t);else{let e="lMegContain2DOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(t){let e=t.getElementsByClassName("lMegContain2")[0],s=e.getElementsByClassName("chatMoreOptions")[0];if(e&&s)s.parentElement.removeChild(s);else{let e="lMegContain2DOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static onload(e,t){let s=e.getElementsByClassName("selectThisChat")[0],a=e.getElementsByClassName("deleteThisChat")[0],n=e.getElementsByClassName("pinThisChat")[0];s&&s.addEventListener("click",ChatOptions.selectThisChat),a&&(ChatFuncs.chatIsDeleting(t)?ChatMoreOptionsDOM.makeOptionUclickale(0,0,a):a.addEventListener("click",ChatOptions.deleteThisChat)),n&&(ChatFuncs.chatIsPinning(t)?ChatMoreOptionsDOM.makeOptionUclickale(0,0,n):n.addEventListener("click",ChatOptions.pinThisChat))}static makeOptionUclickale(e,t,s){if(!s){const a={sel:"selectThisChat",del:"deleteThisChat",pin:"pinThisChat"};e=ChatBody.makeChatIDUsable(e);let n=document.getElementById(e);if(!n){let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}let o=n.getElementsByClassName("lMegContain2")[0].getElementsByClassName("chatMoreOptions")[0];if(!o)return;s=o.getElementsByClassName(a[t])[0]}s&&(s.classList.add("processing"),s.classList.contains("selectThisChat")&&s.removeEventListener("click",ChatOptions.selectThisChat),s.classList.contains("deleteThisChat")&&s.removeEventListener("click",ChatOptions.deleteThisChat),s.classList.contains("pinThisChat")&&s.removeEventListener("click",ChatOptions.pinThisChat))}static makeOptionClickale(e,t,s){if(!s){const a={sel:"selectThisChat",del:"deleteThisChat",pin:"pinThisChat"};e=ChatBody.makeChatIDUsable(e);let n=document.getElementById(e);if(!n){let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t,!1,!0);return void(s&&console.log(s))}let o=n.getElementsByClassName("lMegContain2")[0].getElementsByClassName("chatMoreOptions")[0];if(!o)return;s=o.getElementsByClassName(a[t])[0]}s&&(s.classList.remove("processing"),s.classList.contains("selectThisChat")&&s.addEventListener("click",ChatOptions.selectThisChat),s.classList.contains("deleteThisChat")&&s.addEventListener("click",ChatOptions.deleteThisChat),s.classList.contains("pinThisChat")&&s.addEventListener("click",ChatOptions.pinThisChat))}}class NoChatFoundDOM{static create(){let e=document.createElement("div");return e.className="noChatFound",e.innerHTML="No chat found",e}static append(e){const t=DOMGetter.getChatBody();if(t)t.appendChild(e);else{let e="chatBodyDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){ChatBodyDOM.clear()}}class ChatGroupActivations{static chatExpandMoreOptions(e){const t=DOMGetter.getMousePositionBody(),s=DOMGetter.getChatMousePosBody();t&&MousePositionBodyPopupDOM.delete(),s&&ChatMousePosBodyPopupDOM.delete();const a=DOMGetter.getChatBody();let n=e.target;for(;!n.classList.contains("chatExpandMore");)n=n.parentElement;let o=n.dataset.id,l=document.getElementById(o);ChatMoreOptionsDOM.append(o,ChatMoreOptionsDOM.create(o));let i=n.nextElementSibling;i.className="chatMoreOptions",n.style.display="flex",i.style.top&&(i.style.top="0");let r=a.getBoundingClientRect(),c=l.getBoundingClientRect(),d=i.getBoundingClientRect(),g=n.getBoundingClientRect(),h=g.bottom-c.top+"px";i.style.top=h,d=i.getBoundingClientRect();let M=r.bottom;if(M<d.bottom){let e=null;if(g.top-r.top>=d.height){e=!0;let t=d.height-(c.bottom-g.top)+"px";t="-"+t,i.style.top=t}if(!e){let e=d.bottom-M+5;a.scrollTo(a.scrollLeft,a.scrollTop+e)}}let m={functs:[["click",ChatGroupDeactivations.chatExpandMoreOptions]]};MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create(m)),ChatMousePosBodyPopupDOM.append(ChatMousePosBodyPopupDOM.create(m))}static allChatOntouchEvent(e=null){if(e)e.addEventListener("touchstart",ChatBody.touchedThisChat);else{let e=document.getElementsByClassName("chatContain");for(let t=0;t<e.length;t++)e[t].addEventListener("touchstart",ChatBody.touchedThisChat)}}static allChatsFunctions(e=null){if(e){let t=e.getElementsByClassName("chatExpandMore")[0],s=e.getElementsByTagName("img")[0];e.addEventListener("click",ChatBody.loadChatMessages),t&&t.addEventListener("click",ChatGroupActivations.chatExpandMoreOptions),s&&!s.dataset.no_adm&&(s.addEventListener("click",ProfileFunc.viewChatProfilePicture),s.addEventListener("touchstart",ProfileFunc.viewChatProfilePicture))}else{let e=document.getElementsByClassName("chatContain");for(let t=0;t<e.length;t++){e[t].addEventListener("click",ChatBody.loadChatMessages);let s=e[t].getElementsByClassName("chatExpandMore")[0],a=e[t].getElementsByTagName("img")[0];s&&s.addEventListener("click",ChatGroupActivations.chatExpandMoreOptions),a&&!a.dataset.no_adm&&(a.addEventListener("click",ProfileFunc.viewChatProfilePicture),a.addEventListener("touchstart",ProfileFunc.viewChatProfilePicture))}}}static allChatSelected(e=null){if(e&&e.id){let t=e.getElementsByClassName("chatSelected")[0],s=e.getElementsByClassName("chatExpandMore")[0];s&&(s.style.display="none"),t&&(t.style.display="block",t.addEventListener("click",ChatBody.selectUnselectChat),t.addEventListener("touchstart",ChatBody.selectUnselectChat))}else{GlobalVars.chatsAreSelected=!0;const e=DOMGetter.getChatHeadBack(),t=DOMGetter.getChatHeadNormal(),s=DOMGetter.getChatHeadSelected();DOMGetter.getMessageHeadNormal()&&MsgGroupDeactivations.allSelected_Megchecked(),ChatBody.emptySelectedChatsID(),ChatFuncs.setIsSelectingChats(!0),setTimeout((()=>{ChatBodyDOM.tryHide()}),50);let a=document.getElementsByClassName("chatSelected"),n=document.getElementsByClassName("chatExpandMore");for(let e=0;e<n.length;e++)n[e].style.display="none";for(let e=0;e<a.length;e++)a[e].style.display="block",a[e].addEventListener("click",ChatBody.selectUnselectChat),a[e].addEventListener("touchstart",ChatBody.selectUnselectChat);ChatHeadSelectedDOM.loadIcons(),t.style.display="none",s.style.display="flex",e.addEventListener("click",ChatGroupDeactivations.allChatSelected)}}}class ChatSearchDOM{static create(){let e=document.createElement("div");e.id="chatSearch";let t=document.createElement("div"),s=createIcon("search");s.id="chatSearchBack",t.appendChild(s);let a=document.createElement("div"),n=document.createElement("div");n.className="chatSearchInput placeholder",n.innerHTML="Serach for chats",a.appendChild(n);let o=document.createElement("div");o.className="chatSearchInput",o.setAttribute("contentEditable","true"),a.appendChild(o),t.appendChild(a);let l=document.createElement("span");l.id="chatSearchClear",l.className="material-icons flexCenter hide",l.innerHTML="close",t.appendChild(l),e.appendChild(t);let i=createIcon("close");i.classList.add("chatSearchClose"),e.appendChild(i);let r={chatSearch:e,chatSearchClose:i};return OnloadActivations.chatSearchElem(r),e}static append(e){const t=DOMGetter.getChat(),s=DOMGetter.getChatBody();if(t&&s)t.insertBefore(e,s);else{let e="counl not get required elements",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getChatSearch();if(e)e.parentNode.removeChild(e);else{let e="counl not get chatSearchElem",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ChatHead{static deactivateChatHeadOthersOption(){const e=DOMGetter.getMousePositionBody(),t=DOMGetter.getChatMousePosBody();e&&MousePositionBodyPopupDOM.delete(),t&&ChatMousePosBodyPopupDOM.delete(),ChatBodyDOM.tryUnhide();const s=DOMGetter.getChatHeadOthers(),a=DOMGetter.getChatHeadOthersOptions();let n=a.getElementsByClassName("chatHeadOptionSelect")[0];n.removeEventListener("click",ChatGroupActivations.allChatSelected),n.removeEventListener("click",ChatHead.deactivateChatHeadOthersOption),a.className="hide",s.style.background=""}static activateChatHeadOthersOption(){const e=DOMGetter.getMousePositionBody(),t=DOMGetter.getChatMousePosBody();e&&MousePositionBodyPopupDOM.delete(),t&&ChatMousePosBodyPopupDOM.delete(),ChatBodyDOM.tryHide();const s=DOMGetter.getChatHeadOthers(),a=DOMGetter.getChatHeadOthersOptions();let n=a.getElementsByClassName("chatHeadOptionSelect")[0];n.addEventListener("click",ChatGroupActivations.allChatSelected),n.addEventListener("click",ChatHead.deactivateChatHeadOthersOption),a.className="chatHeadOthersOptions",s.style.background="#D5D5D5";let o={functs:[["click",ChatHead.deactivateChatHeadOthersOption]]};MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create(o)),ChatMousePosBodyPopupDOM.append(ChatMousePosBodyPopupDOM.create(o))}static chatHeadChatFunc(){console.log("chatHeadChatFunc"),alert("function not available yet")}static chatHeadSearchChatFunc(e){let t=e.target;for(;!t.classList.contains("my_icon");)t=t.parentElement;if(DOMGetter.getChatSearch()){let e="chatSearch not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}else ChatSearchDOM.append(ChatSearchDOM.create()),t.classList.add("hide")}}class MsgHead{static activateMessageHeadOthersOption(){const e=DOMGetter.getMousePositionBody(),t=DOMGetter.getChatMousePosBody();e&&MousePositionBodyPopupDOM.delete(),t&&ChatMousePosBodyPopupDOM.delete(),ChatBoxDOM.tryHide();let s=DOMGetter.getMessageHeadOthers(),a=document.getElementById("messageHeadOthersOptions"),n=a.getElementsByClassName("messageHeadOptionSelect")[0];n.addEventListener("click",MsgGroupActivations.allSelected_Megchecked),n.addEventListener("click",MsgHead.deactivateMessageHeadOthersOption),a.className="messageHeadOthersOptions",s.style.background="#D5D5D5";let o={functs:[["click",MsgHead.deactivateMessageHeadOthersOption]]};MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create(o)),ChatMousePosBodyPopupDOM.append(ChatMousePosBodyPopupDOM.create(o))}static deactivateMessageHeadOthersOption(){const e=DOMGetter.getMousePositionBody(),t=DOMGetter.getChatMousePosBody();e&&MousePositionBodyPopupDOM.delete(),t&&ChatMousePosBodyPopupDOM.delete(),ChatBoxDOM.tryUnhide();let s=DOMGetter.getMessageHeadOthers(),a=document.getElementById("messageHeadOthersOptions"),n=a.getElementsByClassName("messageHeadOptionSelect")[0];n.removeEventListener("click",MsgGroupActivations.allSelected_Megchecked),n.removeEventListener("click",MsgHead.deactivateMessageHeadOthersOption),a.className="hide",s.style.background=""}}class Private{static chatSearchBackFunc(){const e=DOMGetter.getChatSearch(),t=DOMGetter.getChatSearchBack(),s=DOMGetter.getChatSearchClear(),a=e.getElementsByClassName("chatSearchClose")[0],n=e.getElementsByClassName("chatSearchInput")[1];e.classList.remove("typingFocus"),a.classList.remove("hide"),t.innerHTML=icons.search,setTimeout((()=>{t.classList.remove("arrow_back")}),50),t.removeEventListener("click",Private.chatSearchBackFunc),s.removeEventListener("click",Private.chatSearchClearFunc),n.removeEventListener("keyup",Private.chatSearchInputTyping),e.addEventListener("click",ChatSearchFunc.clickChatSearchFunc),Private.chatSearchClearFunc()}static pushInMatchedChat(e,t){(e=Object.values(e).sort(((e,t)=>e.name-t.name))).forEach((e=>{ChatContainDOM.append(ChatContainDOM.create(e))}))}static chatSearchInputTyping(e){const t=DOMGetter.getChatSearchClear(),s=DOMGetter.getChatBody();let a=e.target,n=a.previousElementSibling;if("<br>"==a.innerHTML&&(a.innerHTML=""),a.innerHTML){ChatFuncs.setSearchingMode(!0),DOMGetter.getMessageHead()&&MsgSectionDOM.clear(!0),n.classList.add("hide"),t.classList.remove("hide"),ChatsDB.gotAllChats||(LoaderBackgroundDOM.append(s,LoaderBackgroundDOM.create(!0)),ContentLoaderDOM.append(s,ContentLoaderDOM.create(!0,"boxes",!0)),ChatFuncs.fetchChats(!0)),ChatBodyDOM.clear();let e=new RegExp(`^${a.innerHTML}`),o=ChatsDB.getChatsAsArr();o=o.filter((t=>{let s;return t.name.split(" ").forEach((t=>{s=s||e.test(t)})),s})),o[0]?Private.pushInMatchedChat(o,e):NoChatFoundDOM.append(NoChatFoundDOM.create())}else n.classList.remove("hide"),t.classList.add("hide"),ChatBodyDOM.clear(),ChatFuncs.pushInFetchedChat(),ChatFuncs.setSearchingMode(!1)}static chatSearchClearFunc(){const e=DOMGetter.getChatSearch(),t=DOMGetter.getChatSearchClear(),s=e.getElementsByClassName("chatSearchInput")[0],a=e.getElementsByClassName("chatSearchInput")[1],n=a.innerHTML;a.innerHTML="",s.classList.remove("hide"),t.classList.add("hide"),n&&(ChatBodyDOM.clear(),ChatFuncs.pushInFetchedChat()),ChatFuncs.setSearchingMode(!1)}}class ChatSearchFunc{static clickChatSearchFunc(e){let t=e.target;for(;!t.classList.contains("chatSearchInput")&&!t.classList.contains("my_icon");)if(t=t.parentElement,!t)return;let s="chatSearchBack"==t.id;t.classList.contains("arrow_back")&&(s=!1);let a=t.classList.contains("chatSearchInput");if(s||a){const e=DOMGetter.getChatSearch(),t=DOMGetter.getChatSearchBack(),s=DOMGetter.getChatSearchClear(),a=e.getElementsByClassName("chatSearchClose")[0],n=e.getElementsByClassName("chatSearchInput")[1];e.classList.add("typingFocus"),t.classList.add("arrow_back"),a.classList.add("hide"),t.innerHTML=icons.arrow_back,t.addEventListener("click",Private.chatSearchBackFunc),s.addEventListener("click",Private.chatSearchClearFunc),n.addEventListener("keyup",Private.chatSearchInputTyping),e.removeEventListener("click",ChatSearchFunc.clickChatSearchFunc)}}static chatSearchCloseFunc(){const e=DOMGetter.getChatHeadSearchChat();ChatSearchDOM.delete(),e.classList.remove("hide")}}class OnloadActivations{static groupActivations(){MsgGroupActivations.allMegSelectMoreOptions(),ChatGroupActivations.allChatsFunctions(),MsgGroupActivations.allMessageOntouchEvent(),ChatGroupActivations.allChatOntouchEvent(),OtherFunctions.activateMsgDateBeforeAfterfunc()}static chatHeadActivations(){const e=DOMGetter.getChatChatMinimize(),t=DOMGetter.getChatHeadChat(),s=DOMGetter.getChatHeadSearchChat(),a=DOMGetter.getChatHeadOthers(),n=DOMGetter.getChatHeadPix();e&&e.addEventListener("click",ChatHeadNormalDOM.onclickChatMinimizeBotton),t&&t.addEventListener("click",ChatHead.chatHeadChatFunc),s&&s.addEventListener("click",ChatHead.chatHeadSearchChatFunc),a&&a.addEventListener("click",ChatHead.activateChatHeadOthersOption),n&&n.addEventListener("click",ProfileFunc.viewMyProfilePicture)}static messageBodyActivations(e){let t,s,a,n;e?t=e.messageBody:(t=DOMGetter.getMessageBody(),s=DOMGetter.getShowChatBox(),a=DOMGetter.getCloseChatBox(),n=DOMGetter.getChatBoxTextMsg()),t&&t.addEventListener("scroll",MsgBody.activateMessageBodyOnscrollfunc),a&&a.addEventListener("click",ChatBoxDOM.onclickCloseChatBoxButton),n&&n.addEventListener("keyup",ChatBoxDOM.typingMessage)}static messageHeadActivations(){const e=DOMGetter.getMessageChatMaximize(),t=DOMGetter.getMessageHeadOthers(),s=DOMGetter.getMessageHeadPix();e&&e.addEventListener("click",MessageHeadNormalDOM.onclickMessageChatMaximizeBotton),t&&t.addEventListener("click",MsgHead.activateMessageHeadOthersOption),s&&s.addEventListener("click",ProfileFunc.viewCurrentChatProfilePicture)}static onloadPage(){const e=DOMGetter.getPageSection();let t=document.getElementsByTagName("body")[0],s=e.getBoundingClientRect().height,a=t.scrollHeight,n=t.getBoundingClientRect().height;if(a>n){let t=a-n;e.style.height=s-t}}static messageHeadNormalElem(e){const t=e.messageChatMaximize,s=e.messageHeadOthers,a=e.messageHeadPix;t&&t.addEventListener("click",MessageHeadNormalDOM.onclickMessageChatMaximizeBotton),s&&s.addEventListener("click",MsgHead.activateMessageHeadOthersOption),a&&a.addEventListener("click",ProfileFunc.viewCurrentChatProfilePicture)}static chatHeadNormalElem(e){const t=e.chatChatMinimize,s=e.chatHeadChat,a=e.chatHeadSearchChat,n=e.chatHeadOthers,o=e.chatHeadPix,l=e.addNeewChart;t&&t.addEventListener("click",ChatHeadNormalDOM.onclickChatMinimizeBotton),s&&s.addEventListener("click",ChatHead.chatHeadChatFunc),a&&a.addEventListener("click",ChatHead.chatHeadSearchChatFunc),n&&n.addEventListener("click",ChatHead.activateChatHeadOthersOption),o&&o.addEventListener("click",ProfileFunc.viewMyProfilePicture),l&&l.addEventListener("click",MsgBody.loadNewChat)}static chatSearchElem(e){const t=e.chatSearch,s=e.chatSearchClose;t&&t.addEventListener("click",ChatSearchFunc.clickChatSearchFunc),s&&s.addEventListener("click",ChatSearchFunc.chatSearchCloseFunc)}static chatboxReplyElem(e){const t=e.close;t&&t.addEventListener("click",ChatboxReplyDOM.close)}}const iconCreate=(e,t)=>{let s=document.createElement("div");return s.id=e,s.className="material-icons flexCenter",s.innerHTML=t,s};class MessageHeadDOM{static _processNoAdmin=e=>{const t=ProfilesDB.getAdminProfiles(),s=t.length,a=ProfilesDB.adminCount;s>1&&e.style.setProperty("--extr",s-1);let n=0,o=s;a>3&&(o=2);let l="";for(;n<o;){const s=t[n],a=document.createElement("img");a.alt="pix",a.src=s.p_pix,e.appendChild(a),n&&(a.style.setProperty("--index",n),l+=", "),l+=s.f_name,n++}if(a>3){const t="+"+(a-o),s=document.createElement("span");s.style.setProperty("--index",n),s.innerHTML=t,e.appendChild(s),l+=`, ${t} more`}return l};static create(){let e=document.createElement("div");return e.id="messageHead",e}static append(e){const t=DOMGetter.getMessage();if(t)t.appendChild(e);else{let e="messageElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}}class MessageHeadNormalDOM{static replaceChatHead=e=>{if(!ChatFuncs.isActiveChat(e))return;const t=DOMGetter.getMessageHeadNormal();t&&t.parentElement.replaceChild(MessageHeadNormalDOM.create(),t)};static create=()=>{let e,t=ChatsDB.getChatObj(ChatsDB.activeChat),s="",a=t.lastSeenString;const n=document.createElement("div");n.id="messageHeadNormal";const o=createIcon("menu");o.id="messageChatMaximize",n.appendChild(o);const l=document.createElement("div");l.id="messageHeadPix",t.hadAdmin()||MyProfile.isAdmin()?(e=document.createElement("img"),e.alt="pix",e.src=t.imgSrc,l.appendChild(e),s=t.name):(s=MessageHeadDOM._processNoAdmin(l),n.classList.add("noAdm")),n.appendChild(l);const i=document.createElement("div");i.id="messageHeadNameContain";const r=document.createElement("div");if(r.id="messageHeadName",r.innerHTML=s,i.appendChild(r),a){const e=document.createElement("div");e.id="messageHeadNameTime",e.innerHTML=a,i.appendChild(e)}n.appendChild(i);let c=null;Settings.MessageOptions.more_msgOptions&&(c=createIcon("more_vert"),c.id="messageHeadOthers",n.appendChild(c));const d=document.createElement("div");d.id="messageHeadOthersOptions",d.className="hide";const g=document.createElement("p");g.className="messageHeadOptionSelect",g.innerHTML="Select",d.appendChild(g),n.appendChild(d);const h={messageChatMaximize:o,messageHeadOthers:c,messageHeadPix:l};return OnloadActivations.messageHeadNormalElem(h),n};static createNoUser(e=!1){const t=document.createElement("div");t.id="messageHeadNormal",t.classList.add("noAdm");let s=null;e&&(s=createIcon("menu"),s.id="messageChatMaximize",t.appendChild(s));const a=document.createElement("div");a.id="messageHeadPix";const n=document.createElement("div");n.id="messageHeadNameContain";const o=document.createElement("div");o.id="messageHeadName";const l=MessageHeadDOM._processNoAdmin(a);o.innerHTML=l,t.appendChild(a),n.appendChild(o),t.appendChild(n);const i={messageChatMaximize:s};return OnloadActivations.messageHeadNormalElem(i),t}static append(e){const t=DOMGetter.getMessageHead();if(t)t.appendChild(e);else{let e="messageHeadElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(){const e=DOMGetter.getMessageHeadNormal();if(e)e.parentNode.removeChild(e);else{let e="messageHeadNormalElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static onclickMessageChatMaximizeBotton(){const e=DOMGetter.getChat(),t=DOMGetter.getMessage(),s=DOMGetter.getMsgSelectAChat();t.classList.remove("hide_side"),e.classList.remove("hide"),e.classList.remove("msg"),s&&(s.getElementsByClassName("selectAChatBtn")[0].style.display="")}static createLastSeen(e){let t=document.createElement("div");return t.id="messageHeadNameTime",t.innerHTML=e,t}static appendLastSeen(e){let t;if(DOMGetter.getMessageHeadNormal()){if(t=document.getElementById("messageHeadNameContain"),!t){let e="messageHeadNameContainElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}t.appendChild(e)}else{let e="messageHeadNormalElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static deleteLastSeen(){const e=document.getElementById("messageHeadNameTime");if(e)e.parentNode.removeChild(e);else{let e="messageHeadNameTimeElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}}class MessageHeadSelectedDOM{static create(){let e=document.createElement("div");e.id="messageHeadSelected";let t=createIcon("arrow_back");t.id="messageHeadBack",e.appendChild(t);let s=document.createElement("div");return s.id="messageHeadCount",s.className="flexCenter",s.innerHTML="0",e.appendChild(s),e}static append(e){const t=DOMGetter.getMessageHead();if(t)t.appendChild(e);else{let e="messageHeadElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(){const e=DOMGetter.getMessageHeadSelected();if(e)e.parentNode.removeChild(e);else{let e="msgHeadSelectedElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static loadIcons(e=null){const t=Settings.MessageOptions;if(e||(e=DOMGetter.getMessageHeadSelected()),t.headReplyMessage){let t=MessageHeadSelectedDOM.createMsgHeadReplyIcon();e.appendChild(t)}if(t.groupDelMessage){let t=MessageHeadSelectedDOM.createMsgHeadDelIcon();e.appendChild(t)}if(t.groupFowardMessage){let t=MessageHeadSelectedDOM.createMsgHeadFowardIcon();e.appendChild(t)}if(t.groupCopyMessage){let t=MessageHeadSelectedDOM.createMsgHeadCopyIcon();e.appendChild(t)}if(t.groupStarMessage){let t=MessageHeadSelectedDOM.createMsgHeadStarIcon();e.appendChild(t)}if(t.headMsgInfo){let t=MessageHeadSelectedDOM.createMsgHeadInfoIcon();e.appendChild(t)}let s=MessageHeadSelectedDOM.createMsgHeadOthersSIcon();return e.appendChild(s),e}static clearIcons(){let e=DOMGetter.getMessageHeadReply(),t=DOMGetter.getMessageHeadDelete(),s=DOMGetter.getMessageHeadFoward(),a=DOMGetter.getMessageHeadCopy(),n=DOMGetter.getMessageHeadStar(),o=DOMGetter.getMessageHeadInfo(),l=DOMGetter.getMessageHeadOthersS();e&&MessageHeadSelectedDOM.deleteIcon(e),t&&MessageHeadSelectedDOM.deleteIcon(t),s&&MessageHeadSelectedDOM.deleteIcon(s),a&&MessageHeadSelectedDOM.deleteIcon(a),n&&MessageHeadSelectedDOM.deleteIcon(n),o&&MessageHeadSelectedDOM.deleteIcon(o),l&&MessageHeadSelectedDOM.deleteIcon(l)}static appendIcon(e){const t=DOMGetter.getMessageHeadSelected();if(!t){let e="messageHeadSelectedDOM not found",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const s=DOMGetter.getMessageHeadOthersS();s?t.insertBefore(e,s):t.appendChild(e)}static deleteIcon(e){if(!e){let e="iconElem not found",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const t=e.parentElement;if(t)if("messageHeadSelected"==t.id)t.removeChild(e);else{let e="got the wrong element",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}else{let e="messageHeadSelectedDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static createMsgHeadReplyIcon(){let e=createIcon("reply");return e.id="messageHeadReply",e.addEventListener("click",MsgHeadSelecOpts.replyMessages),e}static createMsgHeadDelIcon(){let e=createIcon("delete");return e.id="messageHeadDelete",e.addEventListener("click",MsgHeadSelecOpts.deleteMessages),e}static createMsgHeadFowardIcon(){let e=createIcon("reply");return e.id="messageHeadFoward",e.addEventListener("click",MsgHeadSelecOpts.fowardMessages),e}static createMsgHeadCopyIcon(){let e=createIcon("copy");return e.id="messageHeadCopy",e.addEventListener("click",MsgHeadSelecOpts.copyMessages),e}static createMsgHeadStarIcon(){let e=createIcon("star");return e.id="messageHeadStar",e.addEventListener("click",MsgHeadSelecOpts.starMessages),e}static createMsgHeadInfoIcon(){let e=createIcon("description");return e.id="messageHeadInfo",e.addEventListener("click",MsgHeadSelecOpts.getMessagesInfo),e}static createMsgHeadOthersSIcon(){let e=createIcon("more_vert");return e.id="messageHeadOthersS",e.addEventListener("click",MsgHeadSelecOpts.activateMessageHeadOthersS),e}}class MsgGroupActivations{static megSelectMoreOptions(e){let t=DOMGetter.getMessageBody(),s=DOMGetter.getChatBox();const a=DOMGetter.getMousePositionBody(),n=DOMGetter.getChatMousePosBody();let o;a&&MousePositionBodyPopupDOM.delete(),n&&ChatMousePosBodyPopupDOM.delete(),ChatBoxDOM.tryHide();let l=e.target;for(;!l.classList.contains("megMore");)l=l.parentElement;o=l.getElementsByClassName("subMsgMore")[0],l.removeEventListener("click",MsgGroupActivations.megSelectMoreOptions),o.removeEventListener("click",MsgGroupActivations.megSelectMoreOptions);let i=l.dataset.id;const r=MsgMoreOptionsDOM.create(i);MsgMoreOptionsDOM.append(i,r),l.style.display="flex",r.style.top&&(r.style.top="0");let c,d=t.getBoundingClientRect(),g=r.getBoundingClientRect(),h=l.getBoundingClientRect();s&&(c=s.getBoundingClientRect());let M,m=h.height+"px";if(r.style.top=m,g=r.getBoundingClientRect(),M=s?d.bottom-c.height:d.bottom,M<g.bottom){let e=null;if(o.classList.add("optionUp"),h.top-d.top>=g.height){let t;e=!0,t=s?g.height-c.height/2.5+"px":g.height-.08*g.height+"px",t="-"+t,r.style.top=t}if(!e){let e=g.bottom-M;t.scrollTo(t.scrollLeft,t.scrollTop+e)}}let u={functs:[["click",MsgGroupDeactivations.megSelectMoreOptions]]};MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create(u)),ChatMousePosBodyPopupDOM.append(ChatMousePosBodyPopupDOM.create(u))}static allMessageOntouchEvent(e=null){if(e)e.addEventListener("touchstart",MsgBody.touchedThisMessage);else{let e=document.getElementsByClassName("messageContainer");for(let t=0;t<e.length;t++)e[t].addEventListener("touchstart",MsgBody.touchedThisMessage)}}static allMegSelectMoreOptions(e=null){if(e)e.getElementsByClassName("megMore")[0].addEventListener("click",MsgGroupActivations.megSelectMoreOptions);else{let e=document.getElementsByClassName("megMore");for(let t=0;t<e.length;t++)e[t].addEventListener("click",MsgGroupActivations.megSelectMoreOptions)}}static allSelected_Megchecked(e=null){if(e&&e.id){const t=ChatFuncs.getActiveChat();let s=e.getElementsByClassName("selected")[0],a=e.getElementsByClassName("Megchecked")[0];if(s){let e=s.dataset.id;MessageFuncs.msgIsDeleting(t,e)||(s.style.display="block",s.addEventListener("click",MsgBody.selectUnselectMessage),s.addEventListener("touchstart",MsgBody.selectUnselectMessage))}if(a){let e=a.dataset.id;MessageFuncs.msgIsDeleting(t,e)||(a.style.display="flex")}}else{ChatGroupDeactivations.allChatSelected(),MsgBody.emptySelectedMessagesID();const e=ChatFuncs.getActiveChat();setTimeout((()=>{ChatBoxDOM.tryHide()}),50);let t=DOMGetter.getMessageHeadNormal(),s=DOMGetter.getMessageHeadSelected(),a=DOMGetter.getMessageHeadBack();MessageFuncs.setIsSelectingMsgs(!0);let n=document.getElementsByClassName("selected"),o=document.getElementsByClassName("Megchecked");for(let t=0;t<n.length;t++){let s=!0,a=n[t].dataset.id;MessageFuncs.msgIsDeleting(e,a)&&(s=!1),s&&(n[t].style.display="block",n[t].addEventListener("click",MsgBody.selectUnselectMessage),n[t].addEventListener("touchstart",MsgBody.selectUnselectMessage))}for(let t=0;t<o.length;t++){let s=!0,a=o[t].dataset.id;MessageFuncs.msgIsDeleting(e,a)&&(s=!1),s&&(o[t].style.display="flex")}MessageHeadSelectedDOM.loadIcons(),t.style.display="none",s.style.display="flex",a.addEventListener("click",MsgGroupDeactivations.allSelected_Megchecked)}}}class LoadDBData{static admin=async e=>{MyProfile.got_profile||await MyProfile.fetch(!0),e?(await MessageFuncs.getReadStatOfUnreadFromDB(),await ChatFuncs.fetchNewerChats(),await ProfilesDB.getOnlineStatsForNullStats(),MessageFuncs.pushInNewDOMUnaddedMsgs()):await ChatFuncs.fetchAdminChats(),MessageFuncs.sendMsgRecivedSignal()};static user=async e=>{MyProfile.got_profile||await MyProfile.fetch(!1),e?(await MessageFuncs.getReadStatOfUnreadFromDB(),await ChatFuncs.fetchNewerChats(!1),await ProfilesDB.getOnlineStatsForNullStats(),MessageFuncs.pushInNewDOMUnaddedMsgs()):await ChatFuncs.fetchUserChats(),MessageFuncs.sendMsgRecivedSignal()}}class SocketMsgRecieve{static recieve=async e=>{if(!e)return;const t=(e=JSON.parse(e))[0];"msgsent"==t&&SocketMsgRecieve._msgSent(e),"newmsg"==t&&SocketMsgRecieve._newMsg(e),"nottheadmins"==t&&SocketMsgRecieve._notTheAdmins(e),"nottheadmin"==t&&SocketMsgRecieve._notTheAdmin(e),"onlinestatus"==t&&SocketMsgRecieve._onlineStatus(e),"msgsdelivered"==t&&SocketMsgRecieve._msgsDelivered(e),"msgsseen"==t&&SocketMsgRecieve._msgsSeen(e)};static _msgSent=e=>{const t=e[1],s=e[2],a=e[3],n=e[4];MessageFuncs.recieveMsgSentSignal(s,t,a,n)};static _newMsg=async e=>{const t=e[1],s=e[2],a=t.chat_id;ChatFuncs.getChatObj(a)||await ChatFuncs.fetchChatByID(a),s&&!MyProfile.isAdmin()&&await ChatFuncs.setNewChatAdmin(a,s);const n=MessageFuncs.addMessage(a,t);if(n){const e={};e[a]=`${n.msgID}_`,MessageFuncs.sendMsgRecivedSignal(e)}MessageFuncs.pushInNewMsg(a,n)};static _notTheAdmins=async e=>{const t=e[1];ChatFuncs.deleteChat(t)};static _notTheAdmin=async e=>{const t=e[1];alert("Another admin has resonded to this message"),ChatFuncs.deleteChat(t)};static _onlineStatus=async e=>{const t=e[1],s=e[2];ChatFuncs.onlineStatusSignal(s,t)};static _msgsDelivered=async e=>{const t=e[1],s=e[2],a=e[3];MessageFuncs.recieveMsgDeliveredSignal(t,s,a)};static _msgsSeen=async e=>{const t=e[1],s=e[2],a=e[3];MessageFuncs.recieveMsgSeenSignal(t,s,a)}}class Socket{ping_Interval=null;reconnect_timeout=null;socketId="";isConnected=!1;ones_connected=!1;userId=null;isAdmin=null;func=null;db_ready=!1;_message_que=[];async _sendMshQue(){for(;this.isConnected&&this._message_que.length;){const e=this._message_que.shift();this.sendMessage(e)}}async _connet(){this.socketId=`${this.userId}_${(new Date).getTime()}_${randomNumbers()}`,this.socket=new WebSocket(`${ServerPaths.getSocketPath()}/${this.userId}/${this.isAdmin}/${this.socketId}`),this.socket.onmessage=function(e){SocketMsgRecieve.recieve(e.data)},this.socket.onopen=async()=>{this.isConnected=!0,this._sendPing(),await this.func(this.ones_connected),this.db_ready=!0,this.ones_connected=!0,this._sendMshQue(),console.log("socket pen")},this.socket.onclose=async()=>{console.log("socket close"),this.isConnected=!1,clearInterval(this.ping_Interval),ChatFuncs.socketDisconnect(),this.reconnect()},this.socket.onerror=e=>{this.isConnected=!1,clearInterval(this.ping_Interval)}}async connet(e=!1){e=e?1:0,MyProfile.got_profile||await MyProfile.fetch(e);let t,s=MyProfile.userID;t=e?LoadDBData.admin:LoadDBData.user,this.userId=s,this.isAdmin=e,this.func=t,MyProfile.got_profile&&this._connet()}async reconnect(){await sleep(1e3),this._connet()}_sendPing(){clearInterval(this.ping_Interval),this.ping_Interval=setInterval((()=>{this.isConnected?this.socket.send(""):clearInterval(this.ping_Interval)}),29e3)}sendMessage(e){e&&(this.isConnected?(this.socket.send(e),this._sendPing()):this._message_que.push(e))}}const MyWebSocket=new Socket;class ChatDOMFunc{static getChatContainElemById=e=>{const t=ChatBody.makeChatIDUsable(e);return document.getElementById(t)};static moveChatElement(e,t,s=!1){let a=e.parentElement,n=t.parentElement;(s||a==n)&&n.insertBefore(e,t)}static putChatContainElemInPosition(e,t=!1){let s,a,n=!1,o=!1;t?(s=e,e=ChatDOMFunc.getChatContainElemById(s)):(s=e.id,o=!e.parentElement,s||(s=e.chatID,s=ChatBody.makeChatIDUsable(s),e=ChatContainDOM.create(e),n=!0)),ChatFuncs.getIsSelectingChats()&&ChatGroupActivations.allChatSelected(e),a=n||o,s=ChatBody.makeChatIDUsable(s);let l=ChatsDB.getNextDBChatID(s);if(-1==l){let e="Chat not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}if(-2==l&&!ChatFuncs.getChatsCount()-ChatContainDOM.getCountChatContains())return void ChatContainDOM.append(e);l=ChatBody.makeChatIDUsable(l);let i=document.getElementById(l);if(i)ChatDOMFunc.moveChatElement(e,i,a);else{if(l=ChatsDB.getNextDBChatID(s,!0),-1==l){let e="Chat not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}if(-2==l)return!ChatFuncs.getChatsCount()-ChatContainDOM.getCountChatContains()?void ChatContainDOM.append(e):void ChatContainDOM.delete(s);l=ChatBody.makeChatIDUsable(l);let t=document.getElementById(l);if(!t){let e="fatal error",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&(console.log(a),console.log(l)))}ChatDOMFunc.moveChatElement(e,t,a)}}}class MsgBody{static loadActiveChatMessages=()=>{const e=ChatsDB.activeChat;if(!e)return;DOMGetter.getChat().classList.add("msg"),MsgSectionDOM.clear(),ChatsDB.activeChat=e;const t=DOMGetter.getMessage();let s=DOMGetter.getLoaderBackgroundElem(t),a=DOMGetter.getContentLoaderElem(t);s||LoaderBackgroundDOM.append(t,LoaderBackgroundDOM.create()),a||ContentLoaderDOM.append(t,ContentLoaderDOM.create(!0,"boxes")),MsgSectionDOM.load(),MessageFuncs.pushMessagesIn(e),MessageFuncs.pushMsgSendingIn(e);let n=UnseenMsgIDs.get(e,!0);n?MsgBody.jumpToMsgByID(n):MsgBody.jumpToBottom(),MsgBody.checkIfUnseenMsgsAreSeenOnload(e),DOMGetter.getMessageBody().addEventListener("scroll",MsgBody.scrlMsgBodyToSeeMsg),s=DOMGetter.getLoaderBackgroundElem(t),a=DOMGetter.getContentLoaderElem(t),s&&LoaderBackgroundDOM.delete(t),a&&ContentLoaderDOM.delete(t)};static loadNewChat=()=>{DOMGetter.getChat().classList.add("msg"),ChatBody.loadNoUserMesage(!0)};static getElemAbsolutePos(e,t=!1){if(t){let t=MsgBody.makeMsgIDUsable(e);e=document.getElementById(t)}return e.getBoundingClientRect()}static setElemAbsolutePos(e,t,s=!1){if(s){let e=MsgBody.makeMsgIDUsable(t);t=document.getElementById(e)}let a=e.top;if(!e.left||!a){let e="invalid pos param",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const n=DOMGetter.getMessageBody();let o=t.getBoundingClientRect().top-a;n.scrollTo(n.scrollLeft,n.scrollTop+o)}static touchedThisMessageThenDrag(e){clearTimeout(GlobalVars.megChatTouchedTimeOut);let t=DOMGetter.getMessageBody(),s=t.getBoundingClientRect(),a=e.touches[0].clientY,n=GlobalVars.touchYPos-a;s.top<=a&&s.bottom>=a&&t.scrollTo(t.scrollLeft,t.scrollTop+n),GlobalVars.touchYPos=a}static touchedThisMessage(e){e.preventDefault();let t=DOMGetter.getMessageHeadCount();GlobalVars.touchYPos=e.touches[0].clientY;let s=e.target;if(!s.dataset.id)for(;!s.dataset.id;)s=s.parentElement;let a=s.dataset.id;a=MsgBody.makeMsgIDUsable(a);let n=MessageFuncs.getMsgSenderClass(ChatFuncs.getActiveChat(),a);GlobalVars.megChatTouchedTimeOut=setTimeout((()=>{MsgGroupActivations.allSelected_Megchecked(),MsgGroupDeactivations.removeAllSelectedHoverEffect();let s=document.getElementsByName(a)[0],o=document.getElementsByName(a)[1].getElementsByTagName("input")[0];MsgBody.updateSelectedMessagesID(a,n),t.innerHTML=GlobalVars.selectedMessagesID.length,s.classList.add("s"),o.setAttribute("checked","true"),e.target.removeEventListener("touchend",OtherFunctions.clearMegChatTouchedTimeOut),e.target.removeEventListener("touchcancel",OtherFunctions.clearMegChatTouchedTimeOut),e.target.removeEventListener("touchmove",MsgBody.touchedThisMessageThenDrag)}),1e3),e.target.addEventListener("touchend",OtherFunctions.clearMegChatTouchedTimeOut),e.target.addEventListener("touchcancel",OtherFunctions.clearMegChatTouchedTimeOut),e.target.addEventListener("touchmove",MsgBody.touchedThisMessageThenDrag)}static selectUnselectMessage(e){let t=DOMGetter.getMessageHeadCount();const s=ChatFuncs.getActiveChat();let a=e.target,n=a.nextElementSibling.getElementsByTagName("input")[0],o=a.dataset.id;o=MsgBody.makeMsgIDUsable(o);let l=MessageFuncs.getMsgSenderClass(s,o);MsgBody.updateSelectedMessagesID(o,l,s)?(a.classList.add("s"),n.setAttribute("checked","true")):(a.classList.remove("s"),n.removeAttribute("checked")),t.innerHTML=GlobalVars.selectedMessagesID.length}static activateMessageBodyOnscrollfunc(){let e=DOMGetter.getMessageBody(),t=DOMGetter.getMsgDate(),s=e.getBoundingClientRect().top,a=e.getElementsByClassName("Be")[0],n=e.getElementsByClassName("Af")[0];a&&a.getBoundingClientRect().top>=s&&(t.innerHTML=OtherFunctions.getMsgDateBeforeBeforefunc(a.innerHTML),a.classList.remove("Be"),n&&n.classList.remove("Af"),OtherFunctions.activateMsgDateBeforeAfterfunc()),n&&n.getBoundingClientRect().top<=s&&(t.innerHTML=n.innerHTML,a&&a.classList.remove("Be"),n.classList.remove("Af"),OtherFunctions.activateMsgDateBeforeAfterfunc()),t.classList.add("add"),clearTimeout(GlobalVars.msgDateTimeOutFunction),GlobalVars.msgDateTimeOutFunction=setTimeout((()=>{t.classList.remove("add")}),1e3)}static updateSelectedMessagesID(e,t,s=null){let a=DOMGetter.getMessageHeadReply(),n=DOMGetter.getMessageHeadInfo();if(s||(s=ChatFuncs.getActiveChat()),e=MsgBody.makeMsgIDUsable(e),MessageFuncs.msgIsDeleting(s,e)){let e="funtio is not supposed to run",t="",s=MyCodeErr.announce(e,t,!1,!0);return void(s&&console.log(s))}let o=GlobalVars.selectedMessagesID.indexOf(e),l=!1;return o<0?(GlobalVars.selectedMessagesID.push(e),GlobalVars.msgSenderTracking.push(t),l=!0):(GlobalVars.selectedMessagesID.splice(o,1),GlobalVars.msgSenderTracking.splice(o,1)),a&&(GlobalVars.selectedMessagesID.length>1?a.classList.add("hide"):a.classList.remove("hide")),n&&(GlobalVars.selectedMessagesID.length>1?n.classList.add("hide"):n.classList.remove("hide")),l}static msgIsSelected(e){return e=MsgBody.makeMsgIDUsable(e),GlobalVars.selectedMessagesID.indexOf(e),!0}static emptySelectedMessagesID(){(GlobalVars.selectedMessagesID||GlobalVars.msgSenderTracking)&&(GlobalVars.selectedMessagesID.splice(0,GlobalVars.selectedMessagesID.length),GlobalVars.msgSenderTracking.splice(0,GlobalVars.msgSenderTracking.length))}static jumpToMsgByID(e,t=!1){e=MsgBody.makeMsgIDUsable(e);const s=document.getElementById(e);if(!s){let e="msgContain not found",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const a=DOMGetter.getMessageBody(),n=s.getBoundingClientRect(),o=a.getBoundingClientRect(),l=n.top-o.top;t?a.scroll({top:l,behavior:"smooth"}):a.scrollTo(a.scrollLeft,l)}static checkIfUnseenMsgsAreSeenOnload(e){let t=null,s=null,a=null,n=UnseenMsgIDs.get(e),o=0;for(;o<n.length&&!s&&!a;){const e=n[o],l=MsgBody.msgIsSeeable(e);null!==l?l?t=e:s=e:a=!0,o++}if(a){let e="fatal error",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}else t&&MessageFuncs.sendMsgSeenSignal(e,t,!0)}static msgIsSeeable(e){let t=null;e=MsgBody.makeMsgIDUsable(e);const s=document.getElementById(e);if(!s)return t;const a=DOMGetter.getMessageBody(),n=s.getBoundingClientRect(),o=a.getBoundingClientRect(),l=.3*n.height;return t=o.bottom-n.top>=l,t}static jumpToBottom(e=!1){const t=DOMGetter.getMessageBody();e?t.scroll({top:t.scrollHeight,behavior:"smooth"}):t.scrollTo(t.scrollLeft,t.scrollHeight)}static scrlMsgBodyToSeeMsg(){const e=ChatFuncs.getActiveChat(),t=UnseenMsgIDs.get(e);if(!t[0])return;let s=null,a=null,n=0;for(;n<t.length&&!s&&!a;){const o=t[n],l=MsgBody.msgIsSeeable(o);null!==l?l?MessageFuncs.sendMsgSeenSignal(e,o):s=o:a=!0,n++}if(a){let e="couldNotFindMsgDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static getFirstMsgOnDomId(){return document.getElementsByClassName("msgWrapper")[0].id}static async sendMsg(e){let t;const s=ChatFuncs.getActiveChat(),a=(DOMGetter.getChatBox(),ChatBoxDB.getChatBoxAttr(s));if(!a){let e="chatBoxAttr not found",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const n=a.msg,o=a.rMsg;if(o&&(t=o.msgID),!n){let e="Please type your message",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}const l=MsgOnSendingDB.addMsgOnSending(s,a),i=MsgOnSendingDB.getMsgSendingInstance(s,l);ChatDOMFunc.putChatContainElemInPosition(s,!0),ChatBoxDOM.clear(),MessageFuncs.sendMsg(i)}static async sendMsgNoUser(e){const t=ChatBoxDB.noUser;if(!t){let e="Please type your message",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}ChatBoxDOM.clear();const s=await MsgApis.sendNoUserFirstMsg(t);if(!s||s.isErr)alert("Some error occured.");else{for(setUserLoginCookie(s.identifier),await MyWebSocket.connet(!1),PageLoadDOM.userFullMessagesPage(),MessageFuncs.sendNewChatStartedSignal(s.msg_id);!ChatFuncs.getFirstAvailableChatId()||!DOMGetter.getChat();)await sleep(5);const e=ChatFuncs.getFirstAvailableChatId();e&&(ChatBody.markChatAsActive(e),ChatsDB.activeChat=e,MsgBody.loadActiveChatMessages())}}static async sendUserNewChat(e){const t=ChatBoxDB.newChat;if(!t){let e="Please type your message",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}const s=`nw${randomNumbers()}ms${randomNumbers()}`;ChatBoxDOM.clearNewMsg(),ChatBoxDOM.setToLoading(s);const a=await ChatApis.sendUserNewChat(MyProfile.userID,t,s);if(a&&!a.isErr){const e=[a.chat];e[0].messages=a.messages;const t=e[0].messages[0].id,s=e[0].id;return ChatFuncs.saveChatsRecievedFromDB(e,!0,!0),MessageFuncs.markChatAsGotAllMsgs(s),document.querySelector(`#${a.temp_identifier}`)&&s&&(ChatBody.markChatAsActive(s),ChatsDB.activeChat=s,MsgBody.loadActiveChatMessages()),void MessageFuncs.sendNewChatStartedSignal(t)}alert("Some error occured.")}static makeMsgIDUsable(e){return/msg/.test(e)||(e="msg-"+e),e}static makeMsgID_DB_Usable(e){return/msg/.test(e)&&(e=e.split("msg-").splice(-1)[0]),e}}const deletedMsgText={1:"deleted",2:"deleted",3:"deleted",4:"deleted"};class MsgOnSendingInstance{constructor(e){this._chatID=e.chatID,this._msgSendingID=e.msgSendingID,this._msg=e.msg,this._isSender=!0,this._date=e.date,this._read="sending",e.rMsg&&(this._rMsg=new ReplyedMegInstance(e.rMsg))}get chatID(){return this._chatID}get msgSendingID(){return this._msgSendingID}get msg(){return this._msg}get read(){return this._read}get isSender(){return this._isSender}get date(){return this._date}get dateSentString(){return TimeFunctions.generateTimeSentStringT1(this.date)}get rMsg(){return this._rMsg}set chatID(e){}set msgSendingID(e){}set msg(e){}set read(e){}set isSender(e){}set date(e){}set dateSentString(e){}set rMsg(e){}imgSrc=()=>MyProfile.p_pix;getMsgOnSending(){return this}}class MsgOnSendingDBInstance{constructor(){this._msgsOnSending={}}getChatMsgsOnSending(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.msgsOnSending[t]}getMsgSendingInstance(e,t){return this.msgsOnSending[e][t]}get msgsOnSending(){return this._msgsOnSending}set msgsOnSending(e){}addMsgOnSending(e,t){const s=ChatBody.makeChatID_DB_Usable(e);if(this.msgsOnSending[s]||(this.msgsOnSending[s]={}),t.date=parseInt((new Date).getTime()/1e3),t.msgSendingID=`${t.date}_${randomNumbers()}`,this.msgsOnSending[s][t.msgSendingID]=new MsgOnSendingInstance(t),ChatFuncs.isActiveChat(s)){let e=this.msgsOnSending[s][t.msgSendingID];MessageFuncs.pushInMsgSending(s,e)}return ChatFuncs.updateChatLastMsgObj(s,this.msgsOnSending[s][t.msgSendingID]),t.msgSendingID}deleteMsgOnSending(e,t){const s=ChatBody.makeChatID_DB_Usable(e);if(!this.msgsOnSending[s])return!!t&&null;if(t=MsgBody.makeMsgID_DB_Usable(t),this.msgsOnSending[s][t]){if(delete this.msgsOnSending[s][t],this.msgsOnSending[s][t]){let e="failed to delete msg sending",t="",s=MyCodeErr.announce(e,t);return s&&console.log(s),!1}return!0}}getMsgOnSendingObj(e,t,s=!1){const a=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),s?!!this.msgsOnSending[a][t]:this.msgsOnSending[a][t].getMsgOnSending()}getChatMsgOnSendingAsArr(e){const t=ChatBody.makeChatID_DB_Usable(e);let s=this.getChatMsgsOnSending(t);return s?(s=Object.values(s),s=s.sort(((e,t)=>e.date-t.date)),s):[]}hasMsgSending(e){return!!this.getChatMsgOnSendingAsArr(e)&&!!this.getChatMsgOnSendingAsArr(e)[0]}}class ChatBoxReplyMsgInstance{constructor(e){if(e.chatID)if(e.msgID)this._chatID=ChatBody.makeChatID_DB_Usable(e.chatID),this._msgID=e.msgID,this._isSender=e.isSender,this._msg=e.msg;else{let e="incomplete rMsg param",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}else{let e="incomplete rMsg param",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}get chatID(){return this._chatID}get msgID(){return this._msgID}get isSender(){return this._isSender}get msg(){return this._msg}get senderName(){return this._isSender?"You":ChatFuncs.getChatObj(this._chatID).name}set chatID(e){}set msgID(e){}set isSender(e){}set msg(e){}set senderName(e){}}class ChatBoxAttributeInstance{constructor(e,t,s){this._chatID=ChatBody.makeChatID_DB_Usable(e),this._msg=t||"",this._rMsg=s?new ChatBoxReplyMsgInstance(s):null}get chatID(){return this._chatID}get msg(){return this._msg}get rMsg(){return this._rMsg}set chatID(e){}set msg(e){this._msg=e}set rMsg(e){this._rMsg=e?new ChatBoxReplyMsgInstance(e):null}}class ChatBoxDBInstance{constructor(){this._chatBoxsAttr={},this._noUser="",this._newChat=""}getChatBoxAttr(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chatBoxsAttr[t]}getRMsgObj(e){const t=ChatBody.makeChatID_DB_Usable(e);if(!this.chatBoxsAttr[t]){let e="some error occored",t="",s=MyCodeErr.announce(e,t);return s&&console.log(s),null}const s=this.chatBoxsAttr[t].rMsg;if(!s){let e="some error occoured",t="",s=MyCodeErr.announce(e,t);return s&&console.log(s),null}return s}get chatBoxsAttr(){return this._chatBoxsAttr}set chatBoxsAttr(e){}get noUser(){return this._noUser}set noUser(e){this._noUser=e}get newChat(){return this._newChat}set newChat(e){this._newChat=e}chatHasChatBox(e){const t=ChatBody.makeChatID_DB_Usable(e);return!!this.chatBoxsAttr[t]}addChatBoxAttr(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e);this.chatBoxsAttr[a]=new ChatBoxAttributeInstance(e,t,s)}deleteRMsgObj(e){const t=ChatBody.makeChatID_DB_Usable(e);if(this.chatBoxsAttr[t]){if(this.chatBoxsAttr[t].rMsg=null,this.chatBoxsAttr[t].rMsg){let e="some error occoured",t="",s=MyCodeErr.announce(e,t);return s&&console.log(s),!1}return!0}console.log("unnessary")}addRMsgObj(e,t){const s=ChatBody.makeChatID_DB_Usable(e);this.chatBoxsAttr[s]||ChatBoxDB.addChatBoxAttr(s,"",null),this.chatBoxsAttr[s].rMsg=t}updateMsg(e,t){const s=ChatBody.makeChatID_DB_Usable(e);this.chatBoxsAttr[s]||ChatBoxDB.addChatBoxAttr(s,"",null),this.chatBoxsAttr[s].msg=t}deleteChatBoxAttr(e){const t=ChatBody.makeChatID_DB_Usable(e);if(this.chatBoxsAttr[t]){if(delete this.chatBoxsAttr[t],this.chatBoxsAttr[t]){let e="some error occoured",t="",s=MyCodeErr.announce(e,t);return s&&console.log(s),!1}return!0}console.log("unnessary")}}class ReplyedMegInstance{constructor(e){this._chatID=e.chatID,this._msgID=e.msgID,this._isSender=e.isSender,this._msg=e.msg,this._senderName=e.senderName}get chatID(){return this._chatID}get msgID(){return this._msgID}get isSender(){return this._isSender}get msg(){return this._msg}get senderName(){return this._isSender?"You":ChatFuncs.getChatObj(this._chatID).name}set chatID(e){}set msgID(e){}set isSender(e){}set msg(e){}set senderName(e){}}class MessageInstance{constructor(e){this._chatID=e.chat_id||e.chatID,this._msgID=e.id||e.msgID,this._msg=e.msg,this._senderID=e.sender_id||e.senderID,this._prevMsgId=null,this._isSender=MyProfile.userID==this._senderID,this._timeSent=e.time_sent,this._timeSentString=TimeFunctions.generateTimeSentStringT2(this._timeSent),this._read=e.read_status||e.read,this._stared=e.stared,this._deliverTime=e.deliver_time||e.deliverTime,this._readTime=e.read_time||e.readTime,this._drtime=[TimeFunctions.generateTimeSentStringT1(this._deliverTime),TimeFunctions.generateTimeSentStringT1(this._readTime)],this._deleted=null,e.replyedMegObj&&(this._replyedMegObj=new ReplyedMegInstance(e.replyedMegObj)),this._isStaring=!1,this._isDeleting=!1}get chatID(){return this._chatID}get msgID(){return this._msgID}get prevMsgId(){return this._prevMsgId}get msg(){return this._msg}get isSender(){return this._isSender}get senderID(){return this._senderID}get timeSent(){return this._timeSent}get timeSentString(){return this._timeSentString}get dateSentString(){return TimeFunctions.generateTimeSentStringT1(this.timeSent)}get first(){if(!this.prevMsgId)return!0;const e=MessagesDB.getMessageObj(this.chatID,this.prevMsgId);return this.senderID!=e.senderID||this.dateSentString!=e.dateSentString}get read(){return this._read}get stared(){return this._stared}get deliverTime(){return this._deliverTime}get readTime(){return this._readTime}get drtime(){const e=["--","--"];return this._deliverTime&&(e[0]=TimeFunctions.generateTimeSentStringT1(this._deliverTime)),this._readTime&&(e[1]=TimeFunctions.generateTimeSentStringT1(this._readTime)),e}get deleted(){return this._deleted}get deletedText(){return deletedMsgText[this._deleted]}get replyedMegObj(){return this._replyedMegObj}get isStaring(){return!!this._isStaring}get isDeleting(){return!!this._isDeleting}set chatID(e){}set msgID(e){}set prevMsgId(e){this._prevMsgId=e}set msg(e){}set isSender(e){}set senderID(e){}set timeSent(e){}set timeSentString(e){}set dateSentString(e){}set first(e){}set read(e){this._read=e}set stared(e){this._stared=e}set deliverTime(e){this._deliverTime=e}set readTime(e){e&&(this._readTime=e)}set drtime(e){}set deleted(e){this._deleted=e}set deletedText(e){}set replyedMegObj(e){}set isStaring(e){this._isStaring=!!e}set isDeleting(e){this._isDeleting=!!e}imgSrc=()=>this.isSender?MyProfile.p_pix:ProfilesDB.getP_pix(this.senderID);getMessage(){return this}get senderClass(){return this.isSender?"you":"notYou"}set senderClass(e){}deleteThisMessage(e){this.deleted=e,this._msg=null,this._replyedMegObj=null,this._timeSentString=null,this._read=null,this._stared=null,this._deliverTime=null,this._readTime=null,this._drtime=null}}class MessagesDBInstance{constructor(){this._messages={},this.unseenMsgIDs={},this.gotAllMsgsStatus={},this._msgInfoInView={},this._isSelectingMsgs}saveMsgsRecievedFromDB(e,t,s=!1){if(t){const a=Settings.ApiSettings.messagesPerAPICall;t.forEach((t=>{this.addMessage(e,t)})),s||t.length<a&&(this.gotAllMsgsStatus[e]=!0)}}setMessagesPrevMsgId(e){const t=this.getChatMsgsAsArr(e);t.forEach(((s,a)=>{if(s.prevMsgId)return;const n=t[a+1];n&&(this._messages[e][s.msgID].prevMsgId=n.msgID)}))}getChatMessages(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.messages[t]}getSenderClass(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.getMsgInstance(s,t).senderClass}get msgInfoInView(){return this._msgInfoInView}set msgInfoInView(e){}setMsgInfoInView(e,t){const s=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t),this._msgInfoInView.chatID=s,this._msgInfoInView.msgID=t}getMsgInstance(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t]}get messages(){return this._messages}set messages(e){}get messagesWithAdmin(){const e=[];return Object.keys(this._messages).forEach((t=>{ChatFuncs.chatHadAdmin(t)&&e.push(this._messages[t])})),e}set messagesWithAdmin(e){}get isSelectingMsgs(){return this._isSelectingMsgs}set isSelectingMsgs(e){this._isSelectingMsgs=!0===e||"true"===e}deleteChat(e){const t=ChatBody.makeChatID_DB_Usable(e);delete this.messages[t]}deleteMessage(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t),s&&this.messages[a][t].deleteThisMessage(s)}async _getChatToAddmessage(e,t,s=!0){s&&(ChatFuncs.chatObjIsAvailable(e)||ChatFuncs.fetchChatByID(e))}addMessage(e,t){if(t.skip)return;t.msgID||(t.msgID=t.id);const s=ChatBody.makeChatID_DB_Usable(e);if(this._messages[s]||(this.messages[s]={},this.gotAllMsgsStatus[s]=!1),this.messages[s][t.msgID])return;this.messages[s][t.msgID]=new MessageInstance(t),this.setMessagesPrevMsgId(s);let a=this.messages[s][t.msgID];return a.isSender||"read"==a.read||UnseenMsgIDs.add(s,t.msgID),ChatFuncs.updateChatLastMsgObj(s,t),a}convertMsgSendingToMsg(e,t){const s=ChatBody.makeChatID_DB_Usable(t.chat_id),a=t.id,n=MsgOnSendingDB.deleteMsgOnSending(s,e);return this.messages[s][a]=new MessageInstance(t),MessageFuncs.correctFirstStatus(s,a),null===n?(ChatFuncs.setChatLastMsgObj(s,a),!0):ChatFuncs.convertLastMsgSendingToLastMsg(s,e,a)}getMessageObj(e,t,s=!1){const a=ChatBody.makeChatID_DB_Usable(e);if(t=MsgBody.makeMsgID_DB_Usable(t),s)return!!this.messages[a][t];if(!this.messages[a][t]){let e="some error occoured",t="",s=MyCodeErr.announce(e,t);return s&&console.log(s),null}return this.messages[a][t].getMessage()}getStaredStatus(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t].stared}getReadStatus(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t].read}getMsgDelStatus(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t].deleted}getIsSenderStatus(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t].isSender}userIsSender(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t].isSender}getFirstStatus(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t].first}setReadStatus(e,t,s,a){const n=ChatBody.makeChatID_DB_Usable(e);return!!this.messages[n]&&(t=MsgBody.makeMsgID_DB_Usable(t),!!this.messages[n][t]&&("delivered"==this.messages[n][t].read&&"read"==s&&(this.messages[n][t].readTime=a,this.messages[n][t].read=s),!0))}setDeliverTime(e,t,s,a){const n=ChatBody.makeChatID_DB_Usable(e);return!!this.messages[n]&&(t=MsgBody.makeMsgID_DB_Usable(t),!!this.messages[n][t]&&("sent"==this.messages[n][t].read&&"delivered"==s&&(this.messages[n][t].deliverTime=a,this.messages[n][t].read=s),!0))}setStaredStatus(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t),this.messages[a][t].stared=s}setMsgInfoInView(e,t){const s=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t),this.msgInfoInView.chatID=s,this.msgInfoInView.msgID=t}isLastMsgInChat(e,t){const s=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t);const a=this.messages[s][t].timeSent;let n=t==ChatFuncs.getChatLastMsgObj(s).msgID,o=a==ChatFuncs.getChatLastMsgObj(s).timeSent;return n&&o}getChatMsgsAsArr(e,t=!1){const s=ChatBody.makeChatID_DB_Usable(e);let a=this.getChatMessages(s);return a=Object.values(a),a=t?a.sort(((e,t)=>e.msgID-t.msgID)):a.sort(((e,t)=>t.msgID-e.msgID)),a}gotAllMsgs(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.gotAllMsgsStatus[t]}markChatAsGotAllMsgs(e){const t=ChatBody.makeChatID_DB_Usable(e);this.gotAllMsgsStatus[t]=!0}setMsgIsStaring(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t),this.messages[a][t].isStaring=s}setMsgIsDeleting(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t),this.messages[a][t].isDeleting=s}msgIsStaring(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t].isStaring}msgIsDeleting(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t].isDeleting}}const MessagesDB=new MessagesDBInstance,MsgOnSendingDB=new MsgOnSendingDBInstance,ChatBoxDB=new ChatBoxDBInstance;class LastMsgInstance{constructor(e,t,s=!1){this._msgID=e,this._chatID=t,this._isSending=s}get msgID(){return this._msgID}get chatID(){return this._chatID}get isSending(){return this._isSending}get lastMsg(){return this._isSending?MsgOnSendingDB.msgsOnSending[this._chatID][this._msgID].msg:MessagesDB.messages[this._chatID][this._msgID].msg}get timeSent(){return this._isSending?MsgOnSendingDB.msgsOnSending[this._chatID][this._msgID].date:MessagesDB.messages[this._chatID][this._msgID].timeSent}get read(){return this._isSending?MsgOnSendingDB.msgsOnSending[this._chatID][this._msgID].read:MessagesDB.messages[this._chatID][this._msgID].read}get isSender(){return!!this._isSending||MessagesDB.messages[this._chatID][this._msgID].isSender}get timeSentString(){return this._isSending?MsgOnSendingDB.msgsOnSending[this._chatID][this._msgID].dateSentString:MessagesDB.messages[this._chatID][this._msgID].timeSentString}get deletedText(){if(!this._isSending)return MessagesDB.messages[this._chatID][this._msgID].deletedText}set msgID(e){}set chatID(e){}set isSending(e){}set lastMsg(e){}set timeSent(e){}set read(e){}set isSender(e){}set timeSentString(e){}set deletedText(e){}}class ChatInstance{constructor(e,t=!1){this._chatID=e.chatID,this._user_id=e.user_id,this._admin_id=e.admin_id,this._pined=!1,this._pinedTime=0,e.message_id?this._lastMsgObj=new LastMsgInstance(e.message_id,e.chatID):this._lastMsgObj=null,this._isPinning=!1,this._isDeleting=!1;const s=e.messages;MessagesDB.saveMsgsRecievedFromDB(e.chatID,s,t)}hadAdmin=()=>this._admin_id;get chatID(){return this._chatID}get profileID(){return MyProfile.isAdmin()?this._user_id:this._admin_id}get chatIsOnline(){let e=!1;const t=this.profileID;return t&&(e=ProfilesDB.isOnline(t)),e}get imgSrc(){return ProfilesDB.getP_pix(this.profileID)}get name(){return ProfilesDB.getName(this.profileID)}get unreadMsgCount(){return UnseenMsgIDs.count(this.chatID)}get pined(){return this._pined}get admin_id(){return this._admin_id}get pinedTime(){return this._pinedTime}get sortTime(){return this.pinedTime?1e3*this.pinedTime:this._lastMsgObj?this._lastMsgObj.timeSent:0}get lastSeen(){return this.profileID?ProfilesDB.getLastSeen(this.profileID):null}get recieverIsOnline(){return this.profileID?ProfilesDB.isOnline(this.profileID):null}get lastSeenString(){return this.lastSeen?"online"==this.lastSeen?"online":TimeFunctions.generateTimeSentStringT1(this.lastSeen):null}get lastMsgObj(){return this._lastMsgObj}get isPinning(){return!!this._isPinning}get isDeleting(){return!!this._isDeleting}set chatID(e){}set profileID(e){}set chatIsOnline(e){}set imgSrc(e){}set name(e){}set unreadMsgCount(e){}set pined(e){this._pined=e}set admin_id(e){this._admin_id=e}set pinedTime(e){this._pinedTime=e}set sortTime(e){}set lastSeen(e){}set recieverIsOnline(e){}set lastSeenString(e){}set lastMsgObj(e){}setLastMsgObj=(e,t=!1)=>{this._lastMsgObj=new LastMsgInstance(e,this.chatID,t)};set isPinning(e){this._isPinning=!!e}set isDeleting(e){this._isDeleting=!!e}getChat(){return this}}class ChatsDBInstance{constructor(){this._chats={},this._activeChat,this._gotAllChats=!1,this._searchingChats,this._isSelectingChats}get JsonListIds(){let e=Object.keys(this._chats);return JSON.stringify(e)}get chats(){return this._chats}get activeChat(){return this._activeChat}get chatsCount(){return this.getChatsAsArr().length}get gotAllChats(){return this._gotAllChats}get searchingChats(){return this._searchingChats}get isSelectingChats(){return this._isSelectingChats}set chats(e){}set activeChat(e){this._activeChat=!!e&&ChatBody.makeChatID_DB_Usable(e)}set chatsCount(e){}set gotAllChats(e){!0!==e&&"true"!==e||(this._gotAllChats=!0)}set searchingChats(e){this._searchingChats=!0===e||"true"===e}set isSelectingChats(e){this._isSelectingChats=!0===e||"true"===e}getLatestMsg=()=>{let e=Object.values(this.chats);return e.length?(e.sort(((e,t)=>[t.lastMsgObj.msgID-e.lastMsgObj.msgID])),MessagesDB.getMessageObj(e[0].chatID,e[0].lastMsgObj.msgID)):null};saveChatsRecievedFromDB(e,t=!1){t||e.length<Settings.ApiSettings.chatsPerAPICall&&(this.gotAllChats=!0),e.forEach((e=>{e.chatID||(e.chatID=e.chat_id),this._chats[e.chatID]?this.addChatMsgs(e,t):this.addChat(e,t)}))}addChatMsgs(e,t=!1){if(e.skip)return;const s=e.messages;return s&&MessagesDB.saveMsgsRecievedFromDB(e.chatID,s,t),this.chats[e.chatID]}addChat(e,t=!1){if(!e.skip)return e.chatID=e.id,this._chats[e.chatID]?this._chats[e.chatID]:(this._chats[e.chatID]=new ChatInstance(e,t),this.chats[e.chatID])}deleteChat(e){const t=ChatBody.makeChatID_DB_Usable(e);return delete this.chats[t],!this.chats[t]&&(MessagesDB.deleteChat(t),!0)}getChatsByProfileId=e=>Object.values(this.chats).filter((t=>t.profileID==e));get sortedChats(){return Object.values(this.chats).sort(((e,t)=>t.sortTime-e.sortTime))}set sortedChats(e){}getNextDBChatID(e,t=!1){e=ChatBody.makeChatID_DB_Usable(e);let s=this.sortedChats,a=0,n=!1,o=-1;for(;a<s.length&&!n;){if(s[a].chatID==e)if(n=!0,o=-2,t){let e=a+1,t=!1;for(;e<s.length&&!t;){let a=s[e].chatID;a=ChatBody.makeChatIDUsable(a),document.getElementById(a)&&(t=!0,o=s[e].chatID),e++}}else s[a+1]&&(o=s[a+1].chatID);a++}return o}setChatPinedStatus(e,t,s=Date.parse(new Date)){t||(s=null);const a=ChatBody.makeChatID_DB_Usable(e);this.chats[a].pined=t,this.chats[a].pinedTime=s}setChatLastMsgObj(e,t,s=!1,a=!1){let n=!1;const o=ChatBody.makeChatID_DB_Usable(e);if(!this.chats[o])return n;const l=this.chats[o].lastMsgObj;if(l.msgID){if(a)return this.chats[o].setLastMsgObj(t,s),!0;let e=null;e=s?MsgOnSendingDB.getMsgOnSendingObj(o,t).date:MessagesDB.getMessageObj(o,t).timeSent,parseInt(e)>=parseInt(l.timeSent)&&(this.chats[o].setLastMsgObj(t,s),n=!0)}else this.chats[o].setLastMsgObj(t,s),n=!0;return n}convertLastMsgSendingToLastMsg(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e),n=this.chats[a].lastMsgObj;return!(n.msgID!=t||!n.isSending||(this.chats[a].setLastMsgObj(s),0))}setChatIsPinning(e,t){const s=ChatBody.makeChatID_DB_Usable(e);this.chats[s].isPinning=t}setChatIsDeleting(e,t){const s=ChatBody.makeChatID_DB_Usable(e);this.chats[s].isDeleting=t}chatIsPinning(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].isPinning}chatIsDeleting(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].isDeleting}getChatImage(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].imgSrc}getChatName(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].name}getChatUnreadMsgCount(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].unreadMsgCount}getChatPinedStatus(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].pined}getChatLastMsgObj(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].lastMsgObj}getChatLastSeen(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].lastSeen}getChatLastSeenString(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].lastSeenString}recieverIsOnline(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].recieverIsOnline}chatObjIsAvailable(e){const t=ChatBody.makeChatID_DB_Usable(e);let s=this._chats[t];return!!s&&!!s.chatID}getChatObj(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t]}getChatsAsArr(){return Object.values(this.chats)}getAllProfileIDs(){let e=this.getChatsAsArr(),t=[];return e.forEach((e=>{t.push(e.profileID)})),t}chatHadAdmin=e=>{const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].hadAdmin()}}const ChatsDB=new ChatsDBInstance;class ChatBody{static markChatAsActive=(e,t=!1)=>{if(!e)return;e=ChatBody.makeChatIDUsable(e);const s=document.getElementById(e);s&&(t?s.classList.remove("active"):s.classList.add("active"))};static loadChatMessages=e=>{if(GlobalVars.chatsAreSelected)return;let t=e.target,s=t.classList,a=t;if(!a.dataset.id)for(;!a.dataset.id;)a=a.parentElement;let n=a.dataset.id,o=document.getElementById(n);if(!o)return;if(!ChatContainDOM.isSelectable(o))return;o.removeEventListener("touchend",ChatBody.loadChatMessages),o.removeEventListener("touchcancel",ChatBody.loadChatMessages);const l=["nameSubContain","chatSubContain","lMeg"];let i=!1,r=0;for(;r<l.length&&!i;)s.contains(l[r])&&(i=!0),r++;if(!i)return;let c=ChatsDB.activeChat;ChatBody.makeChatID_DB_Usable(c)!=ChatBody.makeChatID_DB_Usable(n)&&(ChatBody.markChatAsActive(c,!0),ChatBody.markChatAsActive(n),ChatsDB.activeChat=n,MsgBody.loadActiveChatMessages())};static loadNoUserMesage(e=!1){ChatBody.markChatAsActive(ChatsDB.activeChat,!0),MsgSectionDOM.clear(),ChatsDB.activeChat=null;const t=DOMGetter.getMessage();let s=DOMGetter.getLoaderBackgroundElem(t),a=DOMGetter.getContentLoaderElem(t);s||LoaderBackgroundDOM.append(t,LoaderBackgroundDOM.create()),a||ContentLoaderDOM.append(t,ContentLoaderDOM.create(!0,"boxes")),MsgSectionDOM.load(!0,e),MessageFuncs.pushInMsgNoUser(),s=DOMGetter.getLoaderBackgroundElem(t),a=DOMGetter.getContentLoaderElem(t),s&&LoaderBackgroundDOM.delete(t),a&&ContentLoaderDOM.delete(t)}static selectUnselectChat(e){const t=DOMGetter.getChatHeadCount();let s=e.target.dataset.id,a=document.getElementById(s),n=a.getElementsByClassName("chatSelect")[0];if(!ChatContainDOM.isSelectable(a))return;ChatBody.updateSelectedChatsID(s)?(n&&ChatSelectedIconDOM.delete(s),a.style.background="#F5F5F5",ChatSelectedIconDOM.append(s,ChatSelectedIconDOM.create())):(a.style.background="",ChatSelectedIconDOM.delete(s)),t.innerHTML=GlobalVars.selectedChatsID.length;const o=Settings.ChatOptions,l=DOMGetter.getChatHeadPin(),i=DOMGetter.getChatHeadDelete();GlobalVars.selectedChatsID.length>1?(o.groupChatPin?l||ChatHeadSelectedDOM.appendIcon(ChatHeadSelectedDOM.createChatPinIcon()):l&&ChatHeadSelectedDOM.deleteIcon(l),o.groupDelChat?i||ChatHeadSelectedDOM.appendIcon(ChatHeadSelectedDOM.createChatDelIcon()):i&&ChatHeadSelectedDOM.deleteIcon(i)):(o.pinChat&&(l||ChatHeadSelectedDOM.appendIcon(ChatHeadSelectedDOM.createChatPinIcon())),o.deleteChat&&(i||ChatHeadSelectedDOM.appendIcon(ChatHeadSelectedDOM.createChatDelIcon())))}static touchedThisChatThenDrag(e){const t=DOMGetter.getChatBody();clearTimeout(GlobalVars.megChatTouchedTimeOut);let s=t.getBoundingClientRect(),a=e.touches[0].clientY,n=GlobalVars.touchYPos-a;s.top<=a&&s.bottom>=a&&t.scrollTo(t.scrollLeft,t.scrollTop+n),GlobalVars.touchYPos=a}static touchedThisChat(e){e.preventDefault();const t=DOMGetter.getChatHeadCount();GlobalVars.touchYPos=e.touches[0].clientY;let s=e.target;if(!s.dataset.id)for(;!s.dataset.id;)s=s.parentElement;let a=s.dataset.id,n=document.getElementById(a);GlobalVars.chatsAreSelected||(n.addEventListener("touchend",ChatBody.loadChatMessages),n.addEventListener("touchcancel",ChatBody.loadChatMessages)),GlobalVars.chatsAreSelected||(GlobalVars.megChatTouchedTimeOut=setTimeout((()=>{let s=document.getElementById(a);ChatContainDOM.isSelectable(s)&&(s.getElementsByClassName("chatSelect")[0]&&ChatSelectedIconDOM.delete(a),s.removeEventListener("touchend",ChatBody.loadChatMessages),s.removeEventListener("touchcancel",ChatBody.loadChatMessages),ChatGroupActivations.allChatSelected(),ChatGroupDeactivations.removeAllChatHoverEffect(),s.style.background="#F5F5F5",ChatSelectedIconDOM.append(a,ChatSelectedIconDOM.create()),ChatBody.updateSelectedChatsID(a),t.innerHTML=GlobalVars.selectedChatsID.length,e.target.removeEventListener("touchend",OtherFunctions.clearMegChatTouchedTimeOut),e.target.removeEventListener("touchcancel",OtherFunctions.clearMegChatTouchedTimeOut),e.target.removeEventListener("touchmove",ChatBody.touchedThisChatThenDrag))}),1e3)),e.target.addEventListener("touchend",OtherFunctions.clearMegChatTouchedTimeOut),e.target.addEventListener("touchcancel",OtherFunctions.clearMegChatTouchedTimeOut),e.target.addEventListener("touchmove",ChatBody.touchedThisChatThenDrag)}static updateSelectedChatsID(e){e=ChatBody.makeChatIDUsable(e);let t=GlobalVars.selectedChatsID.indexOf(e),s=!1;return t<0?(GlobalVars.selectedChatsID.push(e),s=!0):GlobalVars.selectedChatsID.splice(t,1),s}static emptySelectedChatsID(){GlobalVars.selectedChatsID&&GlobalVars.selectedChatsID.splice(0,GlobalVars.selectedChatsID.length)}static makeChatIDUsable(e){return/chat/.test(e)||(e="chat-"+e),e}static makeChatID_DB_Usable(e){return/chat/.test(e)&&(e=e.split("chat-").splice(-1)[0]),e}}class GenerateAPIRes{static deleteMessageRes(e,t,s){const a=[1,2,3,4,null],n=[];return t.forEach((e=>{const t={msgID:e,delCodeNo:a[Math.round(4*Math.random())]};n.push(t)})),{chatID:e,delCodeNoArr:n}}static deleteChatRes(e){const t=[1,2,3,4,null],s=[];return e.forEach((e=>{const a={chatID:e.chatID,isDeleted:t[Math.round(4*Math.random())]};s.push(a)})),s}static pinChatRes(e){const t=[];return e.forEach((e=>{e=ChatBody.makeChatIDUsable(e);let s=!0;document.getElementById(e).getElementsByClassName("lMegContain2")[0].getElementsByClassName("chatPined")[0]&&(s=!1);const a={chatID:e,pinStatus:s,pinedTime:Date.parse(new Date)};t.push(a)})),t}static starMsgRes(e,t){const s={chatID:ChatBody.makeChatID_DB_Usable(e),result:[]};return t.forEach((t=>{let a=!0;MessageFuncs.getMessageObj(e,t).stared&&(a=!1);const n={msgID:t,starStatus:a};s.result.push(n)})),s}static msgSentSignalRes(e){let t=GenerateDummyDatabase.messages(e.chatID,null,!0,!1,e);return t.msgSendingID=e.msgSendingID,t}}class UpdateChatDOM{static doFullSwitch=e=>{const t=ChatBody.makeChatIDUsable(e.chatID),s=document.getElementById(t);s&&s.parentElement.replaceChild(ChatContainDOM.create(e),s)};static deleteChatElem(e){e=ChatBody.makeChatIDUsable(e),ChatContainDOM.delete(e)}static imageElem(e){e=ChatBody.makeChatIDUsable(e),document.getElementById(e).getElementsByClassName("chatPix")[0].getElementsByTagName("img")[0].src=ChatsDB.getChatImage(e)}static nameElem(e){e=ChatBody.makeChatIDUsable(e),document.getElementById(e).getElementsByClassName("nameContain")[0].getElementsByClassName("nameSubContain")[0].innerHTML=ChatsDB.getChatName(e)}static chatCountElem(e){e=ChatBody.makeChatIDUsable(e);const t=document.getElementById(e);if(!t)return;const s=t.getElementsByClassName("lMegContain2")[0].getElementsByClassName("chatCount")[0],a=ChatsDB.getChatUnreadMsgCount(e);s&&ChatCountDOM.delete(e),a&&ChatCountDOM.append(e,ChatCountDOM.create(a))}static pinedElem(e){e=ChatBody.makeChatIDUsable(e);const t=document.getElementById(e).getElementsByClassName("lMegContain2")[0].getElementsByClassName("chatPined")[0];ChatsDB.getChatPinedStatus(e)?t||ChatPinedDOM.append(e,ChatPinedDOM.create()):t&&ChatPinedDOM.delete(e),ChatDOMFunc.putChatContainElemInPosition(e,!0)}static lMegElem(e,t=!1){e=ChatBody.makeChatIDUsable(e);const s=ChatsDB.getChatLastMsgObj(e),a=document.getElementById(e);if(!a)return;const n=a.getElementsByClassName("chatSubContain")[0],o=n.getElementsByClassName("chatTimeContain")[0],l=(n.getElementsByClassName("lMegRead")[0],n.getElementsByClassName("lMeg")[0]);UpdateChatDOM.lMegReadElem(e),o.innerHTML=s.timeSentString,s.deletedText?l.innerHTML=s.deletedText:l.innerHTML=s.lastMsg,t||ChatDOMFunc.putChatContainElemInPosition(e,!0)}static lMegReadElem(e){e=ChatBody.makeChatIDUsable(e);const t=ChatsDB.getChatLastMsgObj(e);if(document.getElementById(e).getElementsByClassName("chatSubContain")[0].getElementsByClassName("lMegRead")[0]&&LMegReadDOM.delete(e),!t.deletedText&&t.isSender){let s="",a="",n=t.read;"read"==n&&(s="read"),a="sent"==n?"done":"done_all","sending"==n&&(a="sync"),LMegReadDOM.append(e,LMegReadDOM.create(s,a))}}static chatOnlineElem(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(!t)return;let s=t.getElementsByClassName("chatPix")[0];if(!s){let e="chatPixElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}const a=s.getElementsByClassName("online")[0];ChatFuncs.recieverIsOnline(e)?a||ChatOnlineIconDOM.append(e,ChatOnlineIconDOM.create()):a&&ChatOnlineIconDOM.delete(e)}}class UnseenMsgIDs{static add(e,t){const s=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t),MessagesDB.unseenMsgIDs[s]||(MessagesDB.unseenMsgIDs[s]=[]),MessagesDB.unseenMsgIDs[s].indexOf(t)<0&&MessagesDB.unseenMsgIDs[s].push(t)}static remove(e,t){const s=ChatBody.makeChatID_DB_Usable(e);if(t=MsgBody.makeMsgID_DB_Usable(t),!MessagesDB.unseenMsgIDs[s])return;let a=MessagesDB.unseenMsgIDs[s].indexOf(t);a>=0&&MessagesDB.unseenMsgIDs[s].splice(a,1)}static get(e,t=!1){const s=ChatBody.makeChatID_DB_Usable(e);return MessagesDB.unseenMsgIDs[s]||(MessagesDB.unseenMsgIDs[s]=[]),t?(MessagesDB.unseenMsgIDs[s].sort(((e,t)=>e-t)),MessagesDB.unseenMsgIDs[s][0]):MessagesDB.unseenMsgIDs[s]}static getSeen(e){const t=ChatBody.makeChatID_DB_Usable(e),s=this.get(t),a=MessageFuncs.getMsgsIdNtSender(t,s);return a.length?a:null}static count(e){const t=ChatBody.makeChatID_DB_Usable(e);return MessagesDB.unseenMsgIDs[t]||(MessagesDB.unseenMsgIDs[t]=[]),MessagesDB.unseenMsgIDs[t].length}}class MessageFuncs{static async fetchOldMsgs(e,t=null){const s=ChatBody.makeChatID_DB_Usable(e),a=this.getFirstMsgInDBID(s);if(MessagesDB.gotAllMsgs(s))return null;let n=DOMGetter.getLoadOlderMsgsBtn(),o=DOMGetter.getLoaderBackgroundElem(n),l=DOMGetter.getContentLoaderElem(n);o||LoaderBackgroundDOM.append(n,LoaderBackgroundDOM.create()),l||ContentLoaderDOM.append(n,ContentLoaderDOM.create(!0,"boxes")),t&&(t=MsgBody.makeMsgID_DB_Usable(t));let i=await MsgApis.fetchOldMsgs(e,a,t);if(null==i)return alert("err"),void console.log("err");MessagesDB.saveMsgsRecievedFromDB(e,i)}static getReadStatOfUnreadFromDB=async()=>{const e=this.getAllMsgIdsWithUnreadStat();if(!e.length)return;const t=await MsgApis.getReadStatOfMsgFromList(e);t&&t.forEach((e=>{this.updateDeliverTime(e.chat_id,e.id,e.read_status,e.deliver_time),this.updateReadStatus(e.chat_id,e.id,e.read_status,e.read_time)}))};static pushInNewMsg(e,t,s=null){if(s||(s=(s=this.getChatMsgsAsArr(e))[s.length-1]),!ChatFuncs.isActiveChat(e))return;if(t==s){let e="some error occoured",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}let a=null;if(s.dateSentString!=t.dateSentString&&MsgDateDOM.append(MsgDateDOM.create(t.dateSentString)),a=t.first?MsgGroupContainDOM.create(t,!0):MsgGroupContainDOM.getLastGroupConatinFromDOM(),t.deleted)DeletedMsgDOM.append(DeletedMsgDOM.create(t),a);else{const e=MsgWraperDOM.create(t);this.isSelectingMsgs()&&MsgGroupActivations.allSelected_Megchecked(e),MsgWraperDOM.append(e,a)}const n=t.msgID,o=MsgBody.msgIsSeeable(n);if(null!==o)o&&this.sendMsgSeenSignal(e,n);else{let e="mg id not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static pushInMsgSending(e,t){if(!ChatFuncs.isActiveChat(e)){let e="ome error occoured",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}let s;const a=MsgGroupContainDOM.getLastGroupConatinFromDOM(!0);if(a.classList.contains("msgSendingWrapper"))s=MsgOnSendingDB.getMsgSendingInstance(e,a.dataset.id);else{const t=MsgBody.makeMsgID_DB_Usable(a.id);s=MessagesDB.getMessageObj(e,t)}let n=null;s.dateSentString!=t.dateSentString&&(MsgDateDOM.append(MsgDateDOM.create(t.dateSentString)),n=!0),n=n||!s.isSender?MsgGroupContainDOM.create(t,!0):MsgGroupContainDOM.getLastGroupConatinFromDOM();const o=MsgSendingWraperDOM.create(t);MsgWraperDOM.append(o,n)}static pushInNewDOMUnaddedMsgs=()=>{const e=ChatFuncs.getActiveChat();if(!e)return;const t=MsgWraperDOM.getLastMsgElem(),s=MsgBody.makeMsgID_DB_Usable(t.id),a=MessagesDB.getChatMsgsAsArr(e,!0).filter((e=>e.msgID>s));let n=MessagesDB.getMessageObj(e,s),o=0;for(;o<a.length;){const t=a[o];this.pushInNewMsg(e,t,n),o++,n=t}};static _processMsgPushIn=(e,t,s,a,n)=>{let o,l=t[e];if(e){let i=t[e-1].dateSentString;i!=l.dateSentString&&(o=MsgDateDOM.create(i),MessageBodyDOM.appendElemBeforeElem(o,a),a=o,s=MsgGroupContainDOM.getByMsgObject(l),MessageBodyDOM.appendElemBeforeElem(s,a),a=s,n=!1)}return n&&(n=!1,s=MsgGroupContainDOM.getByMsgObject(l),MessageBodyDOM.appendElemBeforeElem(s,a),a=s),l.deleted?(o=DeletedMsgDOM.create(l),MsgGroupContainDOM.appendElemTop(o,s)):(o=MsgWraperDOM.create(l),this.isSelectingMsgs()&&MsgGroupActivations.allSelected_Megchecked(o),MsgGroupContainDOM.appendElemTop(o,s)),l.first&&(n=!0),[s,a,n]};static pushMessagesIn(e){const t=ChatBody.makeChatID_DB_Usable(e);if(MessagesDB.messages[t]||(console.log("pushMessagesIn, no run"),this.fetchMessages(e)),!ChatFuncs.isActiveChat(e))return;const s=Settings.ApiSettings.messagesPerAPICall;let a=UnseenMsgIDs.get(t,!0);a||(a=0);let n,o=this.getChatMsgsAsArr(e),l=0,i=0,r=null,c=!1,d=!1,g=null,h=!1;for(;!d&&i<o.length;){let e,t=o[i];if(n=t,l=t.msgID,a?(c=l<=a,d=c&&i>s-1):d=i>=s-1,!i){t.deleted?(e=DeletedMsgDOM.create(t),DeletedMsgDOM.append(e,g)):(e=MsgWraperDOM.create(t),this.isSelectingMsgs()&&MsgGroupActivations.allSelected_Megchecked(e),g=MsgGroupContainDOM.getByMsgObject(t,!0),MsgWraperDOM.append(e,g)),i++,r=g,t.first&&(h=!0);continue}const M=this._processMsgPushIn(i,o,g,r,h);g=M[0],r=M[1],h=M[2],i++}if(n){let e=MsgDateDOM.create(n.dateSentString);MessageBodyDOM.appendElemBeforeElem(e,r),r=e}DOMGetter.getLoadOlderMsgsBtn()&&LoadOlderMsgsBtnDOM.delete(),(o.length>MsgWraperDOM.getCounnt()||!MessagesDB.gotAllMsgs(t))&&LoadOlderMsgsBtnDOM.append(LoadOlderMsgsBtnDOM.create()),OtherFunctions.activateMsgDateBeforeAfterfunc()}static pushInMsgNoUser(){const e=MsgWraperDOM.createNoUser(),t=MsgGroupContainDOM.createNoser(!0);MsgWraperDOM.append(e,t)}static pushMsgSendingIn(e){const t=ChatBody.makeChatID_DB_Usable(e);if(!MsgOnSendingDB.hasMsgSending(t))return;if(!ChatFuncs.isActiveChat(t))return;let s=this.getChatMsgsAsArr(e);s=s[s.length-1];let a=MsgOnSendingDB.getChatMsgOnSendingAsArr(e),n=0;a.forEach((t=>{n&&(s=MsgOnSendingDB.getChatMsgOnSendingAsArr(e),s=s.filter((e=>e.date<t.date)),s=s[s.length-1]),s.dateSentString!=t.dateSentString&&MsgDateDOM.append(MsgDateDOM.create(t.dateSentString)),MsgSendingWraperDOM.append(MsgSendingWraperDOM.create(t)),n++}))}static async pushInPreviousMsgs(e,t=null){const s=ChatBody.makeChatID_DB_Usable(e),a=MsgBody.getFirstMsgOnDomId(),n=MsgBody.makeMsgID_DB_Usable(a),o=Settings.ApiSettings.messagesPerAPICall;if(!this.isValidMsgID(s,a)){let e="some error occured",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const l=MsgBody.getElemAbsolutePos(a,!0);if(!ChatFuncs.isActiveChat(s))return;let i=this.getChatMsgsAsArr(s);if(i=i.filter((e=>parseInt(e.msgID)<n)),t||i.length<o&&!MessagesDB.gotAllMsgs(s)&&(await this.fetchOldMsgs(s),i=this.getChatMsgsAsArr(s),i=i.filter((e=>parseInt(e.msgID)<n))),t){if(this.isValidMsgID(s,t)||await this.fetchOldMsgs(s,t),!this.isValidMsgID(s,t)){let e="some error occured",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}i=this.getChatMsgsAsArr(s),i=i.filter((e=>e.msgID<a))}if(!i[0]){let e="some error occured",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}let r,c,d=0,g=i[0].msgID+1,h=null,M=null,m=!1,u=this.getMessageObj(s,a);if(u){if(MsgDateDOM.deleteFirstOnPage(),h=MsgWraperDOM.create(u),this.isSelectingMsgs()&&(MsgGroupActivations.allSelected_Megchecked(h),MsgBody.msgIsSelected(u.msgID)&&MessageBodyDOM.markAsSelected(h,s)),MsgWraperDOM.replace(a,h),i[0].dateSentString!=u.dateSentString){let e=MsgDateDOM.create(u.dateSentString);MessageBodyDOM.appendElemBeforeElem(e,h),h=e}M=h.parentElement.parentElement,h=M,u.first&&(m=!0)}for(c=t?t<g:d<o&&d<i.length;c;){r=i[d],g=r.msgID;const e=this._processMsgPushIn(d,i,M,h,m);M=e[0],h=e[1],m=e[2],d++,c=t?t<g:d<o&&d<i.length}if(r){let e=MsgDateDOM.create(r.dateSentString);MessageBodyDOM.appendElemBeforeElem(e,h),h=e}DOMGetter.getLoadOlderMsgsBtn()&&LoadOlderMsgsBtnDOM.delete(),(i.length>MsgWraperDOM.getCounnt()||!MessagesDB.gotAllMsgs(s))&&LoadOlderMsgsBtnDOM.append(LoadOlderMsgsBtnDOM.create()),MsgBody.setElemAbsolutePos(l,a,!0),OtherFunctions.activateMsgDateBeforeAfterfunc()}static markChatAsGotAllMsgs(e){MessagesDB.markChatAsGotAllMsgs(e)}static addMessage(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return MessagesDB.addMessage(s,t)}static getFirstMsgInDBID(e){const t=this.getChatMsgsAsArr(e),s=t[t.length-1];if(!s){let e="some error occured",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}return s.msgID||null}static updateReadStatus(e,t,s,a){const n=ChatBody.makeChatID_DB_Usable(e);if(MessagesDB.setReadStatus(n,t,s,a)&&(UpdateMsgDOM.readElem(e,t),this.isLastMsgInChat(e,t))){const s=this.getMessageObj(e,t);ChatFuncs.updateChatLastMsgObj(e,s,!0)}}static updateDeliverTime(e,t,s,a){const n=ChatBody.makeChatID_DB_Usable(e);if(MessagesDB.setDeliverTime(n,t,s,a)&&(UpdateMsgDOM.readElem(e,t),this.isLastMsgInChat(e,t))){const s=this.getMessageObj(e,t);ChatFuncs.updateChatLastMsgObj(e,s,!0)}}static updateStaredStatus(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e);MessagesDB.setStaredStatus(a,t,s),UpdateMsgDOM.starElem(e,t)}static correctFirstStatus(e,t){const s=ChatBody.makeChatID_DB_Usable(e),a=this.getMessageObj(s,t);let n=this.getChatMsgsAsArr(s);n=n.filter((e=>e.msgID<t)),n=n[n.length-1],a.prevMsgId=n.msgID}static getAllMsgIdsWithUnreadStat=()=>{const e=[];return Object.values(MessagesDB.messages).forEach((t=>{Object.values(t).forEach((t=>{t.isSender&&"read"!=t.read&&e.push(t.msgID)}))})),e};static getAllMsgIdsToBeMarkedAsDeliveredToMe=()=>{const e={};return MessagesDB.messagesWithAdmin.forEach((t=>{Object.values(t).forEach((t=>{if(!t.isSender&&"sent"==t.read){const s=t.chatID;e[s]||(e[s]=[]),e[s].push(t.msgID)}}))})),e};static getChatMsgIdsToBeMarkedAsDeliveredFromMe=e=>{const t=[],s=ChatBody.makeChatID_DB_Usable(e);let a=MessagesDB.messages[s];return a&&Object.values(a).forEach((e=>{e.isSender&&"sent"==e.read&&t.push(e.msgID)})),t};static getMyChatMsgIdsToBeAsSeen=e=>{const t=[],s=ChatBody.makeChatID_DB_Usable(e);let a=MessagesDB.messages[s];return a&&Object.values(a).forEach((e=>{e.isSender&&"delivered"==e.read&&t.push(e.msgID)})),t};static getMsgsIdNtSender=(e,t=null)=>{let s=[];const a=ChatBody.makeChatID_DB_Usable(e);let n=MessagesDB.messages[a];return n&&Object.values(n).forEach((e=>{e.isSender||s.push(e.msgID)})),t&&(s=s.filter((e=>!t.includes(parseInt(e))))),s};static getMsgSenderClass(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return MessagesDB.getSenderClass(s,t)}static getMessageObj(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return MessagesDB.getMessageObj(s,t)}static getRepliedMsgObj(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return MessagesDB.getMessageObj(s,t).replyedMegObj||null}static setMsgInfoInView(e,t){const s=ChatBody.makeChatID_DB_Usable(e);MessagesDB.setMsgInfoInView(s,t)}static setMsgIsStaring(e,t,s){MessagesDB.setMsgIsStaring(e,t,s)}static setMsgIsDeleting(e,t,s){MessagesDB.setMsgIsDeleting(e,t,s)}static msgIsStaring(e,t){return MessagesDB.msgIsStaring(e,t)}static msgIsDeleting(e,t){return MessagesDB.msgIsDeleting(e,t)}static isSelectingMsgs(){return MessagesDB.isSelectingMsgs}static setIsSelectingMsgs(e){MessagesDB.isSelectingMsgs=e}static deleteMessage(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e);if(s&&(MessagesDB.deleteMessage(a,t,s),UpdateMsgDOM.deletedMsgElem(a,t),this.isLastMsgInChat(e,t))){const s=this.getMessageObj(e,t);ChatFuncs.updateChatLastMsgObj(e,s)}}static isLastMsgInChat(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return MessagesDB.isLastMsgInChat(s,t)}static getChatMsgsAsArr(e){const t=ChatBody.makeChatID_DB_Usable(e);return MessagesDB.getChatMsgsAsArr(t)}static isValidMsgID(e,t){return MessagesDB.getMessageObj(e,t,!0)}static _sendMsgSeenSignal=async e=>{if(!e)return;const t=["msgseensig",e];MyWebSocket.sendMessage(JSON.stringify(t))};static sendMsgSeenSignal(e,t,s=!1){if(s&&!ChatFuncs.isActiveChat(e))return;const a={};if(s){const s=MessagesDB.getChatMessages(e),n=UnseenMsgIDs.get(e);let o=0,l=0;for(;o<n.length&&l<t;){let t=s[n[o]];l=t.msgID,"read"==t.read||t.isSender||(MessagesDB.setReadStatus(e,l,"read",null),UnseenMsgIDs.remove(e,l),a[e]||(a[e]=[]),a[e].push(l)),o++}}else{let s=MessagesDB.getMessageObj(e,t);"read"==s.read||s.isSender||(MessagesDB.setReadStatus(e,t,"read",null),UnseenMsgIDs.remove(e,t),a[e]||(a[e]=[]),a[e].push(t))}Object.keys(a).forEach((e=>{const t=a[e];let s=t[0],n=t[0];t.length<2?s="":t.forEach((e=>{e<s&&(s=e),e>n&&(n=e)})),a[e]=`${n}_${s}`})),this._sendMsgSeenSignal(a),ChatFuncs.updateChatUnreadMsgCount(e)}static recieveMsgDeliveredSignal=(e,t,s)=>{const a=[];if((t=t.split("_"))[0]){if(t[1]){const s=this.getChatMsgIdsToBeMarkedAsDeliveredFromMe(e),n=parseInt(t[1]),o=parseInt(t[0]);s.forEach((e=>{e>=n&&e<=o&&a.push(e)}))}else a.push(parseInt(t[0]));MessagesDB.messages[e]&&a.forEach((t=>{this.updateDeliverTime(e,t,"delivered",s)}))}};static recieveMsgSeenSignal=(e,t,s)=>{const a=[];if((t=t.split("_"))[0]){if(t[1]){const s=this.getMyChatMsgIdsToBeAsSeen(e),n=parseInt(t[1]),o=parseInt(t[0]);s.forEach((e=>{e>=n&&e<=o&&a.push(e)}))}else a.push(parseInt(t[0]));MessagesDB.messages[e]&&a.forEach((t=>{this.updateReadStatus(e,t,"read",s)}))}};static sendMsgRecivedSignal=async(e=null)=>{let t=!1;e||(e=this.getAllMsgIdsToBeMarkedAsDeliveredToMe(),t=!0);const s=Object.keys(e);if(!s.length)return;t&&s.forEach((t=>{const s=e[t];let a="";s.length>1&&(a=s.shift());const n=`${s.pop()}_${a}`;e[t]=n}));const a=["msgrecvsig",e];MyWebSocket.sendMessage(JSON.stringify(a))};static recieveMsgSentSignal=(e,t,s,a)=>{s&&alert(a);const n=t.chat_id,o=t.id,l=MessagesDB.convertMsgSendingToMsg(e,t);if(ChatFuncs.isActiveChat(n)){let t=this.getMessageObj(n,o);if(!t){let e="unale to create newMsgInstannce",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}let s=MsgWraperDOM.create(t);this.isSelectingMsgs()&&MsgGroupActivations.allSelected_Megchecked(s),MsgSendingWraperDOM.convertToMsg(e,s)||this.pushInNewMsg(n,t)}l&&(UpdateChatDOM.lMegElem(n),ChatFuncs.updateChatUnreadMsgCount(n))};static sendMsg=e=>{let t="";e.rMsg&&(t=e.rMsg.msgID);let s=null;if(MyProfile.isAdmin()){const e=ChatFuncs.getActiveChat();if(!ChatFuncs.chatHadAdmin(e)&&(s=UnseenMsgIDs.getSeen(e),s)){s=s.sort(((e,t)=>e-t));let e="";s.length>1&&(e=s.shift()),s=`${s.pop()}_${e}`}}const a=["sendmsg",e.chatID,e.msgSendingID,e.msg,t,s];MyWebSocket.sendMessage(JSON.stringify(a))};static sendNewChatStartedSignal=e=>{if(!e)return;const t=["newchatstart",e];MyWebSocket.sendMessage(JSON.stringify(t))};static msgDelSignal(){}}class GenerateDummyDatabase{static chatName(){let e="abcdefghijklmnoopqrstuvwxyz",t="abcdefghijklmnoopqrstuvwxyz",s=Math.round(23*Math.random()),a=Math.ceil(10*Math.random())+1;return e=e.substr(s,a),s=Math.round(23*Math.random()),a=Math.ceil(10*Math.random())+1,t=t.substr(s,a),e+" "+t}static msgText(e=10){let t="",s=Math.round(Math.random()*e);for(let e=0;e<s;e++){let s="abcdefghijklmnoopqrstuvwxyz",a=Math.round(23*Math.random()),n=Math.round(5*Math.random())+1;s=s.substr(a,n),t+=e?" "+s:s}return t}static lastMsgObj(){let e={};return e.lastMsg=Math.round(1e4*Math.random()),e.lastMsg=GenerateDummyDatabase.msgText(),e.timeSent=Math.round(15890652e5*Math.random())+5e11,e.read="sent",e.isSender=Math.round(1*Math.random()),e}static replyedMegObj(e){let t=Math.round(1*Math.random());return t?(t={},t.chatID=e,t.msgID=1,t.isSender=Math.round(1*Math.random()),t.msg=GenerateDummyDatabase.msgText(),t.senderName=GenerateDummyDatabase.chatName(),t):null}static chatsAndProfiles(e,t=!1){let s=[],a=[];return e.forEach((e=>{let n={};n.chatID=e,n.profileID=e,n.pined=Math.round(1*Math.random()),t&&(n.pined=!1),n.lastMsgObj=GenerateDummyDatabase.lastMsgObj(),n.pined?(n.pinedTime=Math.round(15890652e5*Math.random())+5e11,n.sortTime=n.pinedTime):n.sortTime=n.lastMsgObj.timeSent;let o=GenerateDummyDatabase.messages(e,[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]);n.messages=o,s.push(n);let l=GenerateDummyDatabase.profile([n.chatID,n.profileID]);a.push(l)})),{chats:s,profiles:a}}static messages(e,t,s=!1,a=!1,n=!1){if(s){let s={};if(s.msgID=t,s.chatID=e,n){let t=MessageFuncs.getChatMsgsAsArr(e);t=t[t.length-1],t=t.msgID,t++,s.msgID=t}return s.msg=n?n.msg:GenerateDummyDatabase.msgText(),s.isSender=Math.round(1*Math.random()),n&&(s.isSender=!0),s.senderID=s.isSender,s.timeSent=Math.round(15890652e5*Math.random())+5e11,s.read=["sent","delivered","read"][Math.floor(3*Math.random())],s.stared=Math.round(1*Math.random()),s.deliverTime=Math.round(15890652e5*Math.random())+5e11,s.readTime=Math.round(15890652e5*Math.random())+5e11,n?n.rMsgID&&(s.replyedMegObj=MessageFuncs.getMessageObj(e,n.rMsgID)):s.replyedMegObj=GenerateDummyDatabase.replyedMegObj(e),s}let o=[];return t.forEach((t=>{let s={};s.chatID=e,s.msgID=t,s.msg=GenerateDummyDatabase.msgText(),s.isSender=Math.round(1*Math.random()),s.senderID=s.isSender,s.timeSent=Math.round(15890652e5*Math.random())+5e11,s.read=a?"read":["sent","delivered","read"][Math.floor(3*Math.random())],s.stared=Math.round(1*Math.random()),s.deliverTime=Math.round(15890652e5*Math.random())+5e11,s.readTime=Math.round(15890652e5*Math.random())+5e11,s.replyedMegObj=GenerateDummyDatabase.replyedMegObj(e),o.push(s)})),o}static profile(e,t=!0){if(!e[0])return;let s={};return s.userID=e[0],t||(s.chatID=e[1]),s.name=GenerateDummyDatabase.chatName(),s.p_pix="./resources/frontend/img/default.jpg",s}}class ChatApis{static async fetchChats_test(e){let t;return Settings.ApiSettings.chatsPerAPICall,t=e?[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,91,98,73,45,46,4626,23,26,267,121,65,684,48,84,374,845,894,487,90,37]:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21],await GenerateDummyDatabase.chatsAndProfiles(t)}static async fetchNewerChatsAfter(e,t=!0){if(!e)return t?await this.fetchAminChats():await this.fetchUserChats();let s=getUserLoginCookie(),a="chats_and_profiles_for_user_after.php";t&&(a="chats_and_profiles_for_admin_after.php",s=getAdminLoginCookie());const n={chats:[],profiles:[]};if(!s)return null;const o=new FormData;o.append("user_id",s),o.append("after",e);const l=await fetch(ServerPaths.getApiPath(a),{method:"post",body:o});if(l.ok){const e=await l.json();if(e.isErr)return alert(e.msg),null;n.chats=e.chats,n.profiles=e.profiles}else alert("some error occured");return n}static async fetchAminChats(e=!1){const t={chats:[],profiles:[]},s=getAdminLoginCookie();if(!s)return null;const a=Settings.ApiSettings.chatsPerAPICall,n=Settings.ApiSettings.messagesPerAPICall,o=new FormData;o.append("messagesPerLoad",n),o.append("chatPerLoad",a),o.append("user_id",s),e&&o.append("skip_chat_ids",ChatsDB.JsonListIds);const l=await fetch(ServerPaths.getApiPath("chats_and_profiles_for_admin.php"),{method:"post",body:o});if(l.ok){const e=await l.json();if(e.isErr)return alert(e.msg),null;t.chats=e.chats,t.profiles=e.profiles}else alert("some error occured");return t}static async fetchUserChats(e=!1){const t={chats:[],profiles:[],admins:[],count:0},s=getUserLoginCookie();if(!s)return null;const a=Settings.ApiSettings.chatsPerAPICall,n=Settings.ApiSettings.messagesPerAPICall,o=new FormData;o.append("messagesPerLoad",n),o.append("chatPerLoad",a),o.append("user_id",s),e&&o.append("skip_chat_ids",ChatsDB.JsonListIds);const l=await fetch(ServerPaths.getApiPath("chats_and_profiles_for_user.php"),{method:"post",body:o});if(l.ok){const e=await l.json();if(e.isErr)return alert(e.msg),null;t.chats=e.chats,t.profiles=e.profiles,t.admins=e.admins,t.count=e.admin_count}else alert("some error occured");return t}static sendUserNewChat=async(e,t,s)=>{if(!t)return null;if(!e)return null;const a=Settings.ApiSettings.messagesPerAPICall,n=new FormData;n.append("msg",t),n.append("user_id",e),n.append("temp_identifier",s),n.append("messagesPerLoad",a);let o=null;const l=await fetch(ServerPaths.getApiPath("send_user_new_chat.php"),{method:"post",body:n});return l.ok?o=await l.json():alert("some error occured"),o};static async fetchChatByID(e){const t={chat:null,profile:null},s=ChatBody.makeChatID_DB_Usable(e),a=Settings.ApiSettings.chatsPerAPICall,n=Settings.ApiSettings.messagesPerAPICall,o=new FormData;o.append("messagesPerLoad",n),o.append("chatPerLoad",a),o.append("chat_id",s),o.append("user_id",MyProfile.userID);const l=await fetch(ServerPaths.getApiPath("chat_by_id.php"),{method:"post",body:o});if(l.ok){const e=await l.json();if(e.isErr)return alert(e.msg),null;t.chat=e.chat,t.profile=e.profile}else alert("some error occured"),alert("Please refresh page");return t}static deleteChat(e){let t=[];if(e.forEach((e=>{if(ChatFuncs.chatIsDeleting(e))return;ChatFuncs.setChatIsDeleting(e,!0),ChatContainDOM.makeUnselectable(e),ChatMoreOptionsDOM.makeOptionUclickale(e,"del");let s={chatID:ChatBody.makeChatID_DB_Usable(e),lastMsgID:ChatFuncs.getChatLastMsgObj(e).msgID};t.push(s)})),!t.length)return void console.log("err");let s=GenerateAPIRes.deleteChatRes(t);s?chatApis_ApiSuccess.deleteChat(s):chatApis_ApiFail.deleteChat(t)}static pinChat(e){let t=[];if(e.forEach((e=>{ChatFuncs.chatIsPinning(e)||(ChatFuncs.setChatIsPinning(e,!0),ChatMoreOptionsDOM.makeOptionUclickale(e,"pin"),t.push(ChatBody.makeChatID_DB_Usable(e)))})),!t.length)return void console.log("err");let s=GenerateAPIRes.pinChatRes(t);s?chatApis_ApiSuccess.pinChat(s):chatApis_ApiFail.pinChat(t)}}class chatApis_ApiSuccess{static deleteChat(e){e.forEach((e=>{if(e.isDeleted){let t=e.chatID;ChatFuncs.deleteChat(t),ChatFuncs.isActiveChat(t)&&MsgSectionDOM.clear(!0)}else{let t=e.chatID;ChatFuncs.setChatIsDeleting(t,!1),ChatContainDOM.makeSelectable(t),ChatMoreOptionsDOM.makeOptionClickale(t,"del"),alert("chat not deleted"),console.log("chat not deleted")}}))}static pinChat(e){e.forEach((e=>{let t=e.chatID,s=e.pinedTime,a=e.pinStatus;ChatFuncs.setChatIsPinning(t,!1),ChatMoreOptionsDOM.makeOptionClickale(t,"pin"),ChatFuncs.updateChatPinedStatus(t,a,s)}))}}class chatApis_ApiFail{static deleteChat(e){e.forEach((e=>{e=e.chatID,ChatFuncs.setChatIsDeleting(e,!1),ChatContainDOM.makeSelectable(e),ChatMoreOptionsDOM.makeOptionClickale(e,"del")}));let t=MyCodeErr.announce("Poor internet connection","");t&&console.log(t)}static pinChat(e){e.forEach((e=>{ChatFuncs.setChatIsPinning(e,!1),ChatMoreOptionsDOM.makeOptionClickale(e,"pin")}));let t=MyCodeErr.announce("Poor internet connection","");t&&console.log(t)}}class ChatFuncs{static async fetchAdminChats(){if(ChatsDB.gotAllChats)return;const e=await ChatApis.fetchAminChats(),t=e.chats,s=e.profiles;ChatsDB.saveChatsRecievedFromDB(t),s.forEach((e=>{ProfilesDB.addProfile(e)}))}static async fetchNewerChats(e=!0){let t=ChatsDB.getLatestMsg();t&&(t=t.timeSent);const s=await ChatApis.fetchNewerChatsAfter(t,e),a=s.chats,n=s.profiles;ChatsDB.saveChatsRecievedFromDB(a),n.forEach((e=>{ProfilesDB.addProfile(e)})),a.forEach((e=>{const t=e.id;ChatDOMFunc.getChatContainElemById(t)||ChatDOMFunc.putChatContainElemInPosition(ChatContainDOM.create(ChatFuncs.getChatObj(t)))}))}static async fetchUserChats(){if(ChatsDB.gotAllChats)return;const e=await ChatApis.fetchUserChats(),t=e.chats,s=e.profiles;ChatsDB.saveChatsRecievedFromDB(t),ProfilesDB.getAdminProfilesFromDB(e),s.forEach((e=>{ProfilesDB.addProfile(e)}))}static async fetchChats(e=!1){if(e){if(ChatsDB.gotAllChats)return}else if(Object.keys(ChatsDB.chats).length)return;const t=await ChatApis.fetchAminChats(),s=t.chats,a=t.profiles;ChatsDB.saveChatsRecievedFromDB(s),a.forEach((e=>{ProfilesDB.addProfile(e)}))}static async fetchChatByID(e){const t=await ChatApis.fetchChatByID(e);if(!t.chat)return alert("err"),void console.log("err");let s=t.chat,a=t.profile;a&&ProfilesDB.addProfile(a);let n=ChatsDB.addChat(s);if(!ChatFuncs.isInSearchMode()){if(!ChatContainDOM.getAllChatContains()[0])return;ChatDOMFunc.putChatContainElemInPosition(ChatContainDOM.create(n))}}static async fetchOlderChats(e=!0){const t=DOMGetter.getGetOlderChat();LoaderBackgroundDOM.append(t,LoaderBackgroundDOM.create()),ContentLoaderDOM.append(t,ContentLoaderDOM.create(!0,"boxes"));const s=Settings.ApiSettings.chatsPerAPICall;let a;if(ChatFuncs.getChatsCount()>=ChatContainDOM.getCountChatContains()+s)return LoadOlderChatsDOM.delete(),void ChatFuncs.pushInFetchedChat(!0);if(e&&(a=await ChatApis.fetchAminChats(!0)),!a.chats)return alert("err"),void console.log("err");let n=a.chats,o=a.profiles;ChatsDB.saveChatsRecievedFromDB(n),o.forEach((e=>{ProfilesDB.profileObjIsAvailable(e.userID)||ProfilesDB.addProfile(e)})),LoadOlderChatsDOM.delete(),ChatFuncs.pushInFetchedChat(!0)}static saveChatsRecievedFromDB(e,t=!1,s=!1){ChatsDB.saveChatsRecievedFromDB(e,t),s&&e.forEach((e=>{let t=e.id;t||(t=e.chatID),t&&(ChatDOMFunc.getChatContainElemById(t)||ChatDOMFunc.putChatContainElemInPosition(ChatContainDOM.create(ChatFuncs.getChatObj(t))))}))}static pushInFetchedChat(e=!1){const t=Settings.ApiSettings.chatsPerAPICall;let s=ChatsDB.sortedChats,a=0,n=0;for(;a<s.length&&n<t;){let t=s[a];if(e){let e=t.chatID;e=ChatBody.makeChatIDUsable(e),document.getElementById(e)||(ChatDOMFunc.putChatContainElemInPosition(t),n++)}else{let e=ChatContainDOM.create(t);ChatFuncs.getIsSelectingChats()&&ChatGroupActivations.allChatSelected(e),ChatContainDOM.append(e),n++}a++}(ChatFuncs.getChatsCount()-ChatContainDOM.getCountChatContains()||!ChatsDB.gotAllChats)&&LoadOlderChatsDOM.append(LoadOlderChatsDOM.create())}static deleteChat(e){ChatsDB.deleteChat(e)&&UpdateChatDOM.deleteChatElem(e)}static updateChatImage(e){UpdateChatDOM.imageElem(e)}static updateChatName(e){UpdateChatDOM.nameElem(e)}static updateChatUnreadMsgCount(e){UpdateChatDOM.chatCountElem(e)}static updateChatPinedStatus(e,t,s=Date.parse(new Date)){ChatsDB.setChatPinedStatus(e,t,s),UpdateChatDOM.pinedElem(e)}static updateChatLastMsgObj(e,t,s=!1){let a=!1,n=t.msgID;n||(a=!0,n=t.msgSendingID),ChatsDB.setChatLastMsgObj(e,n,a)&&(UpdateChatDOM.lMegElem(e,s),s||ChatFuncs.updateChatUnreadMsgCount(e))}static updateChatLastSeen(e){UpdateMsgDOM.messageHeadLastSeenElem(e),UpdateChatDOM.chatOnlineElem(e)}static socketDisconnect=async()=>{ProfilesDB.setAllLastSeenToNull();const e=ChatsDB.activeChat;e&&UpdateMsgDOM.messageHeadLastSeenElem(e),ChatContainDOM.getAllChatContains().forEach((e=>{UpdateChatDOM.chatOnlineElem(e.dataset.id)}))};static getActiveChat(){return ChatsDB.activeChat}static getChatObj(e){return ChatsDB.getChatObj(e)}static getChatLastMsgObj(e){return ChatsDB.getChatLastMsgObj(e)}static getChatLastSeen(e){return ChatsDB.getChatLastSeen(e)}static getChatLastSeenString(e){return ChatsDB.getChatLastSeenString(e)}static setChatLastMsgObj=(e,t,s=!1,a=!1)=>ChatsDB.setChatLastMsgObj(e,t,s,a);static setActiveChat(e){ChatsDB.activeChat=e}static isActiveChat(e){return ChatBody.makeChatID_DB_Usable(e)==ChatsDB.activeChat}static recieverIsOnline(e){return ChatsDB.recieverIsOnline(e)}static chatObjIsAvailable(e){return ChatsDB.chatObjIsAvailable(e)}static gotAllChatsFromDB(){return ChatsDB.gotAllChats}static getChatsCount(){return ChatsDB.chatsCount}static getIsSelectingChats(){return ChatsDB.isSelectingChats}static setIsSelectingChats(e){ChatsDB.isSelectingChats=e}static setSearchingMode(e){ChatsDB.searchingChats=e}static setChatIsPinning(e,t){ChatsDB.setChatIsPinning(e,t)}static setChatIsDeleting(e,t){ChatsDB.setChatIsDeleting(e,t)}static chatIsPinning(e){return ChatsDB.chatIsPinning(e)}static chatIsDeleting(e){return ChatsDB.chatIsDeleting(e)}static isInSearchMode(){return ChatsDB.searchingChats}static delChatSignal(){}static setNewChatAdmin=async(e,t)=>{const s=ChatBody.makeChatID_DB_Usable(e);ProfilesDB.profileObjIsAvailable(t)||await ProfilesDB.getProfileByIdFormDB(t),ProfilesDB.profileObjIsAvailable(t)&&(ChatsDB.chats[s].admin_id=t,UpdateChatDOM.doFullSwitch(ChatsDB.chats[s]),MessageHeadNormalDOM.replaceChatHead(e))};static onlineStatusSignal=async(e,t)=>{ProfilesDB.setLastSeen(e,t),ChatsDB.getChatsByProfileId(e).forEach((e=>{ChatFuncs.updateChatLastSeen(e.chatID)}))};static convertLastMsgSendingToLastMsg=(e,t,s)=>ChatsDB.convertLastMsgSendingToLastMsg(e,t,s);static chatHadAdmin=e=>ChatsDB.chatHadAdmin(e);static getFirstAvailableChatId=()=>{let e=ChatsDB.getChatsAsArr();return e.length?e[0].chatID:null}}class ChatSectionDOM{static clear(){let e=DOMGetter.getChat().children;if(e){let t=e.length;for(let s=0;s<t;s++)e[0].parentNode.removeChild(e[0])}else{let e="counld not get allChatSectionContent",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static load(e=!1){ChatHeadDOM.append(ChatHeadDOM.create()),ChatHeadNormalDOM.append(ChatHeadNormalDOM.create(MyProfile.p_pix,e)),ChatHeadSelectedDOM.append(ChatHeadSelectedDOM.create()),ChatBodyDOM.append(ChatBodyDOM.create())}}class PageCreateDOM{static messagesPage(e=!1){const t=[];if(!e){let e=document.createElement("div");e.id="chat",e.className="chat",t.push(e)}let s=document.createElement("div");return s.id="message",t.push(s),t}}class PageLoadDOM{static async adminMessagesPage(e){const t=DOMGetter.getPageSection(),s=ContentLoaderDOM.create("","spiner");if(t.appendChild(s),getAdminLoginCookie()){for(MyWebSocket.connet(!0);!MyWebSocket.db_ready;)await sleep(100);e.forEach((e=>{t.appendChild(e)})),ChatSectionDOM.load(),ChatFuncs.pushInFetchedChat(),SelectAChatDOM.append(SelectAChatDOM.create()),t.removeChild(s)}}static async _userMessagesPage(e,t=!1){const s=DOMGetter.getPageSection(),a=ContentLoaderDOM.create("","spiner");if(s.appendChild(a),!t)for(;!MyWebSocket.db_ready;)await sleep(100);e.forEach((e=>{s.appendChild(e)})),t?ChatBody.loadNoUserMesage():(ChatSectionDOM.load(!0),ChatFuncs.pushInFetchedChat(),SelectAChatDOM.append(SelectAChatDOM.create()),MsgBody.loadActiveChatMessages()),s.removeChild(a)}static userFullMessagesPage=async()=>{PageClearDOM.section(),getUserLoginCookie()?PageLoadDOM._userMessagesPage(PageCreateDOM.messagesPage()):PageLoadDOM._userMessagesPage(PageCreateDOM.messagesPage(!0),!0)}}const loaChatIcons=()=>{const e=document.querySelector("section#u_chatbox > span.icon");processAllIcons(e),e.addEventListener("click",chatToggle)},loadChats=e=>{if(e.querySelector(":scope > span.chat_contain"))return;const t=document.createElement("span");t.className="chat_contain",t.id="pageSection",e.insertBefore(t,e.querySelector(":scope > span.icon"))},deleteChats=e=>{if(e.classList.contains("show_chat"))return;const t=e.querySelector(":scope > span.chat_contain");e.removeChild(t)},chatToggle=async()=>{const e=document.querySelector("section#u_chatbox");e.classList.contains("show_chat")?(e.classList.remove("show_chat"),await sleep(250),deleteChats(e)):(loadChats(e),await sleep(10),PageLoadDOM.userFullMessagesPage(),e.classList.add("show_chat"))},startUp=async()=>{let e=!0,t=!0;const s=getUserLoginCookie();s&&(t=!1,setUserLoginCookie(s),await MyProfile.fetch(!1)?await MyWebSocket.connet(!1):(t=!0,setUserLoginCookie())),t&&(e=await ProfilesDB.getAdminProfilesFromDB()),e&&(loaChatIcons(),document.querySelector("section#u_chatbox").classList.add("loaded"))};startUp()})();